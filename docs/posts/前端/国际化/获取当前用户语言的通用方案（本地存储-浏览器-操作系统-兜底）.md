---
title: è·å–å½“å‰ç”¨æˆ·è¯­è¨€çš„é€šç”¨æ–¹æ¡ˆï¼ˆæœ¬åœ°å­˜å‚¨ / æµè§ˆå™¨ / æ“ä½œç³»ç»Ÿ / å…œåº•ï¼‰
date: 2025-10-11
categories:
  - å‰ç«¯å›½é™…åŒ–
tags:
  - i18n
  - Vue
  - TypeScript
  - å‰ç«¯å·¥ç¨‹åŒ–
---

## æ¦‚è§ˆ

æœ¬æ–‡æŠŠä½ ç°æœ‰ä»£ç é‡Œ**"è·å–å½“å‰ç”¨æˆ·è¯­è¨€"**è¿™å—æŠ½å‡ºæ¥ï¼Œæ•´ç†æˆä¸€å¥—å¯å¤ç”¨çš„æ€è·¯ä¸æœ€ç®€å®ç°ï¼Œè¦†ç›–ä»¥ä¸‹æ¥æºçš„æ£€æµ‹é¡ºåºï¼š

1. æœ¬åœ°å­˜å‚¨ï¼ˆ`localStorage` / `@vueuse/core` çš„ `useStorage`ï¼‰
2. æµè§ˆå™¨é¦–é€‰è¯­è¨€åˆ—è¡¨ï¼ˆ`navigator.languages`ï¼‰
3. æµè§ˆå™¨ä¸»è¯­è¨€ï¼ˆ`navigator.language`ï¼‰
4. æ“ä½œç³»ç»Ÿè¯­è¨€ï¼ˆé€šè¿‡æµè§ˆå™¨ UA èƒ½åŠ›é—´æ¥è·å¾—ï¼Œç°ä»£æµè§ˆå™¨å·²æš´éœ²åˆ° `navigator.*language*`ï¼‰
5. å…œåº•è¯­è¨€ï¼ˆfallbackï¼‰

å¹¶åŒ…å«**è¯­è¨€è§„èŒƒåŒ–**ï¼ˆå¤§å°å†™ã€è¿å­—ç¬¦ï¼‰ã€**åœ°åŒº-è¯­è¨€æ˜ å°„**ä¸**å¸¸è§æ–¹è¨€å›é€€**ã€‚

---

## æ•´ä½“å®ç°æ€è·¯

- **å”¯ä¸€æ•°æ®æº**ï¼šç»´æŠ¤ `LANGS`ï¼ˆæ”¯æŒçš„ i18n ç ä¸åç«¯ç æ˜ å°„ï¼‰ã€‚
- **è§„èŒƒåŒ–**ï¼šæŠŠç”¨æˆ·ç¯å¢ƒæä¾›çš„åŸå§‹è¯­è¨€å­—ç¬¦ä¸²ï¼ˆå¯èƒ½æ˜¯ `en_US`ã€`en-us`ã€`ZH`ï¼‰ç»Ÿä¸€è½¬æˆ BCP-47 é£æ ¼ï¼ˆ`lang-REGION`ï¼Œå¦‚ `en-US`ã€`zh-CN`ï¼‰ã€‚
- **å°±è¿‘åŒ¹é…**ï¼šå°è¯•"åŸæ · â†’ ä¸‹åˆ’çº¿è½¬è¿å­—ç¬¦ â†’ ä»…è¯­è¨€éƒ¨åˆ†"ä¸‰è½®åŒ¹é…ã€‚
- **è¯­è¨€çº§å›é€€æ˜ å°„**ï¼šå¦‚åªæ‹¿åˆ° `zh`ï¼Œæ˜ å°„åˆ° `zh-CN`ï¼›`ja` â†’ `ja-JP` ç­‰ã€‚
- **æ£€æµ‹é¡ºåº**ï¼š`localStorage` ä¼˜å…ˆï¼›å¦åˆ™éå† `navigator.languages`ï¼›å¦åˆ™ `navigator.language`ï¼›éƒ½æ²¡æœ‰æ—¶ç”¨å…œåº• `en`ã€‚
- **è½ç›˜ä¸å‰¯ä½œç”¨**ï¼šé€‰å‡ºæœ€ç»ˆè¯­è¨€åï¼ŒåŒæ­¥æ›´æ–° `localStorage` ä¸ `<html lang>`ï¼Œå¹¶å‡†å¤‡å¥½åç«¯éœ€è¦çš„è¯­è¨€ç ï¼ˆå¦‚ `X-App-Lang`ï¼‰ã€‚

---

## åˆ†æ­¥å®ç°

### 1) å®šä¹‰æ”¯æŒè¯­è¨€ä¸åç«¯æ˜ å°„ï¼ˆå”¯ä¸€æ•°æ®æºï¼‰

```ts
// å”¯ä¸€æ•°æ®æºï¼šUI å±•ç¤ºå + i18n æ ‡å‡†ç  + åç«¯è¯­è¨€ç 
export const LANGS = [
  { i18n: "en", backend: "en", autonym: "English" },
  { i18n: "zh-CN", backend: "zhCn", autonym: "ç®€ä½“ä¸­æ–‡" },
  { i18n: "zh-TW", backend: "zhTw", autonym: "ç¹é«”ä¸­æ–‡" },
  { i18n: "ja-JP", backend: "jp", autonym: "æ—¥æœ¬èª" },
  { i18n: "ko-KR", backend: "kr", autonym: "í•œêµ­ì–´" },
  // ...æŒ‰éœ€è¡¥å……
] as const;

export type LocaleCode = (typeof LANGS)[number]["i18n"];

export const FALLBACK_LANG: LocaleCode = "en";

export const BACKEND_LANG_MAP: Record<string, string> = Object.fromEntries(
  LANGS.map((x) => [x.i18n, x.backend])
);
// å¸¸è§æµè§ˆå™¨å˜ä½“å›é€€
(BACKEND_LANG_MAP as any)["en-US"] = BACKEND_LANG_MAP["en"];
```

### 2) è¯­è¨€è§„èŒƒåŒ–ï¼ˆå¤§å°å†™ã€è¿å­—ç¬¦ã€å°±è¿‘åŒ¹é…ï¼‰

```ts
// å¤æ‚é€»è¾‘ï¼šæŠŠ raw è¯­è¨€å­—ç¬¦ä¸²è§„èŒƒåŒ–ä¸ºå—æ”¯æŒçš„ i18n ç 
function normalizeToSupported(raw: string): LocaleCode | undefined {
  if (!raw) return;

  const code = raw.trim().toLowerCase();
  // å€™é€‰åºåˆ—ï¼šåŸæ · -> ä¸‹åˆ’çº¿æ”¹è¿å­—ç¬¦ -> ä»…è¯­è¨€éƒ¨åˆ†
  const candidates = [code, code.replace("_", "-"), code.split("-")[0]];

  const supported = new Set<LocaleCode>(LANGS.map((x) => x.i18n));
  for (const c of candidates) {
    // å¤æ‚é€»è¾‘ï¼šæ ‡å‡†åŒ–å¤§å°å†™ï¼ˆlang-REGIONï¼‰
    const canonical = c
      .split("-")
      .map((seg, i) => (i === 0 ? seg : seg.toUpperCase()))
      .join("-") as LocaleCode;
    if (supported.has(canonical)) return canonical;
  }

  // å¤æ‚é€»è¾‘ï¼šè¯­è¨€çº§å…œåº•æ˜ å°„ï¼ˆä»…è¯­è¨€ â†’ æŒ‡å®šåœ°åŒºï¼‰
  const languageOnly = code.split("-")[0];
  const languageToExact: Partial<Record<string, LocaleCode>> = {
    en: "en",
    zh: "zh-CN",
    "zh-hk": "zh-TW",
    "zh-mo": "zh-TW",
    "zh-sg": "zh-CN",
    ja: "ja-JP",
    ko: "ko-KR",
  };
  const mapped = (languageToExact[languageOnly] ?? languageToExact[code]) as
    | LocaleCode
    | undefined;
  if (mapped && supported.has(mapped)) return mapped;

  return;
}
```

### 3) è¯»å– localStorage ä¸æµè§ˆå™¨ / æ“ä½œç³»ç»Ÿé…ç½®

```ts
// ä½¿ç”¨ @vueuse/core æ—¶ï¼šuseStorageï¼›å¦åˆ™å¯ç”¨åŸç”Ÿ localStorage
import { useStorage } from "@vueuse/core";

const STORAGE_KEY_LANG = "APP_LANG";

// æœ¬åœ°å­˜å‚¨ä¸­çš„å½“å‰è¯­è¨€ï¼ˆå€¼ä¸º i18n ç ï¼‰
export const lang = useStorage<LocaleCode>(STORAGE_KEY_LANG, FALLBACK_LANG);

// å¤æ‚é€»è¾‘ï¼šè·å–åˆå§‹è¯­è¨€ï¼ˆä¼˜å…ˆæœ¬åœ°å­˜å‚¨ï¼›å†æµè§ˆå™¨/ç³»ç»Ÿï¼›å†å›é€€ ENï¼‰
export function getInitialLocale(): LocaleCode {
  // 1) æœ¬åœ°å­˜å‚¨ä¼˜å…ˆ
  if (lang.value) return lang.value as LocaleCode;

  // 2) æµè§ˆå™¨é¦–é€‰è¯­è¨€åˆ—è¡¨ï¼ˆç°ä»£æµè§ˆå™¨ä¼šæŠŠ OS è¯­è¨€åæ˜ åˆ°è¿™é‡Œï¼‰
  const navList =
    navigator.languages && navigator.languages.length > 0
      ? navigator.languages
      : [navigator.language].filter(Boolean);

  for (const raw of navList) {
    const matched = normalizeToSupported(raw);
    if (matched) return matched;
  }

  // 3) å…œåº•
  return FALLBACK_LANG;
}
```

### 4) åº”ç”¨å‰¯ä½œç”¨ï¼ˆ`<html lang>` ä¸åç«¯è¯·æ±‚å¤´ï¼‰

```ts
import { http } from "@/libs";

// å¤æ‚é€»è¾‘ï¼šè®¾ç½®åç«¯è¯·æ±‚å¤´ä¸ <html lang>
export function applyLanguageSideEffects(locale: LocaleCode) {
  const backend = BACKEND_LANG_MAP[locale] ?? locale;

  // Accept-Language å’Œè‡ªå®šä¹‰å¤´
  http.defaults.headers.common["Accept-Language"] = backend;
  http.defaults.headers.common["X-App-Lang"] = backend;

  // HTML æ ¹èŠ‚ç‚¹çš„ langï¼ˆåˆ©äºå¯è®¿é—®æ€§ä¸ SEOï¼‰
  document.documentElement?.setAttribute("lang", locale);
}
```

### 5) åˆå§‹åŒ–ä¸ä¸€æ¬¡æ€§è½ç›˜

```ts
// å¤æ‚é€»è¾‘ï¼šé€‰æ‹©è¯­è¨€ â†’ å†™å…¥ localStorage â†’ åº”ç”¨å‰¯ä½œç”¨
export function ensureLocaleInitialized() {
  const initial = getInitialLocale();
  // è‹¥æœ¬åœ°æ²¡æœ‰å­˜è¿‡è¯­è¨€ï¼ŒæŠŠæ£€æµ‹åˆ°çš„ initial å­˜èµ·æ¥
  if (!lang.value) lang.value = initial;
  applyLanguageSideEffects(initial);
  return initial;
}
```

---

## æœ€ç®€å¯å¤ç”¨ç¤ºä¾‹ï¼ˆæ•´åˆç‰ˆï¼‰

> é€‚åˆåœ¨ä»»æ„å‰ç«¯é¡¹ç›®ä¸­è½åœ°ï¼Œä¸ç»‘å®šæ¡†æ¶ã€‚æŠŠæ­¤æ®µæ”¾åˆ°ä½ çš„ i18n åˆå§‹åŒ–é™„è¿‘ã€‚

```ts
// i18n-locale.detector.ts
type LangItem = { i18n: string; backend: string; autonym: string };
export const LANGS = [
  { i18n: "en", backend: "en", autonym: "English" },
  { i18n: "zh-CN", backend: "zhCn", autonym: "ç®€ä½“ä¸­æ–‡" },
  { i18n: "zh-TW", backend: "zhTw", autonym: "ç¹é«”ä¸­æ–‡" },
  { i18n: "ja-JP", backend: "jp", autonym: "æ—¥æœ¬èª" },
  { i18n: "ko-KR", backend: "kr", autonym: "í•œêµ­ì–´" },
] as const;

export type LocaleCode = (typeof LANGS)[number]["i18n"];
export const FALLBACK_LANG: LocaleCode = "en";

export const BACKEND_LANG_MAP: Record<string, string> = Object.fromEntries(
  LANGS.map((x) => [x.i18n, x.backend])
);
(BACKEND_LANG_MAP as any)["en-US"] = BACKEND_LANG_MAP["en"];

// â€”â€”â€” å¤æ‚é€»è¾‘ï¼šè§„èŒƒåŒ– â€”â€”â€”
function normalizeToSupported(raw: string): LocaleCode | undefined {
  if (!raw) return;
  const code = raw.trim().toLowerCase();
  const candidates = [code, code.replace("_", "-"), code.split("-")[0]];
  const supported = new Set<LocaleCode>(LANGS.map((x) => x.i18n));
  for (const c of candidates) {
    // å¤æ‚é€»è¾‘ï¼šlang-REGION æ ‡å‡†åŒ–
    const canonical = c
      .split("-")
      .map((seg, i) => (i === 0 ? seg : seg.toUpperCase()))
      .join("-") as LocaleCode;
    if (supported.has(canonical)) return canonical;
  }
  // å¤æ‚é€»è¾‘ï¼šè¯­è¨€çº§æ˜ å°„
  const languageOnly = code.split("-")[0];
  const languageToExact: Partial<Record<string, LocaleCode>> = {
    en: "en",
    zh: "zh-CN",
    "zh-hk": "zh-TW",
    "zh-mo": "zh-TW",
    "zh-sg": "zh-CN",
    ja: "ja-JP",
    ko: "ko-KR",
  };
  const mapped = (languageToExact[languageOnly] ?? languageToExact[code]) as
    | LocaleCode
    | undefined;
  if (mapped && supported.has(mapped)) return mapped;
  return;
}

// â€”â€”â€” å¤æ‚é€»è¾‘ï¼šæ£€æµ‹é¡ºåº â€”â€”â€”
export function detectLocale(
  getItem = (k: string) => localStorage.getItem(k)
): LocaleCode {
  const saved = getItem("APP_LANG") as LocaleCode | null;
  if (saved) return saved;

  const navList =
    navigator.languages && navigator.languages.length > 0
      ? navigator.languages
      : [navigator.language].filter(Boolean);

  for (const raw of navList) {
    const matched = normalizeToSupported(raw);
    if (matched) return matched;
  }
  return FALLBACK_LANG;
}

// â€”â€”â€” å¤æ‚é€»è¾‘ï¼šå‰¯ä½œç”¨ï¼ˆè¯·æ±‚å¤´ä¸ <html lang>ï¼‰â€”â€”â€”
export function commitLocale(
  locale: LocaleCode,
  setHeader?: (k: string, v: string) => void
) {
  const backend = BACKEND_LANG_MAP[locale] ?? locale;
  // å¯é€‰ï¼šå¯¹æ¥ä½ çš„ http å®¢æˆ·ç«¯
  setHeader?.("Accept-Language", backend);
  setHeader?.("X-App-Lang", backend);
  document.documentElement?.setAttribute("lang", locale);
}
```

ä½¿ç”¨æ–¹å¼ï¼ˆä»¥ Vue é¡¹ç›®ä¸ºä¾‹ï¼‰ï¼š

```ts
// main.ts
import { detectLocale, commitLocale } from "./i18n-locale.detector";
import i18n from "./i18n";

const initial = detectLocale();
localStorage.setItem("APP_LANG", initial);
// å¤æ‚é€»è¾‘ï¼šåº”ç”¨å‰¯ä½œç”¨ï¼ˆè‹¥ä½ ç”¨ axiosï¼Œå¯åœ¨è¿™é‡Œè®¾ç½®é»˜è®¤å¤´ï¼‰
commitLocale(initial, (k, v) =>
  (window as any).http?.defaults?.headers?.common
    ? ((window as any).http.defaults.headers.common[k] = v)
    : null
);
// ç„¶åæŠŠ initial ä¼ ç»™ä½ çš„ i18n å®ä¾‹
i18n.global.locale = initial;
```

---

## æ£€æµ‹é¡ºåºæµç¨‹å›¾

```
å¼€å§‹æ£€æµ‹
    â†“
1. è¯»å– localStorage['APP_LANG']
    â”œâ”€ æœ‰å€¼ â†’ è¿”å›
    â””â”€ æ— å€¼ â†’ ç»§ç»­
        â†“
2. éå† navigator.languages[]
    â”œâ”€ æ‰¾åˆ°åŒ¹é… â†’ è¿”å›
    â””â”€ æ— åŒ¹é… â†’ ç»§ç»­
        â†“
3. æ£€æŸ¥ navigator.language
    â”œâ”€ æ‰¾åˆ°åŒ¹é… â†’ è¿”å›
    â””â”€ æ— åŒ¹é… â†’ ç»§ç»­
        â†“
4. è¿”å›å…œåº•è¯­è¨€ (en)
```

---

## è§„èŒƒåŒ–ä¸æ˜ å°„ç¤ºä¾‹

| è¾“å…¥åŸå§‹å€¼ | è§„èŒƒåŒ–æ­¥éª¤               | æœ€ç»ˆç»“æœ | è¯´æ˜                   |
| ---------- | ------------------------ | -------- | ---------------------- |
| `en_US`    | ä¸‹åˆ’çº¿è½¬è¿å­—ç¬¦ â†’ `en-US` | `en`     | æ˜ å°„åˆ°é€šç”¨è‹±è¯­         |
| `zh-cn`    | å¤§å°å†™æ ‡å‡†åŒ– â†’ `zh-CN`   | `zh-CN`  | ç®€ä½“ä¸­æ–‡               |
| `zh`       | è¯­è¨€çº§æ˜ å°„ â†’ `zh-CN`     | `zh-CN`  | é»˜è®¤ç®€ä½“ä¸­æ–‡           |
| `zh-HK`    | è¯­è¨€çº§æ˜ å°„ â†’ `zh-TW`     | `zh-TW`  | é¦™æ¸¯ç¹ä½“æ˜ å°„åˆ°å°æ¹¾ç¹ä½“ |
| `ja`       | è¯­è¨€çº§æ˜ å°„ â†’ `ja-JP`     | `ja-JP`  | æ—¥è¯­                   |
| `unknown`  | æ— åŒ¹é…                   | `en`     | å…œåº•åˆ°è‹±è¯­             |
| `ZH`       | å°å†™åŒ– â†’ `zh` â†’ `zh-CN`  | `zh-CN`  | å¤§å†™è¾“å…¥ä¹Ÿèƒ½æ­£ç¡®å¤„ç†   |
| `en-us`    | å¤§å°å†™æ ‡å‡†åŒ– â†’ `en-US`   | `en`     | ç»Ÿä¸€åˆ° `en`            |
| `zh-sg`    | åœ°åŒºæ˜ å°„ â†’ `zh-CN`       | `zh-CN`  | æ–°åŠ å¡ä½¿ç”¨ç®€ä½“ä¸­æ–‡     |
| `zh-MO`    | åœ°åŒºæ˜ å°„ â†’ `zh-TW`       | `zh-TW`  | æ¾³é—¨ä½¿ç”¨ç¹ä½“ä¸­æ–‡       |

---

## å…¼å®¹æ€§ä¸æ³¨æ„äº‹é¡¹

- `navigator.languages` åœ¨ç°ä»£æµè§ˆå™¨å¹¿æ³›æ”¯æŒï¼›è€ç¯å¢ƒå¯å›é€€åˆ° `navigator.language`ã€‚
- æ“ä½œç³»ç»Ÿè¯­è¨€é€šå¸¸å·²æ˜ å°„åˆ°æµè§ˆå™¨è¯­è¨€ APIï¼›ä¸å»ºè®®å†è¯» UA æˆ–éæ ‡å‡†å­—æ®µã€‚
- å»ºè®®æŠŠ**è§„èŒƒåŒ–ä¸æ˜ å°„è¡¨**é›†ä¸­ç»´æŠ¤åœ¨ä¸€å¤„ï¼Œä¾¿äºå®¡è®¡ä¸æ‰©å±•ã€‚
- è‹¥åç«¯æœ‰**è‡ªå®šä¹‰è¯­è¨€ç **ï¼ˆå¦‚ `zhCn`ï¼‰ï¼ŒåŠ¡å¿…ç»´æŠ¤å¥½ `BACKEND_LANG_MAP` å¹¶åœ¨è¯·æ±‚å¤´é‡Œç»Ÿä¸€ä½¿ç”¨ã€‚
- SSR åœºæ™¯ï¼šè¯·ä»è¯·æ±‚å¤´ `Accept-Language` è§£æå¹¶åœ¨æœåŠ¡ç«¯å…ˆè¡Œé€‰æ‹©è¯­è¨€ï¼Œå†æŠŠç»“æœæ³¨æ°´åˆ°å®¢æˆ·ç«¯ï¼Œé¿å…é¦–å±é—ªçƒã€‚

---

## å¸¸è§é—®ç­”

### â“ Q1ï¼šåªæœ‰ `zh` æ—¶é€‰ `zh-CN` è¿˜æ˜¯ `zh-TW`ï¼Ÿ

**A**ï¼šå–ä¸šåŠ¡ä¸»æµå¸‚åœºä½œä¸ºé»˜è®¤ï¼ˆæœ¬æ–‡ç¤ºä¾‹ç”¨ `zh-CN`ï¼‰ã€‚å¦‚æœ‰é¢å‘åœ°åŒºï¼Œå¯ç”¨ GeoIP/åŸŸå/éƒ¨ç½²åŒºåŸŸå†³å®šåˆå§‹æ˜ å°„ã€‚

### â“ Q2ï¼š`en` å’Œ `en-US` æ€ä¹ˆå¤„ç†ï¼Ÿ

**A**ï¼šç»Ÿä¸€ä»¥ `en` ä½œä¸ºè¯­è¨€é›†åˆé‡Œçš„æœ€å°å•å…ƒï¼›å¿…è¦æ—¶å¯¹ `en-US` åšåç«¯ç å›é€€åˆ° `en`ã€‚

### â“ Q3ï¼šå¦‚ä½•æ”¯æŒæ›´å¤šåœ°åŒºå˜ä½“ï¼Ÿ

**A**ï¼šåœ¨ `languageToExact` æ˜ å°„è¡¨ä¸­æ·»åŠ æ›´å¤šè§„åˆ™ï¼Œä¾‹å¦‚ï¼š

```ts
const languageToExact: Partial<Record<string, LocaleCode>> = {
  en: "en",
  "en-gb": "en-GB", // è‹±å›½è‹±è¯­
  "en-au": "en-AU", // æ¾³å¤§åˆ©äºšè‹±è¯­
  zh: "zh-CN",
  "zh-hk": "zh-TW",
  "zh-mo": "zh-TW",
  "zh-sg": "zh-CN",
  ja: "ja-JP",
  ko: "ko-KR",
  "pt-br": "pt-BR", // å·´è¥¿è‘¡è„ç‰™è¯­
  "pt-pt": "pt-PT", // è‘¡è„ç‰™è‘¡è„ç‰™è¯­
};
```

### â“ Q4ï¼šä¸ºä»€ä¹ˆè¦åŒæ­¥æ›´æ–° `<html lang>` å±æ€§ï¼Ÿ

**A**ï¼š

1. **å¯è®¿é—®æ€§**ï¼šå±å¹•é˜…è¯»å™¨ä¼šæ ¹æ® `lang` å±æ€§é€‰æ‹©æ­£ç¡®çš„å‘éŸ³ã€‚
2. **SEO**ï¼šæœç´¢å¼•æ“ä½¿ç”¨ `lang` å±æ€§æ¥ç¡®å®šé¡µé¢è¯­è¨€ã€‚
3. **æµè§ˆå™¨è¡Œä¸º**ï¼šæŸäº›æµè§ˆå™¨åŠŸèƒ½ï¼ˆå¦‚ç¿»è¯‘æç¤ºï¼‰ä¾èµ–æ­¤å±æ€§ã€‚

### â“ Q5ï¼šå¦‚ä½•åœ¨ SSR é¡¹ç›®ä¸­å®ç°ï¼Ÿ

**A**ï¼šSSR åœºæ™¯å»ºè®®ï¼š

```ts
// æœåŠ¡ç«¯
import { detectLocale } from "./i18n-locale.detector";

app.get("*", (req, res) => {
  // ä»è¯·æ±‚å¤´è·å–è¯­è¨€
  const acceptLanguage = req.headers["accept-language"];
  const locale = detectLocaleFromHeader(acceptLanguage);

  // æ¸²æŸ“æ—¶æ³¨å…¥åˆ° HTML
  const html = renderToString(app, { locale });
  res.send(html);
});

// å®¢æˆ·ç«¯
// ä»æœåŠ¡ç«¯æ³¨æ°´çš„æ•°æ®ä¸­è¯»å–è¯­è¨€ï¼Œé¿å…å®¢æˆ·ç«¯é‡æ–°æ£€æµ‹å¯¼è‡´é—ªçƒ
const locale = window.__INITIAL_STATE__.locale;
```

---

## ä¸å…¶ä»–å›½é™…åŒ–æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆç‰¹ç‚¹                     | æœ¬æ–‡æ–¹æ¡ˆ | ä»…ç”¨æµè§ˆå™¨è¯­è¨€ | ä»…ç”¨ localStorage | åç«¯è¿”å›è¯­è¨€ |
| ---------------------------- | -------- | -------------- | ----------------- | ------------ |
| è®°ä½ç”¨æˆ·é€‰æ‹©                 | âœ…       | âŒ             | âœ…                | âœ…           |
| é¦–æ¬¡è®¿é—®è‡ªåŠ¨æ£€æµ‹             | âœ…       | âœ…             | âŒ                | âœ…           |
| æ”¯æŒåœ°åŒºæ–¹è¨€æ˜ å°„             | âœ…       | âš ï¸             | âŒ                | âš ï¸           |
| æ— éœ€åç«¯æ¥å£                 | âœ…       | âœ…             | âœ…                | âŒ           |
| è§„èŒƒåŒ–å¤„ç†ï¼ˆå¤§å°å†™ã€è¿å­—ç¬¦ï¼‰ | âœ…       | âŒ             | âŒ                | âš ï¸           |

---

## å®Œæ•´ä½¿ç”¨ç¤ºä¾‹ï¼ˆVue 3 + Vite + vue-i18nï¼‰

```ts
// src/locales/detector.ts
export {
  detectLocale,
  commitLocale,
  LANGS,
  LocaleCode,
} from "./i18n-locale.detector";

// src/main.ts
import { createApp } from "vue";
import { createI18n } from "vue-i18n";
import App from "./App.vue";
import { detectLocale, commitLocale } from "./locales/detector";
import axios from "axios";

// 1. æ£€æµ‹è¯­è¨€
const initialLocale = detectLocale();

// 2. åˆ›å»º i18n å®ä¾‹
const i18n = createI18n({
  legacy: false,
  locale: initialLocale,
  fallbackLocale: "en",
  messages: {
    // ä½ çš„è¯­è¨€åŒ…
  },
});

// 3. åº”ç”¨å‰¯ä½œç”¨
commitLocale(initialLocale, (k, v) => {
  axios.defaults.headers.common[k] = v;
});

// 4. åˆ›å»ºå¹¶æŒ‚è½½åº”ç”¨
const app = createApp(App);
app.use(i18n);
app.mount("#app");
```

---

## æœ€ä½³å®è·µæ€»ç»“

âœ… **æ¨èåšæ³•**

1. **ç»Ÿä¸€æ•°æ®æº**ï¼šæ‰€æœ‰è¯­è¨€é…ç½®é›†ä¸­åœ¨ `LANGS` æ•°ç»„ä¸­ç®¡ç†
2. **ä¼˜å…ˆçº§æ˜ç¡®**ï¼šlocalStorage > navigator.languages > navigator.language > fallback
3. **è§„èŒƒåŒ–å¤„ç†**ï¼šç»Ÿä¸€è½¬æ¢ä¸º BCP-47 æ ¼å¼ï¼ˆ`lang-REGION`ï¼‰
4. **åœ°åŒºæ˜ å°„**ï¼šä¸ºå¸¸è§åœ°åŒºï¼ˆå¦‚é¦™æ¸¯ã€æ–°åŠ å¡ï¼‰æä¾›åˆç†çš„é»˜è®¤æ˜ å°„
5. **å‰¯ä½œç”¨åŒæ­¥**ï¼šåŒæ—¶æ›´æ–° localStorageã€HTML langã€axios è¯·æ±‚å¤´
6. **TypeScript ç±»å‹**ï¼šä½¿ç”¨ `as const` å’Œç±»å‹æ¨å¯¼ç¡®ä¿ç±»å‹å®‰å…¨

ğŸš« **ä¸æ¨èçš„åšæ³•**

1. **ç¡¬ç¼–ç è¯­è¨€åˆ¤æ–­**ï¼šé¿å… `if (lang === 'zh-CN')` è¿™ç§æ•£è½åœ¨å„å¤„çš„åˆ¤æ–­
2. **å¿½ç•¥å¤§å°å†™**ï¼šä¸å¤„ç† `ZH`ã€`zh`ã€`Zh` ç­‰å˜ä½“
3. **ä¸åšè§„èŒƒåŒ–**ï¼šç›´æ¥ä½¿ç”¨åŸå§‹çš„ `navigator.language` å€¼
4. **å¿˜è®°æ›´æ–°å‰¯ä½œç”¨**ï¼šåªæ›´æ–° i18n localeï¼Œä¸æ›´æ–° HTML lang å’Œè¯·æ±‚å¤´

---

## ç»“è¯­

æŠŠ"è·å–ç”¨æˆ·è¯­è¨€"çš„é€»è¾‘**æŠ½è±¡ä¸ºæ£€æµ‹ â†’ è§„èŒƒåŒ– â†’ æ˜ å°„ â†’ å…œåº• â†’ å‰¯ä½œç”¨**äº”æ­¥æ³•ï¼Œå¯ä»¥åœ¨ä»»æ„æ¡†æ¶è½åœ°å¤ç”¨ã€‚ä½ å¯ä»¥ç›´æ¥æŠŠæœ¬æ–‡çš„**æœ€ç®€å¯å¤ç”¨ç¤ºä¾‹**æ‹èµ°ï¼Œç”¨åœ¨ç°æœ‰ i18n åˆå§‹åŒ–æµç¨‹ä¸­å³å¯ã€‚

è¿™å¥—æ–¹æ¡ˆçš„æ ¸å¿ƒä¼˜åŠ¿ï¼š

1. âœ… **å¤šæ¥æºæ£€æµ‹**ï¼šè¦†ç›– localStorageã€æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿ
2. âœ… **æ™ºèƒ½è§„èŒƒåŒ–**ï¼šå¤„ç†å„ç§å¤§å°å†™å’Œè¿å­—ç¬¦å˜ä½“
3. âœ… **åœ°åŒºæ˜ å°„**ï¼šä¸ºå¸¸è§åœ°åŒºæä¾›åˆç†çš„è¯­è¨€é»˜è®¤å€¼
4. âœ… **å‰¯ä½œç”¨åŒæ­¥**ï¼šç¡®ä¿ i18nã€HTMLã€è¯·æ±‚å¤´ä¿æŒä¸€è‡´
5. âœ… **æ¡†æ¶æ— å…³**ï¼šå¯ç”¨äº Vueã€Reactã€Angular ç­‰ä»»æ„å‰ç«¯é¡¹ç›®

ç°åœ¨ä½ å¯ä»¥åœ¨é¡¹ç›®ä¸­å®ç°ä¸€ä¸ªå¥å£®çš„å¤šè¯­è¨€æ£€æµ‹ç³»ç»Ÿäº†ï¼ğŸŒ
