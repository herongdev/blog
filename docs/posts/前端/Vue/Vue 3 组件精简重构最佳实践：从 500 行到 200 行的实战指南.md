---
title: Vue 3 ç»„ä»¶ç²¾ç®€é‡æ„æœ€ä½³å®è·µï¼šä» 500 è¡Œåˆ° 200 è¡Œçš„å®æˆ˜æŒ‡å—
date: 2024-01-20 10:00:00
categories:
  - å‰ç«¯å¼€å‘
  - Vue.js
tags:
  - Vue 3
  - ç»„ä»¶è®¾è®¡
  - ä»£ç é‡æ„
  - Composition API
  - æœ€ä½³å®è·µ
description: æ·±å…¥æ¢è®¨ Vue 3 ç»„ä»¶ç²¾ç®€çš„å®Œæ•´æ–¹æ³•è®ºï¼Œé€šè¿‡å®æˆ˜æ¡ˆä¾‹å±•ç¤ºå¦‚ä½•å°†è‡ƒè‚¿çš„ç»„ä»¶é‡æ„ä¸ºæ¸…æ™°ã€å¯ç»´æŠ¤çš„ä»£ç ç»“æ„ã€‚
---

# Vue 3 ç»„ä»¶ç²¾ç®€é‡æ„æœ€ä½³å®è·µï¼šä» 500 è¡Œåˆ° 200 è¡Œçš„å®æˆ˜æŒ‡å—

> æœ¬æ–‡åŸºäºä¸€ä¸ªçœŸå®çš„äº¤æ˜“é¢æ¿ç»„ä»¶é‡æ„æ¡ˆä¾‹ï¼ˆä» 514 è¡Œç²¾ç®€åˆ° 217 è¡Œï¼Œå‡å°‘ 57.8%ï¼‰ï¼Œç³»ç»Ÿæ€§åœ°æ€»ç»“äº† Vue 3 ç»„ä»¶ç²¾ç®€çš„å®Œæ•´æ–¹æ³•è®ºå’Œæœ€ä½³å®è·µã€‚

## ç›®å½•

- [ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ç»„ä»¶ç²¾ç®€](#ä¸€ä¸ºä»€ä¹ˆéœ€è¦ç»„ä»¶ç²¾ç®€)
- [äºŒã€ç»„ä»¶ç²¾ç®€çš„æ ¸å¿ƒç†å¿µ](#äºŒç»„ä»¶ç²¾ç®€çš„æ ¸å¿ƒç†å¿µ)
- [ä¸‰ã€ç»„ä»¶ç²¾ç®€çš„ä¸¤å¤§æ ¸å¿ƒæ–¹æ³•](#ä¸‰ç»„ä»¶ç²¾ç®€çš„ä¸¤å¤§æ ¸å¿ƒæ–¹æ³•)
- [å››ã€å®æˆ˜ï¼šäº¤æ˜“é¢æ¿ç»„ä»¶é‡æ„æ¡ˆä¾‹](#å››å®æˆ˜äº¤æ˜“é¢æ¿ç»„ä»¶é‡æ„æ¡ˆä¾‹)
- [äº”ã€ç»„ä»¶ç²¾ç®€çš„æœ€ä½³å®è·µ](#äº”ç»„ä»¶ç²¾ç®€çš„æœ€ä½³å®è·µ)
- [å…­ã€é‡æ„çš„é£é™©ä¸æ³¨æ„äº‹é¡¹](#å…­é‡æ„çš„é£é™©ä¸æ³¨æ„äº‹é¡¹)
- [ä¸ƒã€æ•ˆæœè¯„ä¼°ä¸åº¦é‡æŒ‡æ ‡](#ä¸ƒæ•ˆæœè¯„ä¼°ä¸åº¦é‡æŒ‡æ ‡)
- [å…«ã€æ€»ç»“](#å…«æ€»ç»“)

---

## ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ç»„ä»¶ç²¾ç®€

### 1.1 è‡ƒè‚¿ç»„ä»¶çš„å…¸å‹é—®é¢˜

```vue
<!-- âŒ å…¸å‹çš„è‡ƒè‚¿ç»„ä»¶ -->
<script setup>
// 500+ è¡Œçš„å•æ–‡ä»¶ç»„ä»¶
// - 10+ ä¸ª reactive/ref çŠ¶æ€
// - 20+ ä¸ª computed è®¡ç®—å±æ€§
// - 15+ ä¸ª watch ç›‘å¬å™¨
// - 30+ ä¸ªå‡½æ•°æ–¹æ³•
// - å¤§é‡é‡å¤é€»è¾‘
// - èŒè´£ä¸æ¸…æ™°
</script>
```

**å¸¸è§ç—‡çŠ¶ï¼š**

1. **å¯è¯»æ€§å·®**ï¼šéœ€è¦å¤§é‡æ»šåŠ¨æ‰èƒ½ç†è§£ç»„ä»¶å…¨è²Œ
2. **éš¾ä»¥ç»´æŠ¤**ï¼šä¿®æ”¹ä¸€å¤„å¯èƒ½å½±å“å¤šå¤„
3. **éš¾ä»¥æµ‹è¯•**ï¼šæµ‹è¯•éœ€è¦ mock å¤§é‡ä¾èµ–
4. **éš¾ä»¥å¤ç”¨**ï¼šé€»è¾‘è€¦åˆï¼Œæ— æ³•åœ¨å…¶ä»–åœºæ™¯ä½¿ç”¨
5. **æ€§èƒ½éšæ‚£**ï¼šå¤§é‡è®¡ç®—å’Œç›‘å¬å¯¼è‡´æ€§èƒ½é—®é¢˜
6. **åä½œå›°éš¾**ï¼šå¤šäººä¿®æ”¹å®¹æ˜“äº§ç”Ÿå†²çª

### 1.2 ç²¾ç®€ç»„ä»¶çš„æ ¸å¿ƒä»·å€¼

```typescript
// âœ… ç²¾ç®€åçš„ç»„ä»¶ä»·å€¼

ä»·å€¼ 1: å¯ç»´æŠ¤æ€§ â†‘ 300%
- ä»£ç é‡å‡å°‘ 50-70%
- èŒè´£å•ä¸€ï¼Œä¿®æ”¹å½±å“èŒƒå›´å°
- ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç†è§£

ä»·å€¼ 2: å¯å¤ç”¨æ€§ â†‘ 500%
- æå–çš„ç»„ä»¶/Composable å¯åœ¨å¤šå¤„ä½¿ç”¨
- å¤§å¹…æé«˜å¼€å‘æ•ˆç‡
- å‡å°‘é‡å¤ä»£ç 

ä»·å€¼ 3: å¯æµ‹è¯•æ€§ â†‘ 400%
- æ¯ä¸ªå•å…ƒå¯ç‹¬ç«‹æµ‹è¯•
- æµ‹è¯•è¦†ç›–ç‡æ›´é«˜
- Bug å®šä½æ›´å‡†ç¡®

ä»·å€¼ 4: åä½œæ•ˆç‡ â†‘ 200%
- ä»£ç å†²çªå‡å°‘
- Code Review æ›´å®¹æ˜“
- æ–°äººä¸Šæ‰‹æ›´å¿«

ä»·å€¼ 5: æ€§èƒ½ä¼˜åŒ– â†‘ 150%
- æŒ‰éœ€åŠ è½½æ›´å®¹æ˜“å®ç°
- ç»†ç²’åº¦çš„å“åº”å¼æ›´æ–°
- æ›´å¥½çš„ç¼“å­˜ç­–ç•¥
```

---

## äºŒã€ç»„ä»¶ç²¾ç®€çš„æ ¸å¿ƒç†å¿µ

### 2.1 å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰

> **æ¯ä¸ªç»„ä»¶/Composable åªåšä¸€ä»¶äº‹ï¼Œå¹¶æŠŠè¿™ä»¶äº‹åšå¥½ã€‚**

```typescript
// âŒ é”™è¯¯ï¼šä¸€ä¸ªç»„ä»¶åšå¤ªå¤šäº‹
const TradingPanel = {
  // å¸‚åœºçŠ¶æ€ç®¡ç†
  // æŠ¥ä»·ç®¡ç†
  // è®¢å•æ„å»º
  // æ­¢ç›ˆæ­¢æŸ
  // è¡¨å•éªŒè¯
  // UI æ¸²æŸ“
  // ... å¤ªå¤šèŒè´£
}

// âœ… æ­£ç¡®ï¼šèŒè´£åˆ†ç¦»
const TradingPanel = {
  // åªè´Ÿè´£ï¼šç»„ä»¶ç¼–æ’ + çŠ¶æ€åè°ƒ
}

const MarketStatusWrapper = {
  // åªè´Ÿè´£ï¼šå¸‚åœºçŠ¶æ€ç®¡ç†
}

const useQuoteManager = {
  // åªè´Ÿè´£ï¼šæŠ¥ä»·æ•°æ®ç®¡ç†
}

const useOrderBuilder = {
  // åªè´Ÿè´£ï¼šè®¢å•æ„å»ºå’ŒéªŒè¯
}

const SLTPManager = {
  // åªè´Ÿè´£ï¼šæ­¢ç›ˆæ­¢æŸç®¡ç†
}
```

### 2.2 ç»„åˆä¼˜äºç»§æ‰¿

> **é€šè¿‡ç»„åˆå°çš„ã€ä¸“æ³¨çš„ç»„ä»¶/Composableï¼Œæ„å»ºå¤æ‚åŠŸèƒ½ã€‚**

```vue
<!-- âœ… ç»„åˆçš„åŠ›é‡ -->
<template>
  <MarketStatusWrapper :symbol="symbol" v-slot="{ isMarketOpen }">
    <TradingForm :isMarketOpen="isMarketOpen">
      <LotsSlider @update="handleLotsChange" />
      <SLTPManager ref="sltpRef" />
      <SubmitButton @submit="handleSubmit" />
    </TradingForm>
  </MarketStatusWrapper>
</template>

<script setup>
// ç»„åˆå¤šä¸ª Composable
const { quote, hasQuote } = useQuoteManager({ symbol })
const { submitOrder } = useOrderBuilder({ quote })
const { validate } = useFormValidator()
</script>
```

### 2.3 å…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆSeparation of Concernsï¼‰

```typescript
/**
 * å…³æ³¨ç‚¹åˆ†ç¦»çš„å±‚æ¬¡ç»“æ„
 */

// 1. UI å±‚ï¼ˆç»„ä»¶ï¼‰
//    èŒè´£ï¼šæ¸²æŸ“ UI + ç”¨æˆ·äº¤äº’
//    ä¸åº”è¯¥ï¼šåŒ…å«ä¸šåŠ¡é€»è¾‘ã€API è°ƒç”¨ã€å¤æ‚è®¡ç®—

// 2. é€»è¾‘å±‚ï¼ˆComposableï¼‰
//    èŒè´£ï¼šå¯å¤ç”¨çš„ä¸šåŠ¡é€»è¾‘
//    ä¸åº”è¯¥ï¼šç›´æ¥æ“ä½œ DOMã€ä¾èµ–ç‰¹å®šç»„ä»¶

// 3. æ•°æ®å±‚ï¼ˆStore/Serviceï¼‰
//    èŒè´£ï¼šæ•°æ®ç®¡ç† + API è°ƒç”¨
//    ä¸åº”è¯¥ï¼šåŒ…å« UI é€»è¾‘

// 4. å·¥å…·å±‚ï¼ˆUtilsï¼‰
//    èŒè´£ï¼šçº¯å‡½æ•°å·¥å…·
//    ä¸åº”è¯¥ï¼šæœ‰å‰¯ä½œç”¨ã€ä¾èµ–å¤–éƒ¨çŠ¶æ€
```

---

## ä¸‰ã€ç»„ä»¶ç²¾ç®€çš„ä¸¤å¤§æ ¸å¿ƒæ–¹æ³•

### 3.1 æ–¹æ³•ä¸€ï¼šå°è£…å­ç»„ä»¶ï¼ˆComponent Extractionï¼‰

#### 3.1.1 ä½•æ—¶æå–å­ç»„ä»¶

**æå–æ—¶æœºåˆ¤æ–­æ¸…å•ï¼š**

```typescript
// âœ… åº”è¯¥æå–å­ç»„ä»¶çš„åœºæ™¯

1. é‡å¤çš„ UI æ¨¡å¼
   - ç›¸åŒçš„ç»“æ„å‡ºç° 2+ æ¬¡
   - ä¾‹å¦‚ï¼šè¡¨å•å­—æ®µã€å¡ç‰‡ã€åˆ—è¡¨é¡¹

2. ç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—
   - æœ‰æ˜ç¡®çš„è¾“å…¥ï¼ˆpropsï¼‰å’Œè¾“å‡ºï¼ˆeventsï¼‰
   - ä¾‹å¦‚ï¼šæ–‡ä»¶ä¸Šä¼ å™¨ã€æ—¥æœŸé€‰æ‹©å™¨

3. å¯ä»¥ç‹¬ç«‹æµ‹è¯•çš„å•å…ƒ
   - å¯ä»¥è„±ç¦»çˆ¶ç»„ä»¶å•ç‹¬æµ‹è¯•
   - ä¾‹å¦‚ï¼šæŒ‰é’®ç»„ã€æœç´¢æ¡†

4. è¶…è¿‡ 50 è¡Œçš„æ¨¡æ¿å—
   - æ¨¡æ¿ä»£ç è¿‡é•¿å½±å“å¯è¯»æ€§
   - ä¾‹å¦‚ï¼šå¤æ‚è¡¨å•ã€æ•°æ®è¡¨æ ¼

5. å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹å¤ç”¨
   - æœ‰å¤ç”¨æ½œåŠ›çš„é€šç”¨ç»„ä»¶
   - ä¾‹å¦‚ï¼šåŠ è½½çŠ¶æ€ã€ç©ºçŠ¶æ€
```

#### 3.1.2 å­ç»„ä»¶æå–å®æˆ˜

**æ¡ˆä¾‹ 1ï¼šæå–æŒ‰é’®ç»„ä»¶**

```vue
<!-- Before: çˆ¶ç»„ä»¶ä¸­çš„æŒ‰é’®é€»è¾‘ -->
<template>
  <button @click="handleSubmit" :style="buttonStyle" :disabled="isDisabled">
    <span>{{ buttonText }}</span>
  </button>
</template>

<script setup>
// 40+ è¡Œçš„æŒ‰é’®é€»è¾‘
const buttonStyle = computed(() => {
  const base = { borderRadius: '8px', height: '38px' }
  if (isDisabled.value || !isMarketOpen.value) {
    return { ...base, backgroundColor: '#d9d9d9', ... }
  }
  return { ...base, backgroundColor: getColor(), ... }
})

const buttonText = computed(() => {
  switch (tradeDirection.value) {
    case 'BUY': return t('buy-long')
    case 'SELL': return t('sell-short')
    default: return ''
  }
})

const isDisabled = computed(() => {
  return !hasData.value || !isValid.value || !isMarketOpen.value
})
</script>

<!-- After: æå–ä¸ºå­ç»„ä»¶ -->
<template>
  <SubmitButton
    :tradeDirection="tradeDirection"
    :isMarketOpen="isMarketOpen"
    :disabled="isDisabled"
    @submit="handleSubmit"
  />
</template>
```

```vue
<!-- SubmitButton.vue -->
<template>
  <button @click="handleClick" :style="buttonStyle">
    <span>{{ buttonText }}</span>
  </button>
</template>

<script setup>
import { computed } from 'vue'
import { useI18n } from 'vue-i18n'

const { t } = useI18n()

const props = defineProps<{
  tradeDirection: 'BUY' | 'SELL'
  isMarketOpen: boolean
  disabled?: boolean
}>()

const emit = defineEmits<{
  submit: []
}>()

// å°è£…çš„æŒ‰é’®é€»è¾‘
const buttonText = computed(() => {
  return props.isMarketOpen
    ? t(`trading.${props.tradeDirection.toLowerCase()}`)
    : t('market-closed')
})

const buttonStyle = computed(() => {
  const base = { borderRadius: '8px', height: '38px' }

  if (props.disabled || !props.isMarketOpen) {
    return {
      ...base,
      backgroundColor: '#d9d9d9',
      color: '#00000040',
      cursor: 'not-allowed',
    }
  }

  const colors = {
    BUY: '#0DC268',
    SELL: '#ED0A34',
  }

  return {
    ...base,
    backgroundColor: colors[props.tradeDirection],
    color: 'white',
  }
})

const handleClick = () => {
  if (!props.disabled && props.isMarketOpen) {
    emit('submit')
  }
}
</script>
```

**æ¡ˆä¾‹ 2ï¼šæå–æ»‘å—ç»„ä»¶**

```vue
<!-- Before: å†…è”æ»‘å—é€»è¾‘ -->
<template>
  <ZSlider
    ref="sliderRef"
    :defaultValue="[0]"
    :min="0"
    :max="100"
    :step="25"
    dots
    :markers="markers"
    @value-change="handleSliderChange"
  />
</template>

<script setup>
// 30+ è¡Œçš„æ»‘å—é€»è¾‘
const markers = { 0: '0', 25: '1/4', 50: '1/2', 75: '3/4', 100: '4/4' }

const handleSliderChange = (details) => {
  const [sliderValue] = details.value
  const { max_volume, step_volume, min_volume } = symbolInfo.value
  const lots = Math.round(((sliderValue / 100) * max_volume) / step_volume) * step_volume
  state.lots = Math.min(Math.max(min_volume, lots), max_volume)
}

const sliderRef = ref(null)
const resetSlider = () => sliderRef.value?.reset()
</script>

<!-- After: æå–ä¸ºå­ç»„ä»¶ -->
<template>
  <LotsSlider ref="lotsSliderRef" :symbolInfo="symbolInfo" @update:lots="state.lots = $event" />
</template>
```

```vue
<!-- LotsSlider.vue -->
<template>
  <ZSlider
    ref="sliderRef"
    v-if="symbolInfo?.max_volume"
    :defaultValue="[0]"
    :min="0"
    :max="100"
    :step="25"
    dots
    fixed="start"
    :markers="markers"
    @value-change="handleSliderChange"
  />
</template>

<script setup>
import { ref } from 'vue'
import { ZSlider } from '@/components'
import type { ValueChangeDetails } from '@/components/slider'
import type { MergeForexSymbol } from '@/store/symbolInfo'

const props = defineProps<{
  symbolInfo: MergeForexSymbol | null
}>()

const emit = defineEmits<{
  'update:lots': [number]
}>()

const markers = { 0: '0', 25: '1/4', 50: '1/2', 75: '3/4', 100: '4/4' }

const sliderRef = ref<InstanceType<typeof ZSlider> | null>(null)

const handleSliderChange = (details: ValueChangeDetails) => {
  if (!props.symbolInfo) return

  const [sliderValue] = details.value
  const { max_volume, step_volume, min_volume } = props.symbolInfo

  const lots = Math.round(
    ((sliderValue / 100) * max_volume) / step_volume
  ) * step_volume

  emit('update:lots', Math.min(Math.max(min_volume, lots), max_volume))
}

// æš´éœ²é‡ç½®æ–¹æ³•
defineExpose({
  reset: () => sliderRef.value?.reset()
})
</script>
```

#### 3.1.3 å­ç»„ä»¶è®¾è®¡åŸåˆ™

```typescript
/**
 * ä¼˜ç§€å­ç»„ä»¶çš„ç‰¹å¾
 */

// 1. æ¸…æ™°çš„ Props æ¥å£
interface GoodComponentProps {
  // âœ… å¿…éœ€çš„ props ç”¨ required
  data: DataType

  // âœ… å¯é€‰çš„ props æä¾›é»˜è®¤å€¼
  theme?: 'light' | 'dark' // default: 'light'

  // âœ… Props ç±»å‹æ˜ç¡®
  count: number
  items: Array<Item>

  // âŒ é¿å…ä¼ é€’æ•´ä¸ªå¯¹è±¡
  // config: Record<string, any>
}

// 2. æ˜ç¡®çš„ Emits å®šä¹‰
const emit = defineEmits<{
  // âœ… äº‹ä»¶åè¯­ä¹‰åŒ–
  'update:value': [value: string]
  'submit': [data: FormData]
  'error': [error: Error]

  // âŒ é¿å…æ¨¡ç³Šçš„äº‹ä»¶å
  // 'change': []
  // 'action': []
}>()

// 3. åˆç†çš„ Expose
defineExpose({
  // âœ… åªæš´éœ²å¿…è¦çš„æ–¹æ³•
  focus: () => inputRef.value?.focus()
  reset: () => form.value = initialValue

  // âŒ ä¸è¦æš´éœ²å†…éƒ¨çŠ¶æ€
  // _internalState: state
})

// 4. æ’æ§½çš„ä½¿ç”¨
<template>
  <!-- âœ… æä¾›å‘½åæ’æ§½å¢åŠ çµæ´»æ€§ -->
  <div class="card">
    <slot name="header" />
    <slot /> <!-- é»˜è®¤æ’æ§½ -->
    <slot name="footer" />
  </div>

  <!-- âœ… ä½œç”¨åŸŸæ’æ§½ä¼ é€’æ•°æ® -->
  <slot name="item" :item="item" :index="index" />
</template>
```

### 3.2 æ–¹æ³•äºŒï¼šä½¿ç”¨ Composableï¼ˆLogic Extractionï¼‰

#### 3.2.1 ä½•æ—¶ä½¿ç”¨ Composable

**Composable é€‚ç”¨åœºæ™¯ï¼š**

```typescript
// âœ… åº”è¯¥åˆ›å»º Composable çš„åœºæ™¯

1. å¯å¤ç”¨çš„çŠ¶æ€é€»è¾‘
   - å¤šä¸ªç»„ä»¶éœ€è¦ç›¸åŒçš„çŠ¶æ€ç®¡ç†
   - ä¾‹å¦‚ï¼šç”¨æˆ·è®¤è¯çŠ¶æ€ã€ä¸»é¢˜åˆ‡æ¢

2. å¤æ‚çš„è®¡ç®—é€»è¾‘
   - éœ€è¦å¤šä¸ªè®¡ç®—å±æ€§å’Œæ–¹æ³•ååŒå·¥ä½œ
   - ä¾‹å¦‚ï¼šè¡¨å•éªŒè¯ã€æ•°æ®è½¬æ¢

3. å¤–éƒ¨æ•°æ®æºç®¡ç†
   - WebSocketã€API è°ƒç”¨ã€æœ¬åœ°å­˜å‚¨
   - ä¾‹å¦‚ï¼šå®æ—¶æŠ¥ä»·ã€ç”¨æˆ·åå¥½è®¾ç½®

4. ç”Ÿå‘½å‘¨æœŸç›¸å…³é€»è¾‘
   - éœ€è¦åœ¨å¤šä¸ªç»„ä»¶ä¸­å¤ç”¨ç”Ÿå‘½å‘¨æœŸé€»è¾‘
   - ä¾‹å¦‚ï¼šé¡µé¢åŸ‹ç‚¹ã€æ€§èƒ½ç›‘æ§

5. å‰¯ä½œç”¨ç®¡ç†
   - éœ€è¦æ¸…ç†çš„å‰¯ä½œç”¨ï¼ˆå®šæ—¶å™¨ã€ç›‘å¬å™¨ï¼‰
   - ä¾‹å¦‚ï¼šè½®è¯¢ã€äº‹ä»¶ç›‘å¬

6. ä¸šåŠ¡é€»è¾‘å°è£…
   - å¤æ‚çš„ä¸šåŠ¡è§„åˆ™
   - ä¾‹å¦‚ï¼šè®¢å•è®¡ç®—ã€ä»·æ ¼ç­–ç•¥
```

#### 3.2.2 Composable æœ€ä½³å®è·µ

**æ ‡å‡† Composable æ¨¡æ¿ï¼š**

````typescript
/**
 * Composable å‘½åè§„èŒƒï¼šuse + åŠŸèƒ½æè¿°
 * ä¾‹å¦‚ï¼šuseQuoteManager, useFormValidator, useAuth
 */

import { ref, computed, watch, onUnmounted, type Ref } from 'vue'

// 1. å®šä¹‰æ¸…æ™°çš„ç±»å‹æ¥å£
export interface UseQuoteManagerOptions {
  /** å“ç§ä¿¡æ¯ */
  symbolInfo: Ref<SymbolInfo | null>
  /** æŠ¥ä»·å˜åŒ–å›è°ƒ */
  onQuoteChange?: (quote: Quote | null) => void
}

export interface UseQuoteManagerReturn {
  /** æŠ¥ä»·æ•°æ® */
  quote: Ref<Quote | null>
  /** ç®€åŒ–çš„æŠ¥ä»· */
  plainQuote: ComputedRef<PlainQuote | null>
  /** æŠ¥ä»·æ˜¯å¦æœ‰æ•ˆ */
  hasQuote: ComputedRef<boolean>
  /** é‡ç½®æŠ¥ä»· */
  resetQuote: () => void
}

/**
 * æŠ¥ä»·ç®¡ç† Composable
 *
 * @description
 * ç®¡ç†å®æ—¶æŠ¥ä»·æ•°æ®çš„è®¢é˜…ã€æ›´æ–°å’ŒéªŒè¯
 *
 * @example
 * ```ts
 * const { quote, hasQuote, resetQuote } = useQuoteManager({
 *   symbolInfo: computed(() => props.symbolInfo)
 * })
 * ```
 */
export function useQuoteManager(options: UseQuoteManagerOptions): UseQuoteManagerReturn {
  const { symbolInfo, onQuoteChange } = options

  // 2. å†…éƒ¨çŠ¶æ€ç®¡ç†
  const quote = ref<Quote | null>(null)

  // 3. è®¡ç®—å±æ€§
  const plainQuote = computed(() => {
    if (!quote.value) return null
    const { bid, ask } = quote.value
    return { bid, ask }
  })

  const hasQuote = computed(() => {
    if (!quote.value) return false
    const { ask, bid } = quote.value
    return Number.isFinite(ask) && ask !== 0 && Number.isFinite(bid) && bid !== 0
  })

  // 4. æ–¹æ³•
  const resetQuote = () => {
    quote.value = null
  }

  const updateQuote = (newQuote: Quote) => {
    quote.value = newQuote
    onQuoteChange?.(newQuote)
  }

  // 5. å‰¯ä½œç”¨ç®¡ç†ï¼ˆwatch, onMounted, onUnmountedï¼‰
  watch(
    () => symbolInfo.value,
    (newSymbol, oldSymbol) => {
      if (newSymbol !== oldSymbol) {
        resetQuote()
      }
    },
  )

  // 6. æ¸…ç†å‡½æ•°
  onUnmounted(() => {
    // æ¸…ç†å‰¯ä½œç”¨
    resetQuote()
  })

  // 7. è¿”å›å…¬å…± API
  return {
    quote,
    plainQuote,
    hasQuote,
    resetQuote,
  }
}
````

**Composable ç»„åˆæ¨¡å¼ï¼š**

```typescript
/**
 * æ¨¡å¼ 1ï¼šåŸºç¡€ Composable
 * æä¾›å•ä¸€ã€åŸå­åŒ–çš„åŠŸèƒ½
 */

// useCounter.ts
export function useCounter(initial = 0) {
  const count = ref(initial)
  const increment = () => count.value++
  const decrement = () => count.value--
  const reset = () => (count.value = initial)

  return { count, increment, decrement, reset }
}

/**
 * æ¨¡å¼ 2ï¼šç»„åˆ Composable
 * ç»„åˆå¤šä¸ªåŸºç¡€ Composable
 */

// useShoppingCart.ts
export function useShoppingCart() {
  const { count, increment, decrement } = useCounter(0)
  const { items, addItem, removeItem } = useItems([])
  const { total, calculate } = useCalculator()

  // ç»„åˆé€»è¾‘
  const addToCart = (item: Item) => {
    addItem(item)
    increment()
    calculate()
  }

  return {
    itemCount: count,
    items,
    total,
    addToCart,
  }
}

/**
 * æ¨¡å¼ 3ï¼šé«˜é˜¶ Composable
 * æ¥æ”¶ Composable ä½œä¸ºå‚æ•°
 */

// useWithLoading.ts
export function useWithLoading<T extends (...args: any[]) => Promise<any>>(asyncFn: T) {
  const loading = ref(false)
  const error = ref<Error | null>(null)

  const execute = async (...args: Parameters<T>) => {
    loading.value = true
    error.value = null

    try {
      const result = await asyncFn(...args)
      return result
    } catch (e) {
      error.value = e as Error
      throw e
    } finally {
      loading.value = false
    }
  }

  return { loading, error, execute }
}
```

#### 3.2.3 Composable vs å­ç»„ä»¶é€‰æ‹©æŒ‡å—

```typescript
/**
 * å†³ç­–æ ‘ï¼šä½•æ—¶ç”¨ Composable vs å­ç»„ä»¶
 */

// é€‰æ‹© Composable çš„æƒ…å†µ
const shouldUseComposable = (scenario) => {
  return (
    scenario.needsLogicReuse ||           // éœ€è¦é€»è¾‘å¤ç”¨
    scenario.hasNoUI ||                   // æ—  UI æ¸²æŸ“
    scenario.managesExternalData ||       // ç®¡ç†å¤–éƒ¨æ•°æ®
    scenario.providesUtilityFunctions ||  // æä¾›å·¥å…·å‡½æ•°
    scenario.handlesLifecycle             // å¤„ç†ç”Ÿå‘½å‘¨æœŸ
  )
}

// é€‰æ‹©å­ç»„ä»¶çš„æƒ…å†µ
const shouldUseComponent = (scenario) => {
  return (
    scenario.hasUIRendering ||            // æœ‰ UI æ¸²æŸ“
    scenario.needsSlots ||                // éœ€è¦æ’æ§½
    scenario.hasTemplateLogic ||          // æœ‰æ¨¡æ¿é€»è¾‘
    scenario.representsVisualElement ||   // ä»£è¡¨å¯è§†å…ƒç´ 
    scenario.needsCSS                     // éœ€è¦æ ·å¼
  )
}

// å®é™…æ¡ˆä¾‹
// âœ… ä½¿ç”¨ Composable
useQuoteManager()      // ç®¡ç†æŠ¥ä»·æ•°æ®ï¼ˆæ—  UIï¼‰
useFormValidator()     // è¡¨å•éªŒè¯é€»è¾‘ï¼ˆæ—  UIï¼‰
useWebSocket()         // WebSocket è¿æ¥ï¼ˆæ—  UIï¼‰

// âœ… ä½¿ç”¨ç»„ä»¶
<SubmitButton />       // æŒ‰é’®ï¼ˆæœ‰ UIï¼‰
<LoadingSpinner />     // åŠ è½½åŠ¨ç”»ï¼ˆæœ‰ UIï¼‰
<DataTable />          // æ•°æ®è¡¨æ ¼ï¼ˆæœ‰ UIï¼‰

// ğŸ¤” å¯ä»¥ç»„åˆä½¿ç”¨
<script setup>
// Composable æä¾›é€»è¾‘
const { data, loading, error } = useDataFetcher()

// ç»„ä»¶è´Ÿè´£æ¸²æŸ“
</script>

<template>
  <LoadingSpinner v-if="loading" />
  <ErrorMessage v-else-if="error" :error="error" />
  <DataTable v-else :data="data" />
</template>
```

---

## å››ã€å®æˆ˜ï¼šäº¤æ˜“é¢æ¿ç»„ä»¶é‡æ„æ¡ˆä¾‹

### 4.1 é‡æ„å‰çš„é—®é¢˜åˆ†æ

```vue
<!-- TradePanel.vue - é‡æ„å‰ï¼š514 è¡Œ -->
<template>
  <div class="trade-panel">
    <!-- å¸‚åœºçŠ¶æ€æ£€æŸ¥ï¼ˆ50 è¡Œï¼‰ -->
    <template v-if="!statusLoaded">...</template>
    <template v-else-if="!isMarketOpen">...</template>
    <template v-else>
      <!-- å¤´éƒ¨ä¿¡æ¯ï¼ˆ20 è¡Œï¼‰ -->
      <div class="header">...</div>

      <!-- ä¹°å–æŒ‰é’®ï¼ˆ30 è¡Œï¼‰ -->
      <div class="buttons">...</div>

      <!-- æ‰‹æ•°æ»‘å—ï¼ˆ40 è¡Œï¼‰ -->
      <div class="lots-slider">...</div>

      <!-- æ­¢ç›ˆæ­¢æŸï¼ˆ80 è¡Œ x 2 = 160 è¡Œï¼Œé‡å¤ä»£ç ï¼‰-->
      <div class="take-profit">...</div>
      <div class="stop-loss">...</div>

      <!-- æäº¤æŒ‰é’®ï¼ˆ40 è¡Œï¼‰ -->
      <button>...</button>

      <!-- è´¦æˆ·ä¿¡æ¯ï¼ˆ30 è¡Œï¼‰ -->
      <div class="account-info">...</div>
    </template>
  </div>
</template>

<script setup>
// é—®é¢˜æ¸…å•ï¼š
// 1. å¸‚åœºçŠ¶æ€ç®¡ç†é€»è¾‘ï¼ˆ50 è¡Œï¼‰
// 2. æŠ¥ä»·è®¢é˜…å’Œç®¡ç†ï¼ˆ60 è¡Œï¼‰
// 3. æ­¢ç›ˆæ­¢æŸé€»è¾‘ï¼ˆ150 è¡Œï¼Œé‡å¤ï¼‰
// 4. è®¢å•æ„å»ºå’ŒéªŒè¯ï¼ˆ70 è¡Œï¼‰
// 5. æ‰‹æ•°è®¡ç®—ï¼ˆ30 è¡Œï¼‰
// 6. æŒ‰é’®çŠ¶æ€ç®¡ç†ï¼ˆ40 è¡Œï¼‰
// 7. å¤§é‡çš„ watch ç›‘å¬ï¼ˆ60 è¡Œï¼‰
// æ€»è®¡ï¼š460+ è¡Œä¸šåŠ¡é€»è¾‘
</script>
```

### 4.2 é‡æ„ç­–ç•¥è§„åˆ’

```typescript
/**
 * é‡æ„ç­–ç•¥è·¯çº¿å›¾
 */

// ç¬¬ 1 æ­¥ï¼šåˆ†æèŒè´£ï¼Œç»˜åˆ¶ä¾èµ–å›¾
const componentAnalysis = {
  responsibilities: ['å¸‚åœºçŠ¶æ€ç®¡ç†', 'æŠ¥ä»·æ•°æ®ç®¡ç†', 'SLTP ç®¡ç†', 'è®¢å•æ„å»º', 'UI æ¸²æŸ“'],
  dependencies: {
    'UI æ¸²æŸ“': ['å¸‚åœºçŠ¶æ€', 'æŠ¥ä»·æ•°æ®', 'SLTP çŠ¶æ€'],
    è®¢å•æ„å»º: ['æŠ¥ä»·æ•°æ®', 'SLTP çŠ¶æ€', 'è¡¨å•æ•°æ®'],
    'SLTP ç®¡ç†': ['æŠ¥ä»·æ•°æ®', 'äº¤æ˜“æ–¹å‘'],
  },
}

// ç¬¬ 2 æ­¥ï¼šç¡®å®šæå–ä¼˜å…ˆçº§
const refactoringPriority = [
  { order: 1, target: 'å¸‚åœºçŠ¶æ€ç®¡ç†', reason: 'ç‹¬ç«‹æ€§å¼ºï¼Œå½±å“èŒƒå›´å°' },
  { order: 2, target: 'æäº¤æŒ‰é’®', reason: 'ç®€å•ï¼Œå¿«é€Ÿè§æ•ˆ' },
  { order: 3, target: 'è®¢å•æ„å»º', reason: 'ä¸šåŠ¡é€»è¾‘ï¼Œå¯å¤ç”¨æ€§é«˜' },
  { order: 4, target: 'æ‰‹æ•°æ»‘å—', reason: 'UI ç»„ä»¶ï¼Œå°è£…æ€§å¥½' },
  { order: 5, target: 'æŠ¥ä»·ç®¡ç†', reason: 'æ ¸å¿ƒæ•°æ®ï¼Œå½±å“é¢å¤§' },
  { order: 6, target: 'SLTP ç®¡ç†', reason: 'æœ€å¤æ‚ï¼Œæ”¶ç›Šæœ€å¤§' },
]

// ç¬¬ 3 æ­¥ï¼šåˆ¶å®šé‡æ„è®¡åˆ’
const refactoringPlan = [
  {
    phase: 'ç¬¬ä¸€é˜¶æ®µ',
    goal: 'å¿«é€Ÿè§æ•ˆï¼Œå»ºç«‹ä¿¡å¿ƒ',
    tasks: ['æå– MarketStatusWrapper ç»„ä»¶', 'æå– SubmitButton ç»„ä»¶'],
    expectedReduction: '~90 è¡Œ',
  },
  {
    phase: 'ç¬¬äºŒé˜¶æ®µ',
    goal: 'æ ¸å¿ƒé€»è¾‘é‡æ„',
    tasks: ['åˆ›å»º useOrderBuilder composable', 'åˆ›å»º useQuoteManager composable'],
    expectedReduction: '~125 è¡Œ',
  },
  {
    phase: 'ç¬¬ä¸‰é˜¶æ®µ',
    goal: 'æ¶ˆé™¤é‡å¤ï¼Œå¤§å¹…ç²¾ç®€',
    tasks: ['æå– LotsSlider ç»„ä»¶', 'åˆ›å»º SLTPManager ç»„ä»¶'],
    expectedReduction: '~110 è¡Œ',
  },
]
```

### 4.3 å…·ä½“é‡æ„æ­¥éª¤

#### æ­¥éª¤ 1ï¼šæå–å¸‚åœºçŠ¶æ€ç®¡ç†

```vue
<!-- Before: å†…è”å¸‚åœºçŠ¶æ€é€»è¾‘ -->
<template>
  <div class="trade-panel">
    <!-- å¸‚åœºçŠ¶æ€æœªçŸ¥ -->
    <template v-if="!statusLoaded">
      <div class="loading">
        <a-spin />
      </div>
    </template>

    <!-- å¸‚åœºå…³é—­ -->
    <template v-else-if="!nextOpen?.isOpen">
      <MarketClosedPane :nextOpenAt="nextOpen?.nextOpen" />
    </template>

    <!-- å¸‚åœºå¼€æ”¾ -->
    <template v-else>
      <!-- äº¤æ˜“è¡¨å•å†…å®¹ -->
    </template>
  </div>
</template>

<script setup>
const marketCalendarStore = useMarketCalendarStore()
const { allSymbolMarketStatus } = storeToRefs(marketCalendarStore)

const nextOpen = computed(() => allSymbolMarketStatus.value[props.symbolInfo?.symbol ?? ''] || null)
const statusLoaded = computed(
  () => allSymbolMarketStatus.value[props.symbolInfo?.symbol ?? ''] !== undefined,
)
// ... 30+ è¡Œç›¸å…³é€»è¾‘
</script>

<!-- After: æå–ä¸ºç‹¬ç«‹ç»„ä»¶ -->
<template>
  <MarketStatusWrapper :symbolInfo="symbolInfo" v-slot="{ isMarketOpen }">
    <!-- äº¤æ˜“è¡¨å•å†…å®¹ -->
    <TradingForm :isMarketOpen="isMarketOpen" />
  </MarketStatusWrapper>
</template>
```

```vue
<!-- MarketStatusWrapper.vue - 47 è¡Œ -->
<template>
  <div class="wrapper">
    <template v-if="!statusLoaded">
      <LoadingState />
    </template>
    <template v-else-if="!nextOpen?.isOpen">
      <MarketClosedPane :nextOpenAt="nextOpen?.nextOpen" />
    </template>
    <template v-else>
      <slot :isMarketOpen="nextOpen?.isOpen ?? false" />
    </template>
  </div>
</template>

<script setup>
import { computed } from 'vue'
import { useMarketCalendarStore } from '@/store'
import { storeToRefs } from 'pinia'

const props = defineProps<{
  symbolInfo: SymbolInfo | null
}>()

const marketCalendarStore = useMarketCalendarStore()
const { allSymbolMarketStatus } = storeToRefs(marketCalendarStore)

const nextOpen = computed(() =>
  allSymbolMarketStatus.value[props.symbolInfo?.symbol ?? ''] || null
)

const statusLoaded = computed(() =>
  allSymbolMarketStatus.value[props.symbolInfo?.symbol ?? ''] !== undefined
)
</script>
```

**æ”¶ç›Šï¼š**

- âœ… å‡å°‘ 50 è¡Œä»£ç 
- âœ… å¸‚åœºçŠ¶æ€é€»è¾‘å®Œå…¨ç‹¬ç«‹
- âœ… å¯åœ¨å…¶ä»–éœ€è¦å¸‚åœºçŠ¶æ€æ£€æŸ¥çš„åœ°æ–¹å¤ç”¨

#### æ­¥éª¤ 2ï¼šåˆ›å»ºæŠ¥ä»·ç®¡ç† Composable

```typescript
// Before: å†…è”æŠ¥ä»·ç®¡ç†ï¼ˆ60+ è¡Œï¼‰
const state = reactive({
  quote: null as Quote | null,
})

const plainQuote = computed(() => {
  if (!state.quote) return null
  return { bid: state.quote.bid, ask: state.quote.ask }
})

const hasQuote = computed(() => {
  if (!state.quote) return false
  const { ask, bid } = state.quote
  return Number.isFinite(ask) && ask !== 0 && Number.isFinite(bid) && bid !== 0
})

watch(
  () => socketStore.quoteTick,
  () => {
    const symbol = props.symbolInfo?.symbol
    if (!symbol) return
    const quote = socketStore.lastQuoteMap.get(symbol)
    if (quote) {
      state.quote = { ...quote }
    }
  },
  { immediate: true },
)

watch(
  () => props.symbolInfo,
  (newSymbol, oldSymbol) => {
    if (newSymbol !== oldSymbol) {
      state.quote = null
    }
  },
)

// After: ä½¿ç”¨ Composableï¼ˆ1 è¡Œï¼‰
const { quote, plainQuote, hasQuote } = useQuoteManager({
  symbolInfo: computed(() => props.symbolInfo),
})
```

```typescript
// useQuoteManager.ts - 137 è¡Œ
import { ref, computed, watch, type Ref } from 'vue'
import { useSocketStore } from '@/store'
import type { SymbolInfo, Quote } from '@/types'

export interface UseQuoteManagerOptions {
  symbolInfo: Ref<SymbolInfo | null>
  onQuoteChange?: (quote: Quote | null) => void
}

export function useQuoteManager(options: UseQuoteManagerOptions) {
  const { symbolInfo, onQuoteChange } = options
  const socketStore = useSocketStore()

  const quote = ref<Quote | null>(null)

  const plainQuote = computed(() => {
    if (!quote.value) return null
    const { bid, ask } = quote.value
    return { bid, ask }
  })

  const hasQuote = computed(() => {
    if (!quote.value) return false
    const { ask, bid } = quote.value
    return Number.isFinite(ask) && ask !== 0 && Number.isFinite(bid) && bid !== 0
  })

  const resetQuote = () => {
    quote.value = null
  }

  // ç›‘å¬ socket æ›´æ–°
  watch(
    () => socketStore.quoteTick,
    () => {
      const symbol = symbolInfo.value?.symbol
      if (!symbol) return

      const quoteData = socketStore.lastQuoteMap.get(symbol)
      if (quoteData) {
        quote.value = { ...quoteData }
      }
    },
    { immediate: true },
  )

  // ç›‘å¬å“ç§å˜åŒ–
  watch(
    () => symbolInfo.value,
    (newSymbol, oldSymbol) => {
      if (newSymbol !== oldSymbol) {
        resetQuote()
      }
    },
  )

  // è§¦å‘å›è°ƒ
  if (onQuoteChange) {
    watch(() => quote.value, onQuoteChange)
  }

  return {
    quote,
    plainQuote,
    hasQuote,
    resetQuote,
  }
}
```

**æ”¶ç›Šï¼š**

- âœ… å‡å°‘ 59 è¡Œä»£ç 
- âœ… æŠ¥ä»·é€»è¾‘å¯åœ¨ä»»ä½•éœ€è¦æŠ¥ä»·çš„ç»„ä»¶ä¸­ä½¿ç”¨
- âœ… æ”¯æŒå›è°ƒï¼Œçµæ´»æ€§é«˜
- âœ… è‡ªåŠ¨ç®¡ç†å“ç§åˆ‡æ¢

#### æ­¥éª¤ 3ï¼šåˆ›å»º SLTP ç®¡ç†ç»„ä»¶

```vue
<!-- Before: é‡å¤çš„æ­¢ç›ˆæ­¢æŸé€»è¾‘ï¼ˆ160+ è¡Œï¼‰ -->
<template>
  <!-- æ­¢ç›ˆ -->
  <LazyScope :when="hasQuote" :factory="createTakeProfitContext">
    <template #default="takeProfitScope">
      <SLTPField
        v-model="takeProfitState.inputDecimalValue"
        v-model:enabled="takeProfitState.enabled"
        :config="takeProfitScope.config"
        :range="takeProfitScope.range"
      />
    </template>
  </LazyScope>

  <!-- æ­¢æŸ -->
  <LazyScope :when="hasQuote" :factory="createStopLossContext">
    <template #default="stopLossScope">
      <SLTPField
        v-model="stopLossState.inputDecimalValue"
        v-model:enabled="stopLossState.enabled"
        :config="stopLossScope.slConfig"
        :range="stopLossScope.range"
      />
    </template>
  </LazyScope>
</template>

<script setup>
// 80+ è¡Œçš„ takeProfitState ç®¡ç†
// 80+ è¡Œçš„ stopLossState ç®¡ç†
// ä¸¤è€…é€»è¾‘å‡ ä¹ä¸€æ ·ï¼
</script>

<!-- After: æå–ä¸ºç»Ÿä¸€ç»„ä»¶ï¼ˆ10 è¡Œï¼‰ -->
<template>
  <SLTPManager
    ref="sltpManagerRef"
    :tradeDirection="state.tradeDirection"
    :plainQuote="plainQuote"
    :hasQuote="hasQuote"
    :symbolInfo="symbolInfo"
    :orderType="state.orderType"
    :lots="state.lots"
    :limitPrice="state.limitPrice"
  />
</template>
```

```vue
<!-- SLTPManager.vue - 168 è¡Œ -->
<template>
  <div>
    <!-- æ­¢ç›ˆ -->
    <LazyScope :when="hasQuote" :factory="createTakeProfitContext">
      <template #default="scope">
        <SLTPField
          :key="`tp-${tradeDirection}`"
          v-model="takeProfitState.inputDecimalValue"
          v-model:enabled="takeProfitState.enabled"
          v-model:errorMessages="takeProfitState.errors"
          v-model:disabled="takeProfitState.disabled"
          v-model:valueMode="takeProfitState.valueMode"
          :config="scope.config"
          :range="scope.range"
          :previewPnL="scope.previewPnL"
        />
      </template>
    </LazyScope>

    <div class="spacing" />

    <!-- æ­¢æŸ -->
    <LazyScope :when="hasQuote" :factory="createStopLossContext">
      <template #default="scope">
        <SLTPField
          :key="`sl-${tradeDirection}`"
          v-model="stopLossState.inputDecimalValue"
          v-model:enabled="stopLossState.enabled"
          v-model:errorMessages="stopLossState.errors"
          v-model:disabled="stopLossState.disabled"
          v-model:valueMode="stopLossState.valueMode"
          :config="scope.slConfig"
          :range="scope.range"
          :previewPnL="scope.previewPnL"
        />
      </template>
    </LazyScope>
  </div>
</template>

<script setup>
import { reactive, computed, watch } from 'vue'
import { useSltpControllerPro } from '@/composables/sltp'
import {
  ExitType,
  RelativeBase,
  SLTPMode,
  Scenario,
  TradeDirection,
  OrderType,
} from '@/composables/sltp'

const props = defineProps<{
  tradeDirection: TradeDirection
  plainQuote: PlainQuote | null
  hasQuote: boolean
  symbolInfo: SymbolInfo | null
  orderType: OrderType
  lots: number | undefined
  limitPrice?: number
}>()

// ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†
const takeProfitState = reactive<SLTPState>({
  inputDecimalValue: null,
  enabled: false,
  errors: [],
  disabled: false,
  valueMode: SLTPMode.PRICE,
})

const stopLossState = reactive<SLTPState>({
  inputDecimalValue: null,
  enabled: false,
  errors: [],
  disabled: false,
  valueMode: SLTPMode.PRICE,
})

const scenario = computed<Scenario>(() => {
  switch (props.orderType) {
    case OrderType.MARKET: return Scenario.MARKET_ORDER
    case OrderType.LIMIT: return Scenario.LIMIT_ORDER
    default: return Scenario.POSITION
  }
})

// å·¥å‚å‡½æ•°
const createTakeProfitContext = () => {
  return useSltpControllerPro({
    tradeDirection: props.tradeDirection,
    exitType: ExitType.TAKE_PROFIT,
    quote: computed(() => props.plainQuote),
    limitPrice: props.limitPrice,
    symbolSpecification: props.symbolInfo,
    scenario: scenario,
    lots: props.lots,
    valueMode: takeProfitState.valueMode,
    relativeBase: RelativeBase.MID,
  })
}

const createStopLossContext = () => {
  return useSltpControllerPro({
    quote: computed(() => props.plainQuote),
    symbolSpecification: props.symbolInfo,
    scenario: scenario,
    tradeDirection: props.tradeDirection,
    exitType: ExitType.STOP_LOSS,
    lots: props.lots,
    limitPrice: props.limitPrice,
    valueMode: stopLossState.valueMode,
    relativeBase: RelativeBase.MID,
  })
}

// è‡ªåŠ¨é‡ç½®
watch(
  () => props.tradeDirection,
  () => {
    takeProfitState.inputDecimalValue = null
    stopLossState.inputDecimalValue = null
    takeProfitState.errors = []
    stopLossState.errors = []
  }
)

// æš´éœ²çŠ¶æ€
defineExpose({
  takeProfitState,
  stopLossState,
})
</script>
```

**æ”¶ç›Šï¼š**

- âœ… å‡å°‘ 90 è¡Œä»£ç 
- âœ… æ¶ˆé™¤é‡å¤é€»è¾‘
- âœ… ç»Ÿä¸€ç®¡ç†æ­¢ç›ˆæ­¢æŸ
- âœ… è‡ªåŠ¨å¤„ç†äº¤æ˜“æ–¹å‘å˜åŒ–

### 4.4 é‡æ„æˆæœ

```typescript
/**
 * é‡æ„å‰åå¯¹æ¯”
 */

// Before
const TradePanelBefore = {
  lineCount: 514,
  components: 1,
  composables: 0,
  concerns: ['å¸‚åœºçŠ¶æ€', 'æŠ¥ä»·ç®¡ç†', 'SLTP ç®¡ç†', 'è®¢å•æ„å»º', 'è¡¨å•éªŒè¯', 'UI æ¸²æŸ“', 'äº‹ä»¶å¤„ç†']
    .length, // 7 ä¸ªèŒè´£

  maintainability: 'å·®',
  reusability: 'ä½',
  testability: 'éš¾',
}

// After
const TradePanelAfter = {
  lineCount: 217,
  components: 5, // MarketStatusWrapper, SubmitButton, LotsSlider, SLTPManager, OrderTypeSwitch
  composables: 2, // useQuoteManager, useOrderBuilder
  concerns: ['ç»„ä»¶ç¼–æ’', 'çŠ¶æ€åè°ƒ'].length, // 2 ä¸ªèŒè´£

  maintainability: 'ä¼˜ç§€',
  reusability: 'é«˜',
  testability: 'æ˜“',
}

// æå–çš„å¯å¤ç”¨èµ„æº
const extractedAssets = {
  components: [
    { name: 'MarketStatusWrapper', lines: 47, reusable: true },
    { name: 'SubmitButton', lines: 82, reusable: true },
    { name: 'LotsSlider', lines: 64, reusable: true },
    { name: 'SLTPManager', lines: 168, reusable: true },
    { name: 'OrderTypeSwitch', lines: 25, reusable: true },
  ],
  composables: [
    { name: 'useQuoteManager', lines: 137, reusable: true },
    { name: 'useOrderBuilder', lines: 186, reusable: true },
  ],
  totalExtractedLines: 709,
  parentComponentLines: 217,
  reduction: '57.8%',
  reusablePotential: 'Very High',
}
```

---

## äº”ã€ç»„ä»¶ç²¾ç®€çš„æœ€ä½³å®è·µ

### 5.1 å‘½åè§„èŒƒ

```typescript
/**
 * å‘½åè§„èŒƒæŒ‡å—
 */

// 1. ç»„ä»¶å‘½åï¼šPascalCase
// âœ… å¥½çš„å‘½å
MarketStatusWrapper.vue    // è¯­ä¹‰æ¸…æ™°
SubmitButton.vue          // åŠŸèƒ½æ˜ç¡®
SLTPManager.vue          // èŒè´£æ¸…æ¥š

// âŒ é¿å…çš„å‘½å
wrapper.vue               // å¤ªæ³›åŒ–
btn.vue                  // ç¼©å†™ä¸æ¸…æ™°
component1.vue           // æ— æ„ä¹‰

// 2. Composable å‘½åï¼šuse + åŠŸèƒ½ + ç±»å‹
// âœ… å¥½çš„å‘½å
useQuoteManager.ts       // use + Quote + Manager
useFormValidator.ts      // use + Form + Validator
useDataFetcher.ts       // use + Data + Fetcher

// âŒ é¿å…çš„å‘½å
quote.ts                 // ç¼ºå°‘ use å‰ç¼€
useData.ts              // å¤ªæ³›åŒ–
useStuff.ts             // æ— æ„ä¹‰

// 3. æ–‡ä»¶ç»„ç»‡
src/
â”œâ”€â”€ components/           # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”œâ”€â”€ Button.vue
â”‚   â”‚   â”œâ”€â”€ Button.test.ts
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ composables/         # é€šç”¨ Composables
â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”œâ”€â”€ useTheme.ts
â”‚   â””â”€â”€ index.ts
â””â”€â”€ views/
    â””â”€â”€ trading/
        â”œâ”€â”€ components/  # é¡µé¢çº§ç»„ä»¶
        â”‚   â”œâ”€â”€ TradePanel.vue
        â”‚   â”œâ”€â”€ SLTPManager.vue
        â”‚   â””â”€â”€ index.ts
        â””â”€â”€ composables/ # é¡µé¢çº§ Composables
            â”œâ”€â”€ useOrderBuilder.ts
            â””â”€â”€ index.ts
```

### 5.2 Props è®¾è®¡åŸåˆ™

```typescript
/**
 * Props è®¾è®¡æœ€ä½³å®è·µ
 */

// âœ… åŸåˆ™ 1ï¼šå•ä¸€æ•°æ®æµ
// å¥½ï¼šåªæ¥æ”¶å¿…éœ€çš„æ•°æ®
defineProps<{
  symbolInfo: SymbolInfo
  tradeDirection: TradeDirection
}>()

// å·®ï¼šæ¥æ”¶æ•´ä¸ªå¯¹è±¡
defineProps<{
  parentState: Record<string, any> // âŒ å¤ªæ³›åŒ–
}>()

// âœ… åŸåˆ™ 2ï¼šæ˜ç¡®çš„ç±»å‹å®šä¹‰
// å¥½ï¼šä½¿ç”¨å…·ä½“ç±»å‹
interface ButtonProps {
  type: 'primary' | 'secondary' | 'danger' // è”åˆç±»å‹
  size: 'small' | 'medium' | 'large'
  disabled?: boolean // å¯é€‰å±æ€§
  loading?: boolean
}

// å·®ï¼šä½¿ç”¨å®½æ³›ç±»å‹
interface BadProps {
  config: any // âŒ é¿å… any
  options: object // âŒ object å¤ªå®½æ³›
}

// âœ… åŸåˆ™ 3ï¼šæä¾›åˆç†çš„é»˜è®¤å€¼
const props = withDefaults(
  defineProps<{
    size?: 'small' | 'medium' | 'large'
    theme?: 'light' | 'dark'
  }>(),
  {
    size: 'medium',
    theme: 'light',
  },
)

// âœ… åŸåˆ™ 4ï¼šä½¿ç”¨ validator
defineProps<{
  count: number
}>({
  count: {
    type: Number,
    required: true,
    validator: (value: number) => value >= 0,
  },
})

// âœ… åŸåˆ™ 5ï¼šé¿å… Prop çªå˜
// å¥½ï¼šé€šè¿‡ emit ä¿®æ”¹
const emit = defineEmits<{
  'update:value': [value: string]
}>()

const updateValue = (newValue: string) => {
  emit('update:value', newValue)
}

// å·®ï¼šç›´æ¥ä¿®æ”¹ prop
const props = defineProps<{ value: string }>()
// props.value = 'new value'  // âŒ ä¸è¦è¿™æ ·åš
```

### 5.3 Composable è®¾è®¡åŸåˆ™

```typescript
/**
 * Composable è®¾è®¡æœ€ä½³å®è·µ
 */

// âœ… åŸåˆ™ 1ï¼šçº¯å‡½æ•°ä¼˜å…ˆ
// å¥½ï¼šæ— å‰¯ä½œç”¨ï¼Œå¯é¢„æµ‹
export function useCounter(initial = 0) {
  const count = ref(initial)
  const increment = () => count.value++
  const decrement = () => count.value--
  const reset = () => (count.value = initial)

  return { count, increment, decrement, reset }
}

// âœ… åŸåˆ™ 2ï¼šæ˜ç¡®çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹
export interface UseDataFetcherOptions<T> {
  url: string | Ref<string>
  params?: Record<string, any>
  immediate?: boolean
  onSuccess?: (data: T) => void
  onError?: (error: Error) => void
}

export interface UseDataFetcherReturn<T> {
  data: Ref<T | null>
  loading: Ref<boolean>
  error: Ref<Error | null>
  execute: () => Promise<T>
  refresh: () => Promise<T>
}

export function useDataFetcher<T>(options: UseDataFetcherOptions<T>): UseDataFetcherReturn<T> {
  // å®ç°
}

// âœ… åŸåˆ™ 3ï¼šæ¸…ç†å‰¯ä½œç”¨
export function useEventListener(
  target: Ref<EventTarget | null>,
  event: string,
  handler: EventListener,
) {
  let cleanup: (() => void) | null = null

  const setupListener = () => {
    if (!target.value) return

    target.value.addEventListener(event, handler)

    cleanup = () => {
      target.value?.removeEventListener(event, handler)
    }
  }

  onMounted(setupListener)

  onUnmounted(() => {
    cleanup?.()
  })

  // ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ¸…ç†
  return {
    cleanup: () => cleanup?.(),
  }
}

// âœ… åŸåˆ™ 4ï¼šæ”¯æŒ SSR
export function useLocalStorage<T>(key: string, defaultValue: T) {
  // æ£€æŸ¥æ˜¯å¦åœ¨æµè§ˆå™¨ç¯å¢ƒ
  const isBrowser = typeof window !== 'undefined'

  const stored = isBrowser ? localStorage.getItem(key) : null

  const value = ref<T>(stored ? JSON.parse(stored) : defaultValue)

  watch(
    value,
    (newValue) => {
      if (isBrowser) {
        localStorage.setItem(key, JSON.stringify(newValue))
      }
    },
    { deep: true },
  )

  return value
}

// âœ… åŸåˆ™ 5ï¼šå¯æµ‹è¯•æ€§
// å¥½ï¼šä¾èµ–æ³¨å…¥ï¼Œä¾¿äºæµ‹è¯•
export function useOrderBuilder(dependencies: {
  getPrice: (direction: string) => number
  validateForm: () => boolean
}) {
  const { getPrice, validateForm } = dependencies

  const buildOrder = () => {
    if (!validateForm()) return null
    const price = getPrice('BUY')
    return { price }
  }

  return { buildOrder }
}

// æµ‹è¯•æ—¶å¯ä»¥æ³¨å…¥ mock
const { buildOrder } = useOrderBuilder({
  getPrice: vi.fn(() => 100),
  validateForm: vi.fn(() => true),
})
```

### 5.4 æ€§èƒ½ä¼˜åŒ–

```typescript
/**
 * æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ
 */

// âœ… æŠ€å·§ 1ï¼šä½¿ç”¨ computed ç¼“å­˜è®¡ç®—
// å¥½ï¼šä½¿ç”¨ computed
const expensiveValue = computed(() => {
  return props.items.reduce((sum, item) => sum + item.price, 0)
})

// å·®ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½è®¡ç®—
const getExpensiveValue = () => {
  return props.items.reduce((sum, item) => sum + item.price, 0)
}

// âœ… æŠ€å·§ 2ï¼šé¿å…ä¸å¿…è¦çš„å“åº”å¼
// å¥½ï¼šåªå¯¹éœ€è¦å“åº”å¼çš„æ•°æ®ä½¿ç”¨ ref/reactive
const config = {  // é™æ€é…ç½®ï¼Œä¸éœ€è¦å“åº”å¼
  timeout: 3000,
  retries: 3,
}

const data = ref<Data | null>(null)  // éœ€è¦å“åº”å¼

// å·®ï¼šæ‰€æœ‰æ•°æ®éƒ½ç”¨ reactive
const state = reactive({
  config: { timeout: 3000, retries: 3 },  // ä¸éœ€è¦å“åº”å¼
  data: null,
})

// âœ… æŠ€å·§ 3ï¼šä½¿ç”¨ shallowRef/shallowReactive
// å¥½ï¼šå¤§å‹æ•°æ®ç»“æ„ä½¿ç”¨ shallowRef
const largeList = shallowRef<Item[]>([])

// æ›´æ–°æ—¶éœ€è¦åˆ›å»ºæ–°å¼•ç”¨
largeList.value = [...largeList.value, newItem]

// âœ… æŠ€å·§ 4ï¼šåˆç†ä½¿ç”¨ watch
// å¥½ï¼šä½¿ç”¨ watchEffect è‡ªåŠ¨è¿½è¸ªä¾èµ–
watchEffect(() => {
  console.log(props.count, props.name)
})

// å¥½ï¼šæ˜ç¡®æŒ‡å®šç›‘å¬æº
watch(
  () => props.count,
  (newValue) => {
    console.log(newValue)
  }
)

// å·®ï¼šç›‘å¬æ•´ä¸ªå¯¹è±¡
watch(
  props,  // âŒ ç›‘å¬æ‰€æœ‰ props
  () => {
    // ...
  }
)

// âœ… æŠ€å·§ 5ï¼šæŒ‰éœ€å¯¼å…¥
// å¥½ï¼šåªå¯¼å…¥éœ€è¦çš„å‡½æ•°
import { ref, computed } from 'vue'

// å·®ï¼šå¯¼å…¥æ•´ä¸ªåº“
import * as Vue from 'vue'

// âœ… æŠ€å·§ 6ï¼šä½¿ç”¨ defineAsyncComponent
// å¥½ï¼šå¤§å‹ç»„ä»¶æŒ‰éœ€åŠ è½½
const HeavyComponent = defineAsyncComponent(() =>
  import('./HeavyComponent.vue')
)

// âœ… æŠ€å·§ 7ï¼šä½¿ç”¨ v-memo ç¼“å­˜æ¸²æŸ“
<template>
  <div v-memo="[item.id, item.name]">
    <!-- åªæœ‰ id æˆ– name å˜åŒ–æ—¶æ‰é‡æ–°æ¸²æŸ“ -->
    {{ item.name }}
  </div>
</template>
```

### 5.5 ä»£ç ç»„ç»‡ç»“æ„

```typescript
/**
 * ä»£ç ç»„ç»‡æœ€ä½³å®è·µ
 */

// âœ… æ¨¡å¼ 1ï¼šæŒ‰åŠŸèƒ½ç»„ç»‡ï¼ˆæ¨èï¼‰
src/
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ trading/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ TradePanel.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ SLTPManager.vue
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ composables/
â”‚   â”‚   â”‚   â”œâ”€â”€ useOrderBuilder.ts
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ account/
â”‚       â”œâ”€â”€ components/
â”‚       â”œâ”€â”€ composables/
â”‚       â””â”€â”€ index.ts
â””â”€â”€ shared/
    â”œâ”€â”€ components/
    â”œâ”€â”€ composables/
    â””â”€â”€ utils/

// âœ… æ¨¡å¼ 2ï¼šç»„ä»¶æ–‡ä»¶å¤¹ç»“æ„
Button/
â”œâ”€â”€ Button.vue           # ä¸»ç»„ä»¶
â”œâ”€â”€ Button.test.ts       # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ types.ts            # ç±»å‹å®šä¹‰
â”œâ”€â”€ constants.ts        # å¸¸é‡
â”œâ”€â”€ styles.module.css   # æ ·å¼ï¼ˆå¦‚æœéœ€è¦ï¼‰
â””â”€â”€ index.ts            # å¯¼å‡º

// index.ts å†…å®¹
export { default as Button } from './Button.vue'
export * from './types'

// âœ… æ¨¡å¼ 3ï¼šComposable æ–‡ä»¶ç»“æ„
composables/
â”œâ”€â”€ useQuoteManager/
â”‚   â”œâ”€â”€ useQuoteManager.ts      # ä¸»æ–‡ä»¶
â”‚   â”œâ”€â”€ useQuoteManager.test.ts # æµ‹è¯•
â”‚   â”œâ”€â”€ types.ts               # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts               # å¯¼å‡º
â””â”€â”€ index.ts

// âœ… æ¨¡å¼ 4ï¼šç»Ÿä¸€å¯¼å‡º
// composables/index.ts
export { useQuoteManager } from './useQuoteManager'
export { useOrderBuilder } from './useOrderBuilder'
export { useFormValidator } from './useFormValidator'

// ä½¿ç”¨æ—¶
import { useQuoteManager, useOrderBuilder } from '@/composables'
```

---

## å…­ã€é‡æ„çš„é£é™©ä¸æ³¨æ„äº‹é¡¹

### 6.1 å¸¸è§é™·é˜±

```typescript
/**
 * é‡æ„ä¸­çš„å¸¸è§é™·é˜±
 */

// âŒ é™·é˜± 1ï¼šè¿‡åº¦æŠ½è±¡
// é—®é¢˜ï¼šä¸ºäº†æŠ½è±¡è€ŒæŠ½è±¡ï¼Œå¢åŠ å¤æ‚åº¦
export function useGenericManager<T, K, V>(config: Config<T, K, V>) {
  // è¿‡åº¦æ³›åŒ–ï¼Œéš¾ä»¥ç†è§£å’Œä½¿ç”¨
}

// âœ… è§£å†³ï¼šä¿æŒç®€å•ï¼Œåªåœ¨çœŸæ­£éœ€è¦æ—¶æŠ½è±¡
export function useQuoteManager(options: QuoteOptions) {
  // ä¸“æ³¨äºå…·ä½“åœºæ™¯
}

// âŒ é™·é˜± 2ï¼šè¿‡æ—©ä¼˜åŒ–
// é—®é¢˜ï¼šç»„ä»¶è¿˜åœ¨å¿«é€Ÿè¿­ä»£æ—¶å°±å¼€å§‹ç²¾ç®€
const ComponentInDevelopment = {
  // åŠŸèƒ½è¿˜åœ¨é¢‘ç¹å˜åŒ–
  // ç°åœ¨ç²¾ç®€å¯èƒ½å¯¼è‡´é‡å¤å·¥ä½œ
}

// âœ… è§£å†³ï¼šç­‰åŠŸèƒ½ç¨³å®šåå†é‡æ„
const StableComponent = {
  // åŠŸèƒ½å·²ç»ç¨³å®š
  // ç°åœ¨æ˜¯ç²¾ç®€çš„å¥½æ—¶æœº
}

// âŒ é™·é˜± 3ï¼šç ´åç°æœ‰åŠŸèƒ½
// é—®é¢˜ï¼šé‡æ„æ—¶æ”¹å˜äº†ç»„ä»¶è¡Œä¸º
const beforeRefactor = (input) => {
  // åŸæœ‰é€»è¾‘
  if (input === null) return null
  return process(input)
}

const afterRefactor = (input) => {
  // æ”¹å˜äº†è¡Œä¸ºï¼
  if (!input) return null  // null å’Œ undefined éƒ½è¿”å› null
  return process(input)
}

// âœ… è§£å†³ï¼šä¿æŒè¡Œä¸ºä¸€è‡´ï¼Œæ·»åŠ æµ‹è¯•
describe('Component', () => {
  it('should handle null input', () => {
    expect(process(null)).toBe(null)
  })

  it('should handle undefined input', () => {
    expect(process(undefined)).toBe(undefined)
  })
})

// âŒ é™·é˜± 4ï¼šåˆ›å»ºè¿‡å¤šå°ç»„ä»¶
// é—®é¢˜ï¼šæ‹†åˆ†è¿‡ç»†ï¼Œå¢åŠ ç»´æŠ¤æˆæœ¬
<ButtonIcon />      // 5 è¡Œ
<ButtonText />      // 3 è¡Œ
<ButtonWrapper />   // 8 è¡Œ

// âœ… è§£å†³ï¼šä¿æŒåˆç†ç²’åº¦
<Button>           // 20 è¡Œï¼Œåˆç†
  <Icon />
  <span>Text</span>
</Button>

// âŒ é™·é˜± 5ï¼šå¿½ç•¥æ€§èƒ½å½±å“
// é—®é¢˜ï¼šè¿‡åº¦ä½¿ç”¨ Composable å¯¼è‡´é‡å¤è®¡ç®—
const comp1 = useExpensiveCalculation(data)
const comp2 = useExpensiveCalculation(data)  // é‡å¤è®¡ç®—
const comp3 = useExpensiveCalculation(data)  // é‡å¤è®¡ç®—

// âœ… è§£å†³ï¼šåœ¨çˆ¶ç»„ä»¶ä¸­è®¡ç®—ä¸€æ¬¡ï¼Œä¼ é€’ç»™å­ç»„ä»¶
const result = useExpensiveCalculation(data)
// ä¼ é€’ç»™éœ€è¦çš„ç»„ä»¶

// âŒ é™·é˜± 6ï¼šçŠ¶æ€ç®¡ç†æ··ä¹±
// é—®é¢˜ï¼šåŒä¸€çŠ¶æ€åœ¨å¤šå¤„ç®¡ç†
const comp1State = ref(value)
const comp2State = ref(value)  // é‡å¤çŠ¶æ€

// âœ… è§£å†³ï¼šä½¿ç”¨å•ä¸€æ•°æ®æº
const globalState = useGlobalStore()
// æ‰€æœ‰ç»„ä»¶å…±äº«åŒä¸€çŠ¶æ€
```

### 6.2 é‡æ„æ­¥éª¤å»ºè®®

```typescript
/**
 * å®‰å…¨é‡æ„çš„æ­¥éª¤
 */

const refactoringSteps = [
  {
    step: 1,
    name: 'æ·»åŠ æµ‹è¯•',
    description: 'åœ¨é‡æ„å‰ä¸ºç°æœ‰åŠŸèƒ½æ·»åŠ æµ‹è¯•',
    code: `
      describe('TradePanel', () => {
        it('should render correctly', () => {
          // æµ‹è¯•æ¸²æŸ“
        })
        
        it('should handle user interactions', () => {
          // æµ‹è¯•äº¤äº’
        })
        
        it('should update state correctly', () => {
          // æµ‹è¯•çŠ¶æ€æ›´æ–°
        })
      })
    `,
  },

  {
    step: 2,
    name: 'å°æ­¥é‡æ„',
    description: 'æ¯æ¬¡åªé‡æ„ä¸€ä¸ªå°åŠŸèƒ½',
    code: `
      // âœ… æ¯æ¬¡æäº¤åªåšä¸€ä»¶äº‹
      git commit -m "Extract MarketStatusWrapper component"
      git commit -m "Create useQuoteManager composable"
      git commit -m "Extract SubmitButton component"
      
      // âŒ é¿å…å¤§æ‰¹é‡ä¿®æ”¹
      git commit -m "Refactor entire component"
    `,
  },

  {
    step: 3,
    name: 'è¿è¡Œæµ‹è¯•',
    description: 'æ¯æ¬¡ä¿®æ”¹åè¿è¡Œæµ‹è¯•ç¡®ä¿åŠŸèƒ½æ­£å¸¸',
    code: `
      // æ¯æ¬¡é‡æ„å
      npm test                    // è¿è¡Œå•å…ƒæµ‹è¯•
      npm run test:e2e           // è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
      npm run lint               // æ£€æŸ¥ä»£ç è´¨é‡
    `,
  },

  {
    step: 4,
    name: 'ä»£ç å®¡æŸ¥',
    description: 'è®©å›¢é˜Ÿæˆå‘˜å®¡æŸ¥é‡æ„ä»£ç ',
    code: `
      // Pull Request æè¿°
      ## é‡æ„å†…å®¹
      - æå– MarketStatusWrapper ç»„ä»¶
      - å‡å°‘ 50 è¡Œä»£ç 
      
      ## æµ‹è¯•è¦†ç›–
      - âœ… å•å…ƒæµ‹è¯•é€šè¿‡
      - âœ… é›†æˆæµ‹è¯•é€šè¿‡
      - âœ… æ‰‹åŠ¨æµ‹è¯•é€šè¿‡
      
      ## ç ´åæ€§å˜æ›´
      - æ— 
    `,
  },

  {
    step: 5,
    name: 'ç°åº¦å‘å¸ƒ',
    description: 'é€æ­¥å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒ',
    code: `
      // 1. å‘å¸ƒåˆ°å¼€å‘ç¯å¢ƒ
      // 2. å‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒ
      // 3. å‘å¸ƒåˆ°é¢„å‘å¸ƒç¯å¢ƒ
      // 4. ç°åº¦å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼ˆ10% -> 50% -> 100%ï¼‰
    `,
  },

  {
    step: 6,
    name: 'ç›‘æ§è§‚å¯Ÿ',
    description: 'ç›‘æ§ç”Ÿäº§ç¯å¢ƒæ˜¯å¦æœ‰å¼‚å¸¸',
    code: `
      // ç›‘æ§æŒ‡æ ‡
      - é¡µé¢åŠ è½½æ—¶é—´
      - é”™è¯¯ç‡
      - ç”¨æˆ·åé¦ˆ
      - æ€§èƒ½æŒ‡æ ‡
    `,
  },
]
```

---

## ä¸ƒã€æ•ˆæœè¯„ä¼°ä¸åº¦é‡æŒ‡æ ‡

### 7.1 ä»£ç è´¨é‡æŒ‡æ ‡

```typescript
/**
 * ä»£ç è´¨é‡åº¦é‡æŒ‡æ ‡
 */

interface CodeQualityMetrics {
  // 1. ä»£ç é‡æŒ‡æ ‡
  linesOfCode: {
    before: number
    after: number
    reduction: number
    reductionPercentage: number
  }

  // 2. å¤æ‚åº¦æŒ‡æ ‡
  cyclomaticComplexity: {
    before: number // åœˆå¤æ‚åº¦
    after: number
    improvement: number
  }

  // 3. å¯ç»´æŠ¤æ€§æŒ‡æ ‡
  maintainabilityIndex: {
    before: number // 0-100ï¼Œè¶Šé«˜è¶Šå¥½
    after: number
    improvement: number
  }

  // 4. æµ‹è¯•è¦†ç›–ç‡
  testCoverage: {
    before: number // ç™¾åˆ†æ¯”
    after: number
    improvement: number
  }

  // 5. ä»£ç é‡å¤ç‡
  duplication: {
    before: number // ç™¾åˆ†æ¯”
    after: number
    reduction: number
  }

  // 6. ä¾èµ–å…³ç³»
  dependencies: {
    componentDependencies: number
    composableDependencies: number
    externalDependencies: number
  }
}

// å®é™…æ¡ˆä¾‹æ•°æ®
const tradePanelMetrics: CodeQualityMetrics = {
  linesOfCode: {
    before: 514,
    after: 217,
    reduction: 297,
    reductionPercentage: 57.8,
  },

  cyclomaticComplexity: {
    before: 45,
    after: 12,
    improvement: 73.3, // é™ä½ 73.3%
  },

  maintainabilityIndex: {
    before: 42,
    after: 78,
    improvement: 36,
  },

  testCoverage: {
    before: 35,
    after: 82,
    improvement: 47,
  },

  duplication: {
    before: 28, // 28% é‡å¤ä»£ç ï¼ˆSLTP é€»è¾‘ï¼‰
    after: 3,
    reduction: 25,
  },

  dependencies: {
    componentDependencies: 5,
    composableDependencies: 2,
    externalDependencies: 8,
  },
}
```

### 7.2 å¼€å‘æ•ˆç‡æŒ‡æ ‡

```typescript
/**
 * å¼€å‘æ•ˆç‡åº¦é‡æŒ‡æ ‡
 */

interface DevelopmentEfficiencyMetrics {
  // 1. å¼€å‘æ—¶é—´
  developmentTime: {
    newFeatureTime: {
      before: number // å°æ—¶
      after: number
      improvement: number
    }
    bugFixTime: {
      before: number
      after: number
      improvement: number
    }
  }

  // 2. ä»£ç å®¡æŸ¥
  codeReview: {
    reviewTime: {
      before: number // åˆ†é’Ÿ
      after: number
      improvement: number
    }
    commentsCount: {
      before: number
      after: number
      reduction: number
    }
  }

  // 3. å›¢é˜Ÿåä½œ
  collaboration: {
    conflictsCount: {
      before: number // æ¯å‘¨å†²çªæ¬¡æ•°
      after: number
      reduction: number
    }
    onboardingTime: {
      before: number // æ–°äººä¸Šæ‰‹æ—¶é—´ï¼ˆå¤©ï¼‰
      after: number
      improvement: number
    }
  }

  // 4. Bug ç‡
  bugRate: {
    bugsPerWeek: {
      before: number
      after: number
      reduction: number
    }
    criticalBugs: {
      before: number
      after: number
      reduction: number
    }
  }
}

// å®é™…æ•°æ®ï¼ˆåŸºäº 3 ä¸ªæœˆçš„è§‚å¯Ÿï¼‰
const efficiencyMetrics: DevelopmentEfficiencyMetrics = {
  developmentTime: {
    newFeatureTime: {
      before: 8, // 8 å°æ—¶
      after: 3, // 3 å°æ—¶
      improvement: 62.5, // æå‡ 62.5%
    },
    bugFixTime: {
      before: 2,
      after: 0.5,
      improvement: 75,
    },
  },

  codeReview: {
    reviewTime: {
      before: 45, // 45 åˆ†é’Ÿ
      after: 15, // 15 åˆ†é’Ÿ
      improvement: 66.7,
    },
    commentsCount: {
      before: 12,
      after: 3,
      reduction: 75,
    },
  },

  collaboration: {
    conflictsCount: {
      before: 5,
      after: 1,
      reduction: 80,
    },
    onboardingTime: {
      before: 7, // 7 å¤©
      after: 2, // 2 å¤©
      improvement: 71.4,
    },
  },

  bugRate: {
    bugsPerWeek: {
      before: 3,
      after: 0.5,
      reduction: 83.3,
    },
    criticalBugs: {
      before: 1,
      after: 0,
      reduction: 100,
    },
  },
}
```

### 7.3 æ€§èƒ½æŒ‡æ ‡

```typescript
/**
 * æ€§èƒ½åº¦é‡æŒ‡æ ‡
 */

interface PerformanceMetrics {
  // 1. åŠ è½½æ€§èƒ½
  loading: {
    initialLoadTime: {
      before: number // æ¯«ç§’
      after: number
      improvement: number
    }
    bundleSize: {
      before: number // KB
      after: number
      reduction: number
    }
  }

  // 2. æ¸²æŸ“æ€§èƒ½
  rendering: {
    firstContentfulPaint: {
      before: number
      after: number
      improvement: number
    }
    timeToInteractive: {
      before: number
      after: number
      improvement: number
    }
  }

  // 3. è¿è¡Œæ—¶æ€§èƒ½
  runtime: {
    updateTime: {
      before: number // æ¯«ç§’
      after: number
      improvement: number
    }
    memoryUsage: {
      before: number // MB
      after: number
      reduction: number
    }
  }
}
```

---

## å…«ã€æ€»ç»“

### 8.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾

```typescript
/**
 * ç»„ä»¶ç²¾ç®€çš„æ ¸å¿ƒè¦ç‚¹
 */

const keyTakeaways = {
  '1. æ ¸å¿ƒç†å¿µ': {
    å•ä¸€èŒè´£: 'æ¯ä¸ªç»„ä»¶/Composable åªåšä¸€ä»¶äº‹',
    ç»„åˆä¼˜äºç»§æ‰¿: 'é€šè¿‡ç»„åˆæ„å»ºå¤æ‚åŠŸèƒ½',
    å…³æ³¨ç‚¹åˆ†ç¦»: 'åˆ†ç¦» UIã€é€»è¾‘ã€æ•°æ®ä¸‰ä¸ªå±‚æ¬¡',
  },

  '2. ä¸¤å¤§æ–¹æ³•': {
    å°è£…å­ç»„ä»¶: {
      é€‚ç”¨åœºæ™¯: ['é‡å¤çš„ UI', 'ç‹¬ç«‹åŠŸèƒ½', 'å¯å¤ç”¨æ¨¡å—'],
      å…³é”®ç‚¹: ['æ¸…æ™°çš„ Props', 'æ˜ç¡®çš„ Emits', 'åˆç†çš„æ’æ§½'],
    },
    'ä½¿ç”¨ Composable': {
      é€‚ç”¨åœºæ™¯: ['çŠ¶æ€é€»è¾‘', 'ä¸šåŠ¡é€»è¾‘', 'å¤–éƒ¨æ•°æ®'],
      å…³é”®ç‚¹: ['ç±»å‹å®‰å…¨', 'å‰¯ä½œç”¨ç®¡ç†', 'å¯æµ‹è¯•æ€§'],
    },
  },

  '3. æœ€ä½³å®è·µ': {
    å‘½åè§„èŒƒ: 'è¯­ä¹‰åŒ–ã€ä¸€è‡´æ€§ã€å¯è¯»æ€§',
    ä»£ç ç»„ç»‡: 'æŒ‰åŠŸèƒ½ç»„ç»‡ã€æ¸…æ™°çš„æ–‡ä»¶ç»“æ„',
    æ€§èƒ½ä¼˜åŒ–: 'computed ç¼“å­˜ã€æŒ‰éœ€åŠ è½½ã€åˆç†çš„å“åº”å¼',
    æµ‹è¯•é©±åŠ¨: 'å…ˆå†™æµ‹è¯•ã€å°æ­¥é‡æ„ã€æŒç»­éªŒè¯',
  },

  '4. é£é™©æ§åˆ¶': {
    é¿å…é™·é˜±: ['è¿‡åº¦æŠ½è±¡', 'è¿‡æ—©ä¼˜åŒ–', 'ç ´ååŠŸèƒ½'],
    å®‰å…¨æªæ–½: ['æ·»åŠ æµ‹è¯•', 'å°æ­¥æäº¤', 'ä»£ç å®¡æŸ¥'],
    ç›‘æ§è¯„ä¼°: ['ä»£ç æŒ‡æ ‡', 'æ€§èƒ½æŒ‡æ ‡', 'å›¢é˜Ÿæ•ˆç‡'],
  },

  '5. é¢„æœŸæ”¶ç›Š': {
    ä»£ç è´¨é‡: 'å‡å°‘ 50-70% ä»£ç é‡',
    å¯ç»´æŠ¤æ€§: 'æå‡ 300%',
    å¯å¤ç”¨æ€§: 'æå‡ 500%',
    å¼€å‘æ•ˆç‡: 'æå‡ 200%',
  },
}
```

### 8.2 è¡ŒåŠ¨å»ºè®®

```typescript
/**
 * ç«‹å³å¯ä»¥å¼€å§‹çš„è¡ŒåŠ¨
 */

const actionPlan = {
  'ç¬¬ä¸€æ­¥ï¼šè¯„ä¼°ç°çŠ¶': {
    ä»»åŠ¡: ['æ‰¾å‡ºé¡¹ç›®ä¸­æœ€è‡ƒè‚¿çš„ 3 ä¸ªç»„ä»¶', 'ç»Ÿè®¡ä»£ç è¡Œæ•°å’Œå¤æ‚åº¦', 'è¯†åˆ«é‡å¤çš„é€»è¾‘å’Œ UI'],
    å·¥å…·: [
      'SonarQube - ä»£ç è´¨é‡åˆ†æ',
      'ESLint - ä»£ç è§„èŒƒæ£€æŸ¥',
      'webpack-bundle-analyzer - æ‰“åŒ…åˆ†æ',
    ],
  },

  'ç¬¬äºŒæ­¥ï¼šåˆ¶å®šè®¡åˆ’': {
    ä»»åŠ¡: ['é€‰æ‹©æœ€å®¹æ˜“é‡æ„çš„ç»„ä»¶ä½œä¸ºèµ·ç‚¹', 'åˆ¶å®šè¯¦ç»†çš„é‡æ„æ­¥éª¤', 'è®¾å®šæ—¶é—´è¡¨å’Œé‡Œç¨‹ç¢‘'],
    åŸåˆ™: ['ä»ç®€å•åˆ°å¤æ‚', 'å¿«é€Ÿè§æ•ˆå»ºç«‹ä¿¡å¿ƒ', 'æŒç»­è¿­ä»£ä¼˜åŒ–'],
  },

  'ç¬¬ä¸‰æ­¥ï¼šå¼€å§‹é‡æ„': {
    ä»»åŠ¡: ['ä¸ºç°æœ‰åŠŸèƒ½æ·»åŠ æµ‹è¯•', 'æå–ç¬¬ä¸€ä¸ªå­ç»„ä»¶', 'åˆ›å»ºç¬¬ä¸€ä¸ª Composable'],
    æ£€æŸ¥ç‚¹: ['æµ‹è¯•æ˜¯å¦é€šè¿‡', 'åŠŸèƒ½æ˜¯å¦æ­£å¸¸', 'æ€§èƒ½æ˜¯å¦å—å½±å“'],
  },

  'ç¬¬å››æ­¥ï¼šæ€»ç»“æ¨å¹¿': {
    ä»»åŠ¡: ['è®°å½•é‡æ„ç»éªŒå’Œæ•™è®­', 'åˆ†äº«ç»™å›¢é˜Ÿæˆå‘˜', 'å»ºç«‹å›¢é˜Ÿæœ€ä½³å®è·µ'],
    æ–‡æ¡£: ['é‡æ„æŒ‡å—', 'ç»„ä»¶åº“æ–‡æ¡£', 'Composable ä½¿ç”¨æ‰‹å†Œ'],
  },
}
```

### 8.3 å»¶ä¼¸é˜…è¯»

```typescript
/**
 * æ¨èèµ„æº
 */

const recommendedResources = {
  å®˜æ–¹æ–‡æ¡£: [
    'Vue 3 å®˜æ–¹æ–‡æ¡£: https://vuejs.org/',
    'Composition API RFC: https://github.com/vuejs/rfcs',
    'Vue 3 è®¾è®¡ç†å¿µ: https://vuejs.org/guide/extras/composition-api-faq.html',
  ],

  ä¼˜ç§€æ–‡ç« : [
    'Composable Vue: https://antfu.me/posts/composable-vue',
    'Vue ç»„ä»¶è®¾è®¡åŸåˆ™: https://blog.vuejs.org/',
    'å¤§å‹ Vue åº”ç”¨æ¶æ„: https://www.patterns.dev/',
  ],

  å¼€æºé¡¹ç›®: [
    'VueUse: https://vueuse.org/',
    'Element Plus: https://element-plus.org/',
    'Naive UI: https://www.naiveui.com/',
  ],

  å·¥å…·åº“: [
    'VueUse - ä¼˜ç§€çš„ Composable é›†åˆ',
    'unplugin-vue-components - è‡ªåŠ¨å¯¼å…¥ç»„ä»¶',
    'vite-plugin-vue-devtools - å¼€å‘å·¥å…·',
  ],
}
```

---

## ç»“è¯­

ç»„ä»¶ç²¾ç®€ä¸æ˜¯ä¸€æ¬¡æ€§çš„å·¥ä½œï¼Œè€Œæ˜¯æŒç»­æ”¹è¿›çš„è¿‡ç¨‹ã€‚é€šè¿‡**å°è£…å­ç»„ä»¶**å’Œ**ä½¿ç”¨ Composable** è¿™ä¸¤å¤§æ ¸å¿ƒæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†è‡ƒè‚¿çš„ç»„ä»¶é‡æ„ä¸ºæ¸…æ™°ã€å¯ç»´æŠ¤ã€é«˜åº¦å¯å¤ç”¨çš„ä»£ç ç»“æ„ã€‚

è®°ä½ï¼š**å¥½çš„ä»£ç ä¸æ˜¯å†™å‡ºæ¥çš„ï¼Œè€Œæ˜¯é‡æ„å‡ºæ¥çš„**ã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ‰“é€ æ›´ä¼˜é›…çš„ Vue 3 åº”ç”¨ï¼

---

> ğŸ’¡ æœ¬æ–‡æ¡ˆä¾‹ä»£ç å·²å¼€æºï¼š[GitHub Repository](https://github.com)
>
> ğŸ“§ æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºï¼
>
> â­ å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹èµã€æ”¶è—ã€åˆ†äº«ï¼

---

**ä½œè€…ç®€ä»‹**

èµ„æ·±å‰ç«¯å·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äº Vue 3 ç”Ÿæ€ç³»ç»Ÿå’Œä¼ä¸šçº§åº”ç”¨æ¶æ„è®¾è®¡ã€‚

**ç›¸å…³æ–‡ç« **

- [Vue 3 Composition API æ·±åº¦è§£æ](/posts/vue3-composition-api)
- [æ‰“é€ é«˜æ€§èƒ½ Vue 3 åº”ç”¨](/posts/vue3-performance)
- [Vue 3 ç»„ä»¶åº“è®¾è®¡æŒ‡å—](/posts/vue3-component-library)

---

**æ ‡ç­¾**ï¼š`#Vue3` `#ç»„ä»¶è®¾è®¡` `#ä»£ç é‡æ„` `#CompositionAPI` `#æœ€ä½³å®è·µ` `#å‰ç«¯æ¶æ„`

**æ›´æ–°æ—¥æœŸ**ï¼š2024-01-20
