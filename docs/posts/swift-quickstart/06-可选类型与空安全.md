---
title: Swift 入门（6）：可选类型与空安全
date: 2025-09-14
categories: Swift
tags: [Swift, iOS, 教程]
---

# Swift 入门（6）：可选类型与空安全

> Swift 语言最突出的特性之一就是 **空安全（null safety）**，它通过 **可选类型（Optional）** 来避免常见的空指针错误。

---

## 什么是可选类型？

在 Swift 中，变量默认必须有值。如果可能为空，就要用 `?` 声明为 **可选类型**：

```swift
var name: String? = "Alice"
name = nil   // 合法，因为是可选类型
```

普通变量不能为 `nil`：

```swift
var age: Int = 18
// age = nil   ❌ 错误
```

---

## 解包（Unwrapping）

### 1. 强制解包（!）

如果确定有值，可以用 `!` 取出：

```swift
let name: String? = "Bob"
print(name!)   // Bob
```

⚠️ 如果为 `nil` 会崩溃：

```swift
let n: String? = nil
print(n!)  // ❌ 崩溃
```

---

### 2. 可选绑定（if let）

更安全的写法：

```swift
var name: String? = "Charlie"

if let n = name {
    print("Hello, \(n)")   // Hello, Charlie
} else {
    print("No name")
}
```

---

### 3. 可选绑定（guard let）

常用于函数中提前退出：

```swift
func greet(_ name: String?) {
    guard let n = name else {
        print("No name")
        return
    }
    print("Hello, \(n)")
}

greet("David")  // Hello, David
greet(nil)      // No name
```

---

### 4. 默认值（?? 运算符）

```swift
let nickname: String? = nil
print(nickname ?? "Guest")   // Guest
```

---

## 隐式解包（!）

如果一个变量在生命周期内 **一定会有值**，可以用 `String!`：

```swift
var username: String! = "Eve"
print(username)   // 自动解包 → Eve
```

⚠️ 一般少用，容易出错。

---

## 可选链（Optional Chaining）

访问可能为空的属性/方法时，可以用 `?.`：

```swift
class Person {
    var pet: Pet?
}

class Pet {
    var name: String = "Dog"
}

let p = Person()
print(p.pet?.name)   // nil
```

---

## 小结

- `?` → 表示可能为空。
- `!` → 强制解包，危险。
- `if let` / `guard let` → 安全解包。
- `??` → 提供默认值。
- `?.` → 可选链，优雅避免空指针。
