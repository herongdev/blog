---
title: Swift 入门（14）：错误处理
date: 2025-09-14
categories: Swift
tags: [Swift, iOS, 教程]
---

# Swift 入门（14）：错误处理

> 在 Swift 中，错误处理主要通过 **`throw` / `try` / `catch`** 来实现。  
> 和异常不同，Swift 错误必须显式声明和处理，更安全。

## 1. 定义错误类型

Swift 的错误必须遵循 `Error` 协议。

```swift
enum FileError: Error {
    case notFound
    case noPermission
}
```

## 2. 抛出错误

```swift
func readFile(name: String) throws -> String {
    if name == "secret.txt" {
        throw FileError.noPermission
    }
    return "文件内容"
}
```

## 3. 捕获错误

```swift
do {
    let content = try readFile(name: "secret.txt")
    print(content)
} catch FileError.notFound {
    print("❌ 文件未找到")
} catch FileError.noPermission {
    print("⛔ 没有权限")
} catch {
    print("⚠️ 其它错误：\(error)")
}
```

## 4. try? 和 try!

- **`try?`**：错误时返回 `nil`。
- **`try!`**：确定不会出错时使用，出错会崩溃。

```swift
let result1 = try? readFile(name: "a.txt")  // Optional("文件内容")
let result2 = try? readFile(name: "secret.txt")  // nil

let result3 = try! readFile(name: "a.txt") // 强制执行
```

## 5. defer（清理资源）

`defer` 块中的代码在函数结束时执行，常用于释放资源。

```swift
func processFile() throws {
    print("开始处理文件")
    defer {
        print("关闭文件")
    }
    throw FileError.notFound
}

try? processFile()
// 输出：
// 开始处理文件
// 关闭文件
```

## 总结

- 用 `enum` + `Error` 定义错误类型。
- 用 `throw` 抛出，用 `try` + `catch` 捕获。
- `try?` 返回可选，`try!` 强制执行。
- `defer` 用于清理收尾。
