import{_ as i,c as a,o as t,ag as e}from"./chunks/framework.oqSrIbQK.js";const g=JSON.parse('{"title":"「浏览器/平台探测」与 UA 字符串解读（含 UA-CH、WebAuthn 能力探测与实战示例）","description":"","frontmatter":{"title":"「浏览器/平台探测」与 UA 字符串解读（含 UA-CH、WebAuthn 能力探测与实战示例）","date":"2025-09-17T00:00:00.000Z","tags":["Web 安全","前端探测"]},"headers":[],"relativePath":"posts/前端/浏览器/「浏览器/平台探测」与 UA 字符串解读（含 UA-CH、WebAuthn 能力探测与实战示例）.md","filePath":"posts/前端/浏览器/「浏览器/平台探测」与 UA 字符串解读（含 UA-CH、WebAuthn 能力探测与实战示例）.md","lastUpdated":1758216284000}'),n={name:"posts/前端/浏览器/「浏览器/平台探测」与 UA 字符串解读（含 UA-CH、WebAuthn 能力探测与实战示例）.md"};function l(h,s,k,r,p,o){return t(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="一、整体思路" tabindex="-1">一、整体思路 <a class="header-anchor" href="#一、整体思路" aria-label="Permalink to &quot;一、整体思路&quot;">​</a></h2><ul><li><strong>优先用 UA-CH（User-Agent Client Hints）</strong>：更隐私、可控，浏览器逐步<strong>冻结</strong>传统 UA 字符串的细节，官方鼓励迁移到 UA-CH。(<a href="https://wicg.github.io/ua-client-hints/?utm_source=chatgpt.com" title="User-Agent Client Hints - GitHub Pages" target="_blank" rel="noreferrer">WICG</a>)</li><li><strong>UA 兜底</strong>：当 UA-CH 不可用或信息不足，再解析 <code>navigator.userAgent</code>。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/userAgent?utm_source=chatgpt.com" title="Navigator: userAgent property - Web APIs - MDN - Mozilla" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li><li><strong>能力优先</strong>：涉及 Passkeys/WebAuthn 时，尽量做“<strong>能力探测</strong>”而不是“品牌猜测”，例如探测平台验证器、条件式 UI 等。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/PublicKeyCredential/isUserVerifyingPlatformAuthenticatorAvailable_static?utm_source=chatgpt.com" title="isUserVerifyingPlatformAuthentic..." target="_blank" rel="noreferrer">MDN Web Docs</a>)</li></ul><h2 id="二、分步实现" tabindex="-1">二、分步实现 <a class="header-anchor" href="#二、分步实现" aria-label="Permalink to &quot;二、分步实现&quot;">​</a></h2><h3 id="步骤-1-读取低熵-ua-ch-无需权限" tabindex="-1">步骤 1：读取低熵 UA-CH（无需权限） <a class="header-anchor" href="#步骤-1-读取低熵-ua-ch-无需权限" aria-label="Permalink to &quot;步骤 1：读取低熵 UA-CH（无需权限）&quot;">​</a></h3><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 复杂逻辑：优先读取 UA-CH 的低熵字段，获取平台与品牌</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> uaData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (navigator </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).userAgentData;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> platform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uaData?.platform </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 例：&#39;Windows&#39; | &#39;macOS&#39; | &#39;Android&#39; | &#39;iOS&#39; ...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> brands</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uaData?.brands </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 例：[ {brand:&#39;Chromium&#39;, version:&#39;140&#39;}, {brand:&#39;Microsoft Edge&#39;, version:&#39;140&#39;} ]</span></span></code></pre></div><ul><li><code>platform</code>：当前平台名称。</li><li><code>brands</code>：浏览器“品牌”列表（Chromium/Chrome/Edge 等），常用于判断是否 Chromium 家族。 以上字段由 <strong>NavigatorUAData</strong> 暴露，属于 UA-CH 的“低熵”部分。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/User-Agent_Client_Hints_API?utm_source=chatgpt.com" title="User-Agent Client Hints API - Web APIs - MDN - Mozilla" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li></ul><h3 id="步骤-2-读取高熵-ua-ch-需显式请求" tabindex="-1">步骤 2：读取高熵 UA-CH（需显式请求） <a class="header-anchor" href="#步骤-2-读取高熵-ua-ch-需显式请求" aria-label="Permalink to &quot;步骤 2：读取高熵 UA-CH（需显式请求）&quot;">​</a></h3><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 复杂逻辑：请求高熵字段，获取更细粒度的版本/架构/模式等</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> high</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uaData</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uaData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHighEntropyValues</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;architecture&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// CPU 架构：&#39;x86&#39; | &#39;arm&#39; ...</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;bitness&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 位宽：&#39;64&#39; | &#39;32&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;model&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设备型号（移动端常见）</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;platformVersion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 平台版本：如 Windows 内核版本</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;uaFullVersion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 浏览器完整版本号</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;fullVersionList&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 全量 brand+version 列表</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;wow64&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 是否 WOW64 兼容层</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span></code></pre></div><p>这些字段由 <code>NavigatorUAData.getHighEntropyValues()</code> 一次性返回，便于做平台差异化或下载架构选择（如 32/64 位）。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorUAData/getHighEntropyValues?utm_source=chatgpt.com" title="NavigatorUAData: getHighEntropyValues() method - Web APIs" target="_blank" rel="noreferrer">MDN Web Docs</a>)</p><blockquote><p>常见用途举例：</p><ul><li><strong>bitness/architecture</strong>：选择下载 64 位或 32 位安装包。(<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Sec-CH-UA-Bitness?utm_source=chatgpt.com" title="Sec-CH-UA-Bitness header - HTTP - MDN" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li><li><strong>platformVersion</strong>：区分 <strong>Windows 10 vs 11</strong> 的行为、样式或性能开关。(<a href="https://learn.microsoft.com/en-us/microsoft-edge/web-platform/how-to-detect-win11?utm_source=chatgpt.com" title="Detect Windows 11 and CPU architecture using User ..." target="_blank" rel="noreferrer">Microsoft Learn</a>)</li><li><strong>fullVersionList</strong>：更精确地判断浏览器及其完整版本。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorUAData/getHighEntropyValues?utm_source=chatgpt.com" title="NavigatorUAData: getHighEntropyValues() method - Web APIs" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li></ul></blockquote><h3 id="步骤-3-ua-字符串兜底解析" tabindex="-1">步骤 3：UA 字符串兜底解析 <a class="header-anchor" href="#步骤-3-ua-字符串兜底解析" aria-label="Permalink to &quot;步骤 3：UA 字符串兜底解析&quot;">​</a></h3><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 复杂逻辑：在 UA-CH 不可用时兜底解析 UA 字符串</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ua</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> navigator.userAgent; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 传统 UA，需注意已逐步“去细节化”</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isEdge</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\\b</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">Edg</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[\\d.]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ua); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Edge 使用 &quot;Edg/...&quot; 标记</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isChrome</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\\b</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">Chrome</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[\\d.]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ua) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isEdge;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isSafari</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">Safari</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[\\d.]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ua) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isChrome </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isEdge;</span></span></code></pre></div><ul><li><code>Navigator.userAgent</code> 是传统 UA 字符串，仍可用，但细节可能被“冻结”。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/userAgent?utm_source=chatgpt.com" title="Navigator: userAgent property - Web APIs - MDN - Mozilla" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li><li><strong>Edge</strong> 在 UA 中以 <code>Edg/&lt;version&gt;</code> 标记；不要只匹配 <code>Edge</code>。(<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/User-Agent?utm_source=chatgpt.com" title="User-Agent header - HTTP - MDN - Mozilla" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li></ul><h3 id="步骤-4-webauthn-passkeys-能力探测-推荐" tabindex="-1">步骤 4：WebAuthn/Passkeys 能力探测（推荐） <a class="header-anchor" href="#步骤-4-webauthn-passkeys-能力探测-推荐" aria-label="Permalink to &quot;步骤 4：WebAuthn/Passkeys 能力探测（推荐）&quot;">​</a></h3><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 复杂逻辑：是否存在“平台验证器”（本机指纹/面容/Windows Hello 等）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> uvpaa</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PublicKeyCredential.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isUserVerifyingPlatformAuthenticatorAvailable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 复杂逻辑：是否支持“条件式 UI”（表单自动填充一键直登）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canConditional</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  PublicKeyCredential </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isConditionalMediationAvailable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?.();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 复杂逻辑：未来可用：一次性查询浏览器 WebAuthn 能力集合</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> caps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PublicKeyCredential </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getClientCapabilities</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?.();</span></span></code></pre></div><ul><li><code>isUserVerifyingPlatformAuthenticatorAvailable()</code>：探测本机是否有“可用户验证”的平台验证器。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/PublicKeyCredential/isUserVerifyingPlatformAuthenticatorAvailable_static?utm_source=chatgpt.com" title="isUserVerifyingPlatformAuthentic..." target="_blank" rel="noreferrer">MDN Web Docs</a>)</li><li><code>isConditionalMediationAvailable()</code>：探测是否支持 <strong>Conditional UI</strong> 登录体验。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/PublicKeyCredential/isConditionalMediationAvailable_static?utm_source=chatgpt.com" title="isConditionalMediationAvailable() static method - Web APIs" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li><li><code>getClientCapabilities()</code>：WebAuthn Level 3 引入的能力查询。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/PublicKeyCredential?utm_source=chatgpt.com" title="PublicKeyCredential - Web APIs - MDN" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li></ul><hr><h2 id="三、ua-ch-字段一览与用途" tabindex="-1">三、UA-CH 字段一览与用途 <a class="header-anchor" href="#三、ua-ch-字段一览与用途" aria-label="Permalink to &quot;三、UA-CH 字段一览与用途&quot;">​</a></h2><table tabindex="0"><thead><tr><th>字段</th><th>类型/示例</th><th>作用与典型用法</th></tr></thead><tbody><tr><td><code>platform</code></td><td><code>&quot;Windows&quot;</code> / <code>&quot;macOS&quot;</code> / <code>&quot;Android&quot;</code> / <code>&quot;iOS&quot;</code></td><td>粗粒度平台判断（低熵）。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/User-Agent_Client_Hints_API?utm_source=chatgpt.com" title="User-Agent Client Hints API - Web APIs - MDN - Mozilla" target="_blank" rel="noreferrer">MDN Web Docs</a>)</td></tr><tr><td><code>brands</code></td><td><code>[{brand:&#39;Chromium&#39;,version:&#39;140&#39;}...]</code></td><td>判断是否基于 Chromium、有哪些品牌标识（低熵）。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/User-Agent_Client_Hints_API?utm_source=chatgpt.com" title="User-Agent Client Hints API - Web APIs - MDN - Mozilla" target="_blank" rel="noreferrer">MDN Web Docs</a>)</td></tr><tr><td><code>architecture</code></td><td><code>&quot;x86&quot;</code> / <code>&quot;arm&quot;</code></td><td>CPU 架构（高熵，需申请）。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorUAData/getHighEntropyValues?utm_source=chatgpt.com" title="NavigatorUAData: getHighEntropyValues() method - Web APIs" target="_blank" rel="noreferrer">MDN Web Docs</a>)</td></tr><tr><td><code>bitness</code></td><td><code>&quot;64&quot;</code> / <code>&quot;32&quot;</code></td><td>选择 64/32 位资源（高熵）。(<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Sec-CH-UA-Bitness?utm_source=chatgpt.com" title="Sec-CH-UA-Bitness header - HTTP - MDN" target="_blank" rel="noreferrer">MDN Web Docs</a>)</td></tr><tr><td><code>model</code></td><td><code>&quot;iPhone&quot;</code> 等</td><td>设备型号（移动端常见，高熵）。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorUAData/getHighEntropyValues?utm_source=chatgpt.com" title="NavigatorUAData: getHighEntropyValues() method - Web APIs" target="_blank" rel="noreferrer">MDN Web Docs</a>)</td></tr><tr><td><code>platformVersion</code></td><td><code>&quot;13.0.0&quot;</code></td><td>Windows 11 等版本区分（高熵）。(<a href="https://learn.microsoft.com/en-us/microsoft-edge/web-platform/how-to-detect-win11?utm_source=chatgpt.com" title="Detect Windows 11 and CPU architecture using User ..." target="_blank" rel="noreferrer">Microsoft Learn</a>)</td></tr><tr><td><code>uaFullVersion</code></td><td><code>&quot;140.0.0.0&quot;</code></td><td>浏览器完整版本（高熵）。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorUAData/getHighEntropyValues?utm_source=chatgpt.com" title="NavigatorUAData: getHighEntropyValues() method - Web APIs" target="_blank" rel="noreferrer">MDN Web Docs</a>)</td></tr><tr><td><code>fullVersionList</code></td><td><code>[{brand:&#39;Chromium&#39;,version:&#39;140.0.0.0&#39;}, ...]</code></td><td>更精确识别品牌+版本（高熵）。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorUAData/getHighEntropyValues?utm_source=chatgpt.com" title="NavigatorUAData: getHighEntropyValues() method - Web APIs" target="_blank" rel="noreferrer">MDN Web Docs</a>)</td></tr><tr><td><code>wow64</code></td><td><code>true/false</code></td><td>是否运行在 WOW64 兼容层（高熵）。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorUAData/getHighEntropyValues?utm_source=chatgpt.com" title="NavigatorUAData: getHighEntropyValues() method - Web APIs" target="_blank" rel="noreferrer">MDN Web Docs</a>)</td></tr></tbody></table><blockquote><p>注意：UA-CH 的“高熵”字段需要通过 JS 显式请求或服务端通过 <code>Accept-CH</code> 提示，浏览器才会提供。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/User-Agent_Client_Hints_API?utm_source=chatgpt.com" title="User-Agent Client Hints API - Web APIs - MDN - Mozilla" target="_blank" rel="noreferrer">MDN Web Docs</a>)</p></blockquote><hr><h2 id="四、最简代码示例" tabindex="-1">四、最简代码示例 <a class="header-anchor" href="#四、最简代码示例" aria-label="Permalink to &quot;四、最简代码示例&quot;">​</a></h2><blockquote><p>仅演示关键探测点；复杂逻辑处已在上一行写注释。</p></blockquote><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 复杂逻辑：综合 UA-CH 与 UA，返回 { platform, isChromium, isEdge, isSafari, versions }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> detectRuntime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> navAny</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> navigator </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> uaData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> navAny.userAgentData;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ua</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> navigator.userAgent;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> platform </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> brands</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;{ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">brand</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fullVersionList</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;{ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">brand</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (uaData) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    platform </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uaData.platform </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    brands </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uaData.brands </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 复杂逻辑：尽量取到完整版本列表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> high</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uaData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHighEntropyValues</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;fullVersionList&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      fullVersionList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> high.fullVersionList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 复杂逻辑：判断 Chromium 家族（从 brands 与 UA 双通道）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> brandsText</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> brands.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b.brand).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isChromium</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    /</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">Chrom(e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">ium)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">Google Chrome</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">Microsoft Edge</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">Opera</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">OPR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">Brave</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      brandsText</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\\b</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">(Chrome</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">Chromium</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">Edg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">OPR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">Brave)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\\b</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ua);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 复杂逻辑：Edge、Chrome、Safari 的基本判断</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isEdge</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\\b</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">Edg</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[\\d.]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ua);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isChrome</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\\b</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">Chrome</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[\\d.]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ua) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isEdge;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isSafari</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">Safari</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[\\d.]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ua) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isChrome </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isEdge;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    platform,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    isChromium,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    isEdge,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    isSafari,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    versions: { brands, fullVersionList },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 复杂逻辑：WebAuthn 能力探测（平台验证器 &amp; 条件式 UI）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> detectWebAuthn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> uvpaa</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PublicKeyCredential.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isUserVerifyingPlatformAuthenticatorAvailable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canConditional</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PublicKeyCredential </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isConditionalMediationAvailable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?.();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> caps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (PublicKeyCredential </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getClientCapabilities</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?.()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { uvpaa, canConditional, caps };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>UA-CH 的 <strong>fullVersionList</strong> 提供比 UA 更稳的“品牌+完整版本”。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorUAData/getHighEntropyValues?utm_source=chatgpt.com" title="NavigatorUAData: getHighEntropyValues() method - Web APIs" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li><li>WebAuthn 的三个静态探测方法可用于决定是否展示 <strong>条件式 UI</strong>、是否允许<strong>平台凭据</strong>登录等。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/PublicKeyCredential/isUserVerifyingPlatformAuthenticatorAvailable_static?utm_source=chatgpt.com" title="isUserVerifyingPlatformAuthentic..." target="_blank" rel="noreferrer">MDN Web Docs</a>)</li></ul><hr><h2 id="五、ua-字符串逐段拆解-实战" tabindex="-1">五、UA 字符串逐段拆解（实战） <a class="header-anchor" href="#五、ua-字符串逐段拆解-实战" aria-label="Permalink to &quot;五、UA 字符串逐段拆解（实战）&quot;">​</a></h2><p>给定 UA：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36</span></span>
<span class="line"><span>(KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0</span></span></code></pre></div><p>逐段含义：</p><ul><li><strong><code>Mozilla/5.0</code></strong>：历史兼容标记，表示“与 Mozilla 兼容”。如今几乎所有浏览器都会带上它。(<a href="https://stackoverflow.com/questions/5125438/why-do-chrome-and-ie-put-mozilla-5-0-in-the-user-agent-they-send-to-the-server?utm_source=chatgpt.com" title="Why do Chrome and IE put &quot;Mozilla 5.0&quot; in the User-Agent ..." target="_blank" rel="noreferrer">Stack Overflow</a>)</li><li><strong><code>(Windows NT 10.0; Win64; x64)</code></strong>：平台信息（Windows，内核版本 10.0，64 位）。</li><li><strong><code>AppleWebKit/537.36</code></strong>：渲染引擎历史标识（WebKit/Blink 系都常带此段，出于兼容）。(<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/User-Agent?utm_source=chatgpt.com" title="User-Agent header - HTTP - MDN - Mozilla" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li><li><strong><code>(KHTML, like Gecko)</code></strong>：历史说明“像 Gecko 一样”，早期对站点嗅探的兼容产物。</li><li><strong><code>Chrome/140.0.0.0</code></strong>：<strong>Chromium/Chrome</strong> 基因的版本号片段。</li><li><strong><code>Safari/537.36</code></strong>：同样是历史兼容字段，非真正 Safari 也会带。(<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/User-Agent?utm_source=chatgpt.com" title="User-Agent header - HTTP - MDN - Mozilla" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li><li><strong><code>Edg/140.0.0.0</code></strong>：<strong>Microsoft Edge</strong> 的明确标记（注意是 <code>Edg/</code> 而非 <code>Edge/</code>）。(<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/User-Agent?utm_source=chatgpt.com" title="User-Agent header - HTTP - MDN - Mozilla" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li></ul><blockquote><p>结论：这串 UA 同时包含 WebKit/Chrome/Safari 的历史兼容片段，<strong>真正决定“它是 Edge”的是结尾的 <code>Edg/140...</code></strong>。这就是你看到“怎么什么都有”的原因：<strong>为了兼容旧站点的 UA 嗅探</strong>，浏览器刻意保留了多段看似“矛盾”的标识。(<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/User-Agent?utm_source=chatgpt.com" title="User-Agent header - HTTP - MDN - Mozilla" target="_blank" rel="noreferrer">MDN Web Docs</a>)</p></blockquote><hr><h2 id="六、最佳实践与注意事项" tabindex="-1">六、最佳实践与注意事项 <a class="header-anchor" href="#六、最佳实践与注意事项" aria-label="Permalink to &quot;六、最佳实践与注意事项&quot;">​</a></h2><ol><li><strong>能用 UA-CH 就别靠 UA</strong>：UA 正在“去细节化/冻结”，准确性和可持续性不如 UA-CH。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/User-Agent_Client_Hints_API?utm_source=chatgpt.com" title="User-Agent Client Hints API - Web APIs - MDN - Mozilla" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li><li><strong>WebAuthn 以“能力探测”为先</strong>：优先根据 <code>uvpaa/conditional</code> 等能力决定登录体验，而非“浏览器品牌”。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/PublicKeyCredential/isUserVerifyingPlatformAuthenticatorAvailable_static?utm_source=chatgpt.com" title="isUserVerifyingPlatformAuthentic..." target="_blank" rel="noreferrer">MDN Web Docs</a>)</li><li><strong>确定“供应商/来源”时用 AAGUID</strong>：注册阶段记录 <strong>AAGUID</strong>（如需），比 UA/UA-CH 更可靠。(<a href="https://web.dev/articles/webauthn-aaguid?utm_source=chatgpt.com" title="Determine the passkey provider with AAGUID | Articles" target="_blank" rel="noreferrer">web.dev</a>)</li></ol><hr><h2 id="七、快速参考" tabindex="-1">七、快速参考 <a class="header-anchor" href="#七、快速参考" aria-label="Permalink to &quot;七、快速参考&quot;">​</a></h2><ul><li>UA-CH 规范与 API：MDN、WICG 文档与 Chrome 指南。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/User-Agent_Client_Hints_API?utm_source=chatgpt.com" title="User-Agent Client Hints API - Web APIs - MDN - Mozilla" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li><li>UA 基础与 Edge 标记：MDN UA 参考、Microsoft 文档。(<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/User-Agent?utm_source=chatgpt.com" title="User-Agent header - HTTP - MDN - Mozilla" target="_blank" rel="noreferrer">MDN Web Docs</a>)</li><li>WebAuthn 能力：MDN 与 WebAuthn Level 3。(<a href="https://developer.mozilla.org/en-US/docs/Web/API/PublicKeyCredential/isUserVerifyingPlatformAuthenticatorAvailable_static?utm_source=chatgpt.com" title="isUserVerifyingPlatformAuthentic..." target="_blank" rel="noreferrer">MDN Web Docs</a>)</li></ul><blockquote><p>有了上述探测与解读框架，你就可以<strong>稳定地拿到平台/浏览器/能力</strong>信息，并在 Passkeys 场景里用“<strong>能力优先</strong>”的策略，提供更一致的登录体验。</p></blockquote>`,39)])])}const E=i(n,[["render",l]]);export{g as __pageData,E as default};
