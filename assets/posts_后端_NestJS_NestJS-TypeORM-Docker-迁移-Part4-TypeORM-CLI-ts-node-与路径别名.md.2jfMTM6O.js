import{_ as e,c as i,o as t,ag as a}from"./chunks/framework.oqSrIbQK.js";const k=JSON.parse('{"title":"NestJS + TypeORM + Docker 迁移（Part 4）— TypeORM CLI、ts-node 与路径别名","description":"正确使用 TypeORM CLI（兼容当前版本），注入 ts-node 与 tsconfig-paths，避免严格编译阻断迁移。","frontmatter":{"title":"NestJS + TypeORM + Docker 迁移（Part 4）— TypeORM CLI、ts-node 与路径别名","date":"2025-11-17T00:00:00.000Z","tags":["NestJS","TypeORM","ts-node","Docker"],"categories":["后端"],"description":"正确使用 TypeORM CLI（兼容当前版本），注入 ts-node 与 tsconfig-paths，避免严格编译阻断迁移。"},"headers":[],"relativePath":"posts/后端/NestJS/NestJS-TypeORM-Docker-迁移-Part4-TypeORM-CLI-ts-node-与路径别名.md","filePath":"posts/后端/NestJS/NestJS-TypeORM-Docker-迁移-Part4-TypeORM-CLI-ts-node-与路径别名.md","lastUpdated":1764331727000}'),n={name:"posts/后端/NestJS/NestJS-TypeORM-Docker-迁移-Part4-TypeORM-CLI-ts-node-与路径别名.md"};function o(l,s,p,d,r,h){return t(),i("div",null,[...s[0]||(s[0]=[a(`<h2 id="症状与根因" tabindex="-1">症状与根因 <a class="header-anchor" href="#症状与根因" aria-label="Permalink to &quot;症状与根因&quot;">​</a></h2><ul><li>Cannot find module &#39;./cli.js&#39;：直接用 <code>ts-node</code> 执行旧路径与当前 TypeORM 不匹配。</li><li>Cannot find module &#39;@/shared/entities/focus&#39;：CLI 未加载 <code>tsconfig-paths</code>，<code>@</code> 别名不可用。</li><li>TS7006/类型错误导致迁移中断：CLI 会编译 <code>data-source.ts</code>，严格类型阻断执行。</li></ul><hr><h2 id="固定模板-entrypoint-sh-迁移段" tabindex="-1">固定模板（entrypoint.sh 迁移段） <a class="header-anchor" href="#固定模板-entrypoint-sh-迁移段" aria-label="Permalink to &quot;固定模板（entrypoint.sh 迁移段）&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 迁移（开发，ts-node）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Running migrations (ts-node via npx)...&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TS_NODE_TRANSPILE_ONLY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TS_NODE_PROJECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tsconfig.json</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  NODE_OPTIONS=&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$NODE_OPTIONS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -r ts-node/register -r tsconfig-paths/register&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> typeorm-ts-node-commonjs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migration:run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src/database/data-source.ts</span></span></code></pre></div><ul><li>CLI：使用 <code>npx typeorm-ts-node-commonjs</code>（与 TypeORM 新版本兼容）。</li><li>预加载：<code>-r ts-node/register -r tsconfig-paths/register</code> 使 TS 与路径别名在 CLI 下生效。</li><li>仅转译：<code>TS_NODE_TRANSPILE_ONLY=1</code> 避免类型报错阻断迁移（生产 CI 可开启更严格策略）。</li><li>项目文件：通过 <code>TS_NODE_PROJECT=tsconfig.json</code> 指定正确 tsconfig。</li></ul><hr><h2 id="常见陷阱" tabindex="-1">常见陷阱 <a class="header-anchor" href="#常见陷阱" aria-label="Permalink to &quot;常见陷阱&quot;">​</a></h2><ul><li>直接 <code>node --loader ts-node/esm</code> 运行 CLI 在 CJS 项目下常见兼容问题，推荐以上 CJS 命令。</li><li>忘记把 <code>NODE_OPTIONS</code> 传入容器环境，导致别名在 CLI 下仍然失效。</li></ul>`,9)])])}const g=e(n,[["render",o]]);export{k as __pageData,g as default};
