import{_ as i,c as a,o as n,ag as e}from"./chunks/framework.oqSrIbQK.js";const g=JSON.parse('{"title":"Ant Design Upload：不自动也不手动上传时，onChange 还会触发吗？","description":"","frontmatter":{"title":"Ant Design Upload：不自动也不手动上传时，onChange 还会触发吗？","date":"2025-09-28T00:00:00.000Z","tags":["Ant Design","beforeUpload"]},"headers":[],"relativePath":"posts/前端/下载与文件/Ant Design Upload：不自动也不手动上传时，onChange 还会触发吗？.md","filePath":"posts/前端/下载与文件/Ant Design Upload：不自动也不手动上传时，onChange 还会触发吗？.md","lastUpdated":1764331727000}'),l={name:"posts/前端/下载与文件/Ant Design Upload：不自动也不手动上传时，onChange 还会触发吗？.md"};function t(o,s,h,r,p,d){return n(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="结论-tl-dr" tabindex="-1">结论（TL;DR） <a class="header-anchor" href="#结论-tl-dr" aria-label="Permalink to &quot;结论（TL;DR）&quot;">​</a></h2><ul><li><strong>会触发</strong>，但<strong>只会在“列表变化”相关的节点触发</strong>（如：选择文件加入列表、从列表移除文件）。</li><li><strong>不会触发与网络请求相关的节点</strong>（进度、成功、失败），因为根本没有发起上传。</li></ul><hr><h2 id="触发规则一览" tabindex="-1">触发规则一览 <a class="header-anchor" href="#触发规则一览" aria-label="Permalink to &quot;触发规则一览&quot;">​</a></h2><ul><li>✅ <strong>文件被选中加入 <code>fileList</code></strong> → 触发 <code>onChange</code>（通常 <code>status: &#39;uploading&#39;</code> 或由实现决定，反正<strong>没有进度与响应</strong>）。</li><li>✅ <strong>移除文件</strong>（点击删除按钮或你手动更新 <code>fileList</code>）→ 触发 <code>onChange</code>。</li><li>❌ <strong>上传进度</strong>（<code>percent</code> 变化）→ 不会发生。</li><li>❌ <strong>完成/失败</strong>（<code>done</code>/<code>error</code>，带 <code>response</code>）→ 不会发生。</li></ul><blockquote><p>说明：<code>onChange</code> 的语义是“<strong>上传组件内部的文件列表或状态发生变化</strong>”，并不等同于“网络上传事件”。只要<strong>列表变了</strong>（增/删/替换），就会触发一次。</p></blockquote><hr><h2 id="常见场景与表现" tabindex="-1">常见场景与表现 <a class="header-anchor" href="#常见场景与表现" aria-label="Permalink to &quot;常见场景与表现&quot;">​</a></h2><h3 id="场景-a-beforeupload-false-阻止自动上传" tabindex="-1">场景 A：<code>beforeUpload={() =&gt; false}</code>（阻止自动上传） <a class="header-anchor" href="#场景-a-beforeupload-false-阻止自动上传" aria-label="Permalink to &quot;场景 A：\`beforeUpload={() =&gt; false}\`（阻止自动上传）&quot;">​</a></h3><ul><li>选择文件时：<strong>会触发一次 <code>onChange</code></strong>（文件进入列表）。</li><li>不会有进度与完成态，因为没有上传。</li><li>你可以在 <code>onChange</code> 里拿到 <code>file.originFileObj</code> 自行处理（比如本地预览、转码、再走你自定义的上传逻辑）。</li></ul><h3 id="场景-b-完全手动控制-filelist" tabindex="-1">场景 B：完全手动控制 <code>fileList</code> <a class="header-anchor" href="#场景-b-完全手动控制-filelist" aria-label="Permalink to &quot;场景 B：完全手动控制 \`fileList\`&quot;">​</a></h3><ul><li>选择文件时：同样<strong>会触发 <code>onChange</code></strong>（加入列表）。</li><li>之后只有当你<strong>自己变更 <code>fileList</code></strong>（添加/移除/替换）才会再次触发。</li><li>只要你<strong>不触发上传请求</strong>，就不会有进度/完成回调。</li></ul><hr><h2 id="开发建议-最小实践" tabindex="-1">开发建议（最小实践） <a class="header-anchor" href="#开发建议-最小实践" aria-label="Permalink to &quot;开发建议（最小实践）&quot;">​</a></h2><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 复杂逻辑：阻止自动上传，仅用于把文件放进列表 + onChange 通知你</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> beforeUpload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 复杂逻辑：在 onChange 中仅处理“列表变化”而非“上传进度”</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleChange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UploadProps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;onChange&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fileList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 列表同步</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  _fileList.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fileList;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 没有发起上传时，不会出现 percent/response，这里避免做进度/完成相关逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[picked]&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: file.name,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    status: file.status, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 可能是 &#39;uploading&#39; 或实现相关的状态；不可靠用它判断“是否已上传”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    percent: file.percent, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 基本为 undefined</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    hasResponse: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(file </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).response, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 如果你要“手动上传”，此处触发你的自定义上传流程（例如自行发起请求）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // uploadManually(file.originFileObj)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><blockquote><p>提示：<strong>不要依赖 <code>status</code> 来判断“是否上传完成”</strong>（在阻止上传的场景里它没有语义保证）。 更稳妥的方式是：<strong>以是否存在 <code>response</code>（或你自定义的成功标记）为准</strong>。</p></blockquote><hr><h2 id="配套知识点回顾-结合上次总结" tabindex="-1">配套知识点回顾（结合上次总结） <a class="header-anchor" href="#配套知识点回顾-结合上次总结" aria-label="Permalink to &quot;配套知识点回顾（结合上次总结）&quot;">​</a></h2><ul><li><strong>时序</strong>（自动上传）：选择 → <code>beforeUpload</code> → <code>transformFile</code>（若有）→ 发请求 → <code>onChange(uploading/0%)</code> → <code>onChange(…/100%)</code> → <code>onChange(done/error)</code></li><li><strong>第二次 100% 日志</strong>通常来自 <strong>XHR 进度事件</strong>； 文件从 <code>png → jpeg</code>、体积骤降属于 <strong><code>beforeUpload/transformFile</code> 的“前置替换”</strong> 导致的属性变化。</li><li><strong>不上传的场景</strong>：仍会在<strong>选择/删除</strong>时触发 <code>onChange</code>，但<strong>不会</strong>有进度、完成态。</li></ul><hr><h2 id="调试清单-适用于-禁用自动上传" tabindex="-1">调试清单（适用于“禁用自动上传”） <a class="header-anchor" href="#调试清单-适用于-禁用自动上传" aria-label="Permalink to &quot;调试清单（适用于“禁用自动上传”）&quot;">​</a></h2><ul><li>在 <code>onChange</code> 打印：<code>file.name/status/percent/response</code>，确认<strong>仅有列表变化</strong>的触发。</li><li>若你在 <code>beforeUpload</code> 做了压缩/转码并返回新 <code>File</code>，可给返回对象打标（如 <code>__fromTransform=true</code>）方便在 <code>onChange</code> 溯源。</li><li>只有当你<strong>真正发起上传请求</strong>（无论是组件自动还是你手动）时，才会出现<strong>进度与完成</strong>相关的 <code>onChange</code> 触发。</li></ul>`,23)])])}const c=i(l,[["render",t]]);export{g as __pageData,c as default};
