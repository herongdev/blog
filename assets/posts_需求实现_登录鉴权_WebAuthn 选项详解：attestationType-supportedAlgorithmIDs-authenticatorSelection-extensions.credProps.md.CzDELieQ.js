import{_ as t,c as i,o as e,ag as a}from"./chunks/framework.oqSrIbQK.js";const c=JSON.parse('{"title":"WebAuthn 选项详解：attestationType / supportedAlgorithmIDs / authenticatorSelection / extensions.credProps","description":"","frontmatter":{"title":"WebAuthn 选项详解：attestationType / supportedAlgorithmIDs / authenticatorSelection / extensions.credProps","date":"2025-09-19T00:00:00.000Z","tags":["WebAuthn","Passkeys","simplewebauthn"]},"headers":[],"relativePath":"posts/需求实现/登录鉴权/WebAuthn 选项详解：attestationType-supportedAlgorithmIDs-authenticatorSelection-extensions.credProps.md","filePath":"posts/需求实现/登录鉴权/WebAuthn 选项详解：attestationType-supportedAlgorithmIDs-authenticatorSelection-extensions.credProps.md","lastUpdated":1758475234000}'),n={name:"posts/需求实现/登录鉴权/WebAuthn 选项详解：attestationType-supportedAlgorithmIDs-authenticatorSelection-extensions.credProps.md"};function r(d,s,h,o,l,p){return e(),i("div",null,[...s[0]||(s[0]=[a('<h2 id="场景" tabindex="-1">场景 <a class="header-anchor" href="#场景" aria-label="Permalink to &quot;场景&quot;">​</a></h2><p>你在注册时传了这段配置：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attestationType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;none&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supportedAlgorithmIDs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 仅 ES256；如需 RS256 可再加 -257</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">authenticatorSelection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  residentKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;required&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  userVerification</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;preferred&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extensions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">credProps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span></code></pre></div><p>下面把<strong>作用</strong>、<strong>可选值</strong>与<strong>含义</strong>逐项讲清楚，并给出常见取值建议。</p><hr><h2 id="_1-attestationtype" tabindex="-1">1) <code>attestationType</code> <a class="header-anchor" href="#_1-attestationtype" aria-label="Permalink to &quot;1) `attestationType`&quot;">​</a></h2><p><strong>作用</strong>：告诉浏览器/认证器，你希望拿到怎样的&quot;证明这把公钥来自哪个厂商/设备&quot;的<strong>证明材料（Attestation）</strong>。 <strong>可选值</strong>（WebAuthn 标准/<code>simplewebauthn</code> 一致）：</p><table tabindex="0"><thead><tr><th>取值</th><th>含义</th><th>典型用途</th></tr></thead><tbody><tr><td><code>none</code></td><td>不要设备证明，只要公钥即可；最隐私、最通用。</td><td><strong>推荐</strong>给 B2C/通用站点（不校验设备来源）。</td></tr><tr><td><code>indirect</code></td><td>由平台挑选匿名化或中介的证明格式，可能给到有限厂商信息。</td><td>基本很少用。</td></tr><tr><td><code>direct</code></td><td>要求直接的设备证明，便于校验厂商证书链。</td><td>合规/高安全场景，需维护证书信任。</td></tr><tr><td><code>enterprise</code></td><td>企业专用，可拿到可唯一识别设备的证明。</td><td>需要设备可追溯的企业场景；通常需额外资质。</td></tr></tbody></table><blockquote><p>你的取值：<code>&#39;none&#39;</code> → 省心、隐私友好、成功率高。</p></blockquote><hr><h2 id="_2-supportedalgorithmids" tabindex="-1">2) <code>supportedAlgorithmIDs</code> <a class="header-anchor" href="#_2-supportedalgorithmids" aria-label="Permalink to &quot;2) `supportedAlgorithmIDs`&quot;">​</a></h2><p><strong>作用</strong>：指定<strong>可接受的公钥算法</strong>（COSE 算法 ID 列表）。浏览器会在这些里选一个创建公钥。 <strong>常见取值</strong>（COSE ID → 算法）：</p><table tabindex="0"><thead><tr><th>COSE ID</th><th>算法</th><th>说明</th></tr></thead><tbody><tr><td><code>-7</code></td><td><strong>ES256</strong>（ECDSA w/ SHA-256）</td><td><strong>WebAuthn 强烈推荐/最普及</strong>，跨平台兼容最好。</td></tr><tr><td><code>-257</code></td><td><strong>RS256</strong>（RSASSA-PKCS1-v1_5 w/ SHA-256）</td><td>一些旧平台/安全钥匙需要；密钥体积更大。</td></tr><tr><td><code>-8</code></td><td><strong>EdDSA</strong>（常见 Ed25519）</td><td>新趋势，部分平台/浏览器逐步支持。</td></tr></tbody></table><blockquote><p>你的取值：<code>[-7]</code> → 仅 ES256。 <strong>建议</strong>：如需兼容老设备/Windows Hello 某些环境，可改为 <code>[-7, -257]</code>；若想前瞻支持，可加 <code>-8</code>（视目标平台而定）。</p></blockquote><hr><h2 id="_3-authenticatorselection" tabindex="-1">3) <code>authenticatorSelection</code> <a class="header-anchor" href="#_3-authenticatorselection" aria-label="Permalink to &quot;3) `authenticatorSelection`&quot;">​</a></h2><p><strong>作用</strong>：约束要创建哪种类型的凭据/交互体验。</p><h3 id="_3-1-residentkey" tabindex="-1">3.1 <code>residentKey</code> <a class="header-anchor" href="#_3-1-residentkey" aria-label="Permalink to &quot;3.1 `residentKey`&quot;">​</a></h3><p>是否创建<strong>可发现凭据（Discoverable Credential / &quot;本地居民密钥&quot;）</strong>，也就是通常说的<strong>Passkey</strong>（用户名可省略，靠设备里保存的账户标识来找回）。</p><table tabindex="0"><thead><tr><th>取值</th><th>含义</th><th>体验影响</th></tr></thead><tbody><tr><td><code>required</code></td><td><strong>必须</strong>创建可发现凭据。</td><td>支持&quot;无用户名登录&quot;、<strong>Conditional UI 一键直登</strong>；占用设备存储。</td></tr><tr><td><code>preferred</code></td><td><strong>尽量</strong>创建；不行就退回不可发现。</td><td>成功率高，可能部分用户仍生成不可发现。</td></tr><tr><td><code>discouraged</code></td><td>不鼓励（通常就创建不可发现凭据）。</td><td>需要用户名 + 凭据句柄才能登录；非 passkey 体验。</td></tr></tbody></table><blockquote><p>你的取值：<code>&#39;required&#39;</code> → 明确走 <strong>Passkey</strong> 路线（推荐做法）。</p></blockquote><h3 id="_3-2-userverification" tabindex="-1">3.2 <code>userVerification</code> <a class="header-anchor" href="#_3-2-userverification" aria-label="Permalink to &quot;3.2 `userVerification`&quot;">​</a></h3><p>是否要求<strong>用户验证</strong>（UV：指纹/人脸/PIN 等）。</p><table tabindex="0"><thead><tr><th>取值</th><th>含义</th><th>体验影响</th></tr></thead><tbody><tr><td><code>required</code></td><td>必须进行 UV。</td><td><strong>最安全</strong>，一定会弹 biometrics/PIN。</td></tr><tr><td><code>preferred</code></td><td>能 UV 就做；没有也可继续。</td><td><strong>折中</strong>：有生物识别就用，没有也不阻塞。</td></tr><tr><td><code>discouraged</code></td><td>不希望 UV。</td><td>免打扰，但安全性最低，少见于账号体系。</td></tr></tbody></table><blockquote><p>你的取值：<code>&#39;preferred&#39;</code> → 让支持生物识别的设备走强校验，同时兼顾广泛兼容性。 <strong>建议</strong>：如果是<strong>高敏/企业后台</strong>，可改为 <code>&#39;required&#39;</code>。</p></blockquote><hr><h2 id="_4-extensions-credprops-true" tabindex="-1">4) <code>extensions: { credProps: true }</code> <a class="header-anchor" href="#_4-extensions-credprops-true" aria-label="Permalink to &quot;4) `extensions: { credProps: true }`&quot;">​</a></h2><p><strong>作用</strong>：启用 <strong>Credential Properties 扩展</strong>，让返回结果里带上<strong>这把凭据是否为可发现凭据</strong>等属性。 <strong>返回</strong>：通常会得到 <code>clientExtensionResults.credProps = { rk?: boolean }</code>，其中：</p><ul><li><code>rk: true</code> → 表示<strong>创建了可发现凭据</strong>（resident key）。</li><li><code>rk: false/缺失</code> → 不是可发现凭据，或平台未返回。</li></ul><blockquote><p>你的取值：<code>credProps: true</code> → 便于<strong>落库记录</strong>这把凭据是否为 passkey、做后续风控或回显。</p></blockquote><hr><h2 id="常见组合与建议" tabindex="-1">常见组合与建议 <a class="header-anchor" href="#常见组合与建议" aria-label="Permalink to &quot;常见组合与建议&quot;">​</a></h2><ul><li><p><strong>通用 B2C / 技术社区登录</strong>（首选）</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attestationType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;none&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supportedAlgorithmIDs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">257</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ES256 优先，兼容 RS256</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">authenticatorSelection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">residentKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;required&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">userVerification</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;preferred&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extensions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">credProps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><ul><li>目标：高成功率 + Passkey 体验 + 宽兼容。</li></ul></li><li><p><strong>高安全后台/企业管理台</strong></p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attestationType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;none&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;direct&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 视合规要求</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supportedAlgorithmIDs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">257</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">authenticatorSelection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">residentKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;required&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">userVerification</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;required&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extensions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">credProps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><ul><li>目标：强制生物识别；如需设备可追溯再考虑 <code>direct/enterprise</code>（谨慎）。</li></ul></li></ul><hr><h2 id="小结-对应你的现配" tabindex="-1">小结（对应你的现配） <a class="header-anchor" href="#小结-对应你的现配" aria-label="Permalink to &quot;小结（对应你的现配）&quot;">​</a></h2><ul><li><code>attestationType: &#39;none&#39;</code>：最省心、最隐私，推荐。</li><li><code>supportedAlgorithmIDs: [-7]</code>：仅 ES256；为兼容面可加 <code>-257</code>（RS256），前瞻再加 <code>-8</code>（EdDSA）。</li><li><code>residentKey: &#39;required&#39;</code>：明确走 <strong>Passkey/可发现凭据</strong>，利于<strong>无用户名登录</strong>与<strong>Conditional UI</strong>。</li><li><code>userVerification: &#39;preferred&#39;</code>：有生物识别就启用，兼顾成功率与体验。</li><li><code>credProps: true</code>：拿到 <code>rk</code> 标志，便于你在服务端做记录与策略。</li></ul>',36)])])}const g=t(n,[["render",r]]);export{c as __pageData,g as default};
