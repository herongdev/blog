import{_ as a,c as i,o as n,ag as l}from"./chunks/framework.oqSrIbQK.js";const c=JSON.parse('{"title":"EGL 是什么：OpenGL 与系统之间的“翻译官 + 中介”","description":"用大白话理解 EGL：Display/Surface/Context 三件套、完整初始化流程、为什么需要 EGL，以及在鸿蒙上的典型用法。","frontmatter":{"title":"EGL 是什么：OpenGL 与系统之间的“翻译官 + 中介”","date":"2025-01-27T00:00:00.000Z","tags":["EGL","OpenGL ES","图形","HarmonyOS"],"description":"用大白话理解 EGL：Display/Surface/Context 三件套、完整初始化流程、为什么需要 EGL，以及在鸿蒙上的典型用法。"},"headers":[],"relativePath":"posts/cpp教程/基础入门/EGL-是什么-OpenGL与系统之间的翻译官.md","filePath":"posts/cpp教程/基础入门/EGL-是什么-OpenGL与系统之间的翻译官.md","lastUpdated":1764331727000}'),e={name:"posts/cpp教程/基础入门/EGL-是什么-OpenGL与系统之间的翻译官.md"};function p(t,s,h,k,E,d){return n(),i("div",null,[...s[0]||(s[0]=[l(`<h2 id="egl-就是-翻译官-中介" tabindex="-1">EGL 就是“翻译官 + 中介” <a class="header-anchor" href="#egl-就是-翻译官-中介" aria-label="Permalink to &quot;EGL 就是“翻译官 + 中介”&quot;">​</a></h2><p>OpenGL（画图 API）不能直接“说话”给系统的窗口/屏幕。EGL 负责把 OpenGL 的请求翻译成系统能懂的调用，并在两者之间做资源中介。</p><h3 id="没有-egl-的情况" tabindex="-1">没有 EGL 的情况 <a class="header-anchor" href="#没有-egl-的情况" aria-label="Permalink to &quot;没有 EGL 的情况&quot;">​</a></h3><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>OpenGL（画家）  ❌  无法直接沟通  ❌  操作系统/窗口系统（画布）</span></span></code></pre></div><h3 id="有-egl-的情况" tabindex="-1">有 EGL 的情况 <a class="header-anchor" href="#有-egl-的情况" aria-label="Permalink to &quot;有 EGL 的情况&quot;">​</a></h3><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>OpenGL（画家）  ↔  EGL（翻译官）  ↔  操作系统/窗口系统（画布）</span></span></code></pre></div><h2 id="三件套-display-surface-context" tabindex="-1">三件套：Display / Surface / Context <a class="header-anchor" href="#三件套-display-surface-context" aria-label="Permalink to &quot;三件套：Display / Surface / Context&quot;">​</a></h2><h3 id="_1-egldisplay-——-工作场地" tabindex="-1">1) EGLDisplay —— “工作场地” <a class="header-anchor" href="#_1-egldisplay-——-工作场地" aria-label="Permalink to &quot;1) EGLDisplay —— “工作场地”&quot;">​</a></h3><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EGLDisplay display_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EGL_NO_DISPLAY;</span></span></code></pre></div><ul><li>连接显示系统/设备的“工作室”。</li><li>没有它，就谈不上初始化和绘制。</li></ul><h3 id="_2-eglsurface-——-画布" tabindex="-1">2) EGLSurface —— “画布” <a class="header-anchor" href="#_2-eglsurface-——-画布" aria-label="Permalink to &quot;2) EGLSurface —— “画布”&quot;">​</a></h3><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EGLSurface surface_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EGL_NO_SURFACE;</span></span></code></pre></div><ul><li>真正可以被显示/交换的缓冲区（前后台缓冲）。</li><li>窗口 Surface（window surface）通常来自系统窗口句柄。</li></ul><h3 id="_3-eglcontext-——-工具箱和规则" tabindex="-1">3) EGLContext —— “工具箱和规则” <a class="header-anchor" href="#_3-eglcontext-——-工具箱和规则" aria-label="Permalink to &quot;3) EGLContext —— “工具箱和规则”&quot;">​</a></h3><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EGLContext context_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EGL_NO_CONTEXT;</span></span></code></pre></div><ul><li>OpenGL ES 的执行上下文：包含着着色器/状态/资源的规则与载体。</li><li>没有当前上下文就不能调用 GL 函数绘制。</li></ul><h2 id="完整初始化流程-类比-代码" tabindex="-1">完整初始化流程（类比 + 代码） <a class="header-anchor" href="#完整初始化流程-类比-代码" aria-label="Permalink to &quot;完整初始化流程（类比 + 代码）&quot;">​</a></h2><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. 找到工作场地（连接显示系统）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EGLDisplay display </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> eglGetDisplay</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(EGL_DEFAULT_DISPLAY);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. 初始化 EGL</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eglInitialize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(display, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. 选择配置（像挑画布材质）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EGLint cfgAttrs[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  EGL_RED_SIZE,   </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  EGL_GREEN_SIZE, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  EGL_BLUE_SIZE,  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  EGL_ALPHA_SIZE, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  EGL_RENDERABLE_TYPE, EGL_OPENGL_ES3_BIT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  EGL_SURFACE_TYPE,    EGL_WINDOW_BIT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  EGL_NONE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EGLConfig cfg; EGLint num </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eglChooseConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(display, cfgAttrs, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cfg, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">num);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 4. 准备画布（把窗口和 EGL 绑定）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// window_ 为系统提供的原生窗口句柄（HarmonyOS: XComponent window）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EGLSurface surface </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> eglCreateWindowSurface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(display, cfg, window_, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 5. 准备绘图工具（OpenGL ES 上下文）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EGLint ctxAttrs[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { EGL_CONTEXT_CLIENT_VERSION, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, EGL_NONE };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EGLContext context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> eglCreateContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(display, cfg, EGL_NO_CONTEXT, ctxAttrs);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 6. 开始绘画（让上下文与画布成为“当前”）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eglMakeCurrent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(display, surface, surface, context);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 7. 展示作品（交换前后缓冲）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eglSwapBuffers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(display, surface);</span></span></code></pre></div><p>类比流程：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1) eglGetDisplay        → 找到画廊（能展示的地方）</span></span>
<span class="line"><span>2) eglInitialize        → 布置基础设施（灯光/展架）</span></span>
<span class="line"><span>3) eglChooseConfig      → 选画布材质（像素格式/能力）</span></span>
<span class="line"><span>4) eglCreateWindowSurface → 装裱到画架（窗口绑定画布）</span></span>
<span class="line"><span>5) eglCreateContext     → 准备画笔和规则（GL 上下文）</span></span>
<span class="line"><span>6) eglMakeCurrent       → 人到位、提笔临画（设为当前）</span></span>
<span class="line"><span>7) eglSwapBuffers       → 把画给观众看（前后缓冲交换）</span></span></code></pre></div><h2 id="为什么需要-egl" tabindex="-1">为什么需要 EGL？ <a class="header-anchor" href="#为什么需要-egl" aria-label="Permalink to &quot;为什么需要 EGL？&quot;">​</a></h2><p>不同系统对“怎么把图画到屏幕上”各有“方言”：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Windows → WGL</span></span>
<span class="line"><span>Linux   → GLX/EGL</span></span>
<span class="line"><span>Android → EGL</span></span>
<span class="line"><span>HarmonyOS → EGL</span></span></code></pre></div><p>EGL 提供统一接口：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>OpenGL ES → 统一说“EGL 语言” → 各个系统/窗口管理器</span></span></code></pre></div><p>开发者只要会 EGL，一套 OpenGL ES 代码就能跨系统跑。</p><h2 id="harmonyos-xcomponent-场景" tabindex="-1">HarmonyOS/XComponent 场景 <a class="header-anchor" href="#harmonyos-xcomponent-场景" aria-label="Permalink to &quot;HarmonyOS/XComponent 场景&quot;">​</a></h2><p>配合 XComponent 的原生 window，常见做法：</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// window 来自 XComponent 的回调（如 onSurfaceCreated 提供的 window）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">surface </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> eglCreateWindowSurface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(display, cfg, window, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> eglCreateContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(display, cfg, EGL_NO_CONTEXT, ctxAttrs);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eglMakeCurrent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(display, surface, surface, context);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 之后就可以调用 GL 进行绘制</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">glViewport</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">glClearColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">glClear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(GL_COLOR_BUFFER_BIT);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eglSwapBuffers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(display, surface);</span></span></code></pre></div><h2 id="关键-api-速览" tabindex="-1">关键 API 速览 <a class="header-anchor" href="#关键-api-速览" aria-label="Permalink to &quot;关键 API 速览&quot;">​</a></h2><ul><li><code>eglGetDisplay</code>：获取显示连接。</li><li><code>eglInitialize</code>：初始化 EGL。</li><li><code>eglChooseConfig</code>：选择像素格式/渲染能力等配置。</li><li><code>eglCreateWindowSurface</code>：从原生窗口创建可显示的 Surface。</li><li><code>eglCreateContext</code>：创建 OpenGL ES 上下文。</li><li><code>eglMakeCurrent</code>：绑定当前上下文与绘制/读取 Surface。</li><li><code>eglSwapBuffers</code>：交换前后缓冲，把结果显示出来。</li></ul><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><ul><li>EGL 是 OpenGL 与系统之间的“翻译官 + 中介”。</li><li>三件套：Display（场地）/ Surface（画布）/ Context（工具）。</li><li>一次性学会 EGL，把 OpenGL 作品带到不同系统展示。</li></ul>`,33)])])}const o=a(e,[["render",p]]);export{c as __pageData,o as default};
