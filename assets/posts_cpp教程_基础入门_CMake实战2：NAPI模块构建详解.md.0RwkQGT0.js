import{_ as i,c as a,o as n,ag as t}from"./chunks/framework.oqSrIbQK.js";const g=JSON.parse('{"title":"CMake å®æˆ˜ 2ï¼šNAPI æ¨¡å—æ„å»ºè¯¦è§£","description":"æ·±å…¥è§£æ CMake åœ¨ NAPI é¡¹ç›®ä¸­çš„åº”ç”¨ï¼šä»ç¬¬ä¸‰æ–¹åº“åˆ° NAPI æ¨¡å—çš„å®Œæ•´æ„å»ºæµç¨‹ã€‚","frontmatter":{"title":"CMake å®æˆ˜ 2ï¼šNAPI æ¨¡å—æ„å»ºè¯¦è§£","date":"2025-01-27T00:00:00.000Z","tags":["CMake","NAPI","HarmonyOS","åŸç”Ÿå¼€å‘"],"description":"æ·±å…¥è§£æ CMake åœ¨ NAPI é¡¹ç›®ä¸­çš„åº”ç”¨ï¼šä»ç¬¬ä¸‰æ–¹åº“åˆ° NAPI æ¨¡å—çš„å®Œæ•´æ„å»ºæµç¨‹ã€‚"},"headers":[],"relativePath":"posts/cppæ•™ç¨‹/åŸºç¡€å…¥é—¨/CMakeå®æˆ˜2ï¼šNAPIæ¨¡å—æ„å»ºè¯¦è§£.md","filePath":"posts/cppæ•™ç¨‹/åŸºç¡€å…¥é—¨/CMakeå®æˆ˜2ï¼šNAPIæ¨¡å—æ„å»ºè¯¦è§£.md","lastUpdated":1764331727000}'),p={name:"posts/cppæ•™ç¨‹/åŸºç¡€å…¥é—¨/CMakeå®æˆ˜2ï¼šNAPIæ¨¡å—æ„å»ºè¯¦è§£.md"};function l(h,s,e,k,d,r){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="cmake-å®æˆ˜-2-napi-æ¨¡å—æ„å»ºè¯¦è§£" tabindex="-1">CMake å®æˆ˜ 2ï¼šNAPI æ¨¡å—æ„å»ºè¯¦è§£ <a class="header-anchor" href="#cmake-å®æˆ˜-2-napi-æ¨¡å—æ„å»ºè¯¦è§£" aria-label="Permalink to &quot;CMake å®æˆ˜ 2ï¼šNAPI æ¨¡å—æ„å»ºè¯¦è§£&quot;">â€‹</a></h1><blockquote><p>æ·±å…¥è§£æå¦‚ä½•åœ¨ HarmonyOS é¡¹ç›®ä¸­ä½¿ç”¨ CMake æ„å»º NAPI æ¨¡å—ï¼ŒåŒ…æ‹¬ç¬¬ä¸‰æ–¹åº“ç®¡ç†ã€å¤´æ–‡ä»¶è·¯å¾„è®¾ç½®å’Œä¾èµ–é“¾æ¥ã€‚</p></blockquote><h2 id="ğŸ“š-é¡¹ç›®ç»“æ„" tabindex="-1">ğŸ“š é¡¹ç›®ç»“æ„ <a class="header-anchor" href="#ğŸ“š-é¡¹ç›®ç»“æ„" aria-label="Permalink to &quot;ğŸ“š é¡¹ç›®ç»“æ„&quot;">â€‹</a></h2><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>entry/src/main/cpp/</span></span>
<span class="line"><span>â”œâ”€â”€ CMakeLists.txt          â† ä¸»æ„å»ºæ–‡ä»¶ï¼ˆæœ¬æ–‡é‡ç‚¹ï¼‰</span></span>
<span class="line"><span>â”œâ”€â”€ napi_init.cpp           â† NAPI åˆå§‹åŒ–ä»£ç </span></span>
<span class="line"><span>â””â”€â”€ 3rd/</span></span>
<span class="line"><span>    â””â”€â”€ native_add/</span></span>
<span class="line"><span>        â”œâ”€â”€ CMakeLists.txt  â† ç¬¬ä¸‰æ–¹åº“æ„å»ºæ–‡ä»¶</span></span>
<span class="line"><span>        â”œâ”€â”€ add.h</span></span>
<span class="line"><span>        â””â”€â”€ add.c</span></span></code></pre></div><hr><h2 id="ğŸ¯-ä¸»-cmakelists-txt-é€è¡Œè¯¦è§£" tabindex="-1">ğŸ¯ ä¸» CMakeLists.txt é€è¡Œè¯¦è§£ <a class="header-anchor" href="#ğŸ¯-ä¸»-cmakelists-txt-é€è¡Œè¯¦è§£" aria-label="Permalink to &quot;ğŸ¯ ä¸» CMakeLists.txt é€è¡Œè¯¦è§£&quot;">â€‹</a></h2><h3 id="_1-åŸºç¡€è®¾ç½®" tabindex="-1">1. åŸºç¡€è®¾ç½® <a class="header-anchor" href="#_1-åŸºç¡€è®¾ç½®" aria-label="Permalink to &quot;1. åŸºç¡€è®¾ç½®&quot;">â€‹</a></h3><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">cmake_minimum_required</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VERSION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 3.16)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">project</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry_native)</span></span></code></pre></div><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>æŒ‡å®šæœ€ä½ CMake ç‰ˆæœ¬ 3.16</li><li>å®šä¹‰é¡¹ç›®åç§° <code>entry_native</code></li></ul><p><strong>ä¸ºä»€ä¹ˆ</strong>ï¼šä¸åŒç‰ˆæœ¬çš„ CMake è¯­æ³•å¯èƒ½ä¸åŒï¼ŒæŒ‡å®šç‰ˆæœ¬å¯ä»¥ä¿è¯å…¼å®¹æ€§ã€‚</p><h3 id="_2-c-æ ‡å‡†è®¾ç½®" tabindex="-1">2. C++ æ ‡å‡†è®¾ç½® <a class="header-anchor" href="#_2-c-æ ‡å‡†è®¾ç½®" aria-label="Permalink to &quot;2. C++ æ ‡å‡†è®¾ç½®&quot;">â€‹</a></h3><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_CXX_STANDARD 17)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_CXX_STANDARD_REQUIRED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li><code>CMAKE_CXX_STANDARD 17</code>ï¼šä½¿ç”¨ C++17 æ ‡å‡†</li><li><code>CMAKE_CXX_STANDARD_REQUIRED ON</code>ï¼šå¿…é¡»ä½¿ç”¨ï¼Œä¸å…è®¸é™çº§</li></ul><p><strong>ä¸ºä»€ä¹ˆ</strong>ï¼šNAPI å¼€å‘é€šå¸¸éœ€è¦ç°ä»£ C++ ç‰¹æ€§ï¼ŒC++17 æä¾›äº†è¶³å¤Ÿçš„è¯­è¨€æ”¯æŒã€‚</p><h3 id="_3-æ¶æ„ä¿¡æ¯æ‰“å°" tabindex="-1">3. æ¶æ„ä¿¡æ¯æ‰“å° <a class="header-anchor" href="#_3-æ¶æ„ä¿¡æ¯æ‰“å°" aria-label="Permalink to &quot;3. æ¶æ„ä¿¡æ¯æ‰“å°&quot;">â€‹</a></h3><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;OHOS_ARCH=\${OHOS_ARCH}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>ä½œç”¨</strong>ï¼šæ‰“å°å½“å‰ CPU æ¶æ„ä¿¡æ¯åˆ°æ§åˆ¶å°</p><p><strong>è¾“å‡ºç¤ºä¾‹</strong>ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>-- OHOS_ARCH=arm64-v8a</span></span></code></pre></div><p><strong>ä¸ºä»€ä¹ˆ</strong>ï¼šæ–¹ä¾¿è°ƒè¯•ï¼Œç¡®è®¤åœ¨æ­£ç¡®çš„æ¶æ„ä¸‹ç¼–è¯‘ã€‚</p><hr><h2 id="ğŸ”§-æ ¸å¿ƒæ„å»ºæµç¨‹" tabindex="-1">ğŸ”§ æ ¸å¿ƒæ„å»ºæµç¨‹ <a class="header-anchor" href="#ğŸ”§-æ ¸å¿ƒæ„å»ºæµç¨‹" aria-label="Permalink to &quot;ğŸ”§ æ ¸å¿ƒæ„å»ºæµç¨‹&quot;">â€‹</a></h2><h3 id="_4-æ„å»ºç¬¬ä¸‰æ–¹åº“" tabindex="-1">4. æ„å»ºç¬¬ä¸‰æ–¹åº“ <a class="header-anchor" href="#_4-æ„å»ºç¬¬ä¸‰æ–¹åº“" aria-label="Permalink to &quot;4. æ„å»ºç¬¬ä¸‰æ–¹åº“&quot;">â€‹</a></h3><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_subdirectory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\${CMAKE_CURRENT_SOURCE_DIR}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/3rd/native_add)</span></span></code></pre></div><p><strong>ä½œç”¨</strong>ï¼šå°†ç¬¬ä¸‰æ–¹åº“å­ç›®å½•åŠ å…¥æ„å»ºæµç¨‹</p><p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p><ol><li>è¿›å…¥ <code>3rd/native_add</code> ç›®å½•</li><li>è¯»å–è¯¥ç›®å½•ä¸‹çš„ <code>CMakeLists.txt</code></li><li>æ‰§è¡Œå…¶ä¸­çš„æ„å»ºå‘½ä»¤</li><li>ç”Ÿæˆ <code>libnativeAdd.so</code> åŠ¨æ€åº“</li><li>è¾“å‡ºåˆ° <code>entry/libs/&lt;ABI&gt;/</code> ç›®å½•</li></ol><p><strong>ç±»æ¯”</strong>ï¼šå°±åƒè¯´&quot;å…ˆå»æŠŠé‚£ä¸ªåšåŠ æ³•è¿ç®—çš„å°å·¥å‚å»ºèµ·æ¥&quot;</p><p><strong>è·¯å¾„è§£æ</strong>ï¼š</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>\${CMAKE_CURRENT_SOURCE_DIR} = entry/src/main/cpp</span></span>
<span class="line"><span>3rd/native_add                = ç¬¬ä¸‰æ–¹åº“ç›®å½•</span></span>
<span class="line"><span>æœ€ç»ˆè·¯å¾„                      = entry/src/main/cpp/3rd/native_add</span></span></code></pre></div><h3 id="_5-æ„å»º-napi-æ¨¡å—" tabindex="-1">5. æ„å»º NAPI æ¨¡å— <a class="header-anchor" href="#_5-æ„å»º-napi-æ¨¡å—" aria-label="Permalink to &quot;5. æ„å»º NAPI æ¨¡å—&quot;">â€‹</a></h3><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_library</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry SHARED</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    \${CMAKE_CURRENT_SOURCE_DIR}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/napi_init.cpp</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>å‚æ•°è¯¦è§£</strong>ï¼š</p><ul><li><code>entry</code>ï¼šç›®æ ‡åç§°ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰</li><li><code>SHARED</code>ï¼šç”ŸæˆåŠ¨æ€åº“ï¼ˆ.so æ–‡ä»¶ï¼‰</li><li><code>napi_init.cpp</code>ï¼šæºä»£ç æ–‡ä»¶</li></ul><p><strong>ç”Ÿæˆçš„æ–‡ä»¶</strong>ï¼š</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>build/</span></span>
<span class="line"><span>â””â”€â”€ libentry.so  â† æœ€ç»ˆç”Ÿæˆçš„ NAPI æ¨¡å—</span></span></code></pre></div><p><strong>æ¨¡å—åçº¦å®š</strong>ï¼š</p><ul><li>CMake ä¸­çš„ç›®æ ‡åï¼š<code>entry</code>ï¼ˆæ„å»ºæ—¶ä½¿ç”¨ï¼‰</li><li>æœ€ç»ˆæ¨¡å—åï¼šç”± <code>napi_init.cpp</code> ä¸­çš„ <code>nm_modname</code> å†³å®š</li><li>ArkTS å¯¼å…¥åï¼š<code>nm_modname</code> æŒ‡å®šçš„åå­—</li></ul><p><strong>ç¤ºä¾‹ä»£ç ï¼ˆnapi_init.cppï¼‰</strong>ï¼š</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_module entryModule </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .nm_version </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .nm_flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .nm_filename </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .nm_register_func </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Init,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // åˆå§‹åŒ–å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .nm_modname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;entry_native&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // â† è¿™ä¸ªæ‰æ˜¯ ArkTS ç”¨çš„åå­—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .nm_priv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .reserved </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><p>ArkTS ä¸­ä½¿ç”¨ï¼š</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> entry_native </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;libentry.so&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨ nm_modname</span></span></code></pre></div><hr><h2 id="ğŸ“‚-å¤´æ–‡ä»¶è·¯å¾„ç®¡ç†" tabindex="-1">ğŸ“‚ å¤´æ–‡ä»¶è·¯å¾„ç®¡ç† <a class="header-anchor" href="#ğŸ“‚-å¤´æ–‡ä»¶è·¯å¾„ç®¡ç†" aria-label="Permalink to &quot;ğŸ“‚ å¤´æ–‡ä»¶è·¯å¾„ç®¡ç†&quot;">â€‹</a></h2><h3 id="_6-è®¾ç½®å¤´æ–‡ä»¶æœç´¢è·¯å¾„" tabindex="-1">6. è®¾ç½®å¤´æ–‡ä»¶æœç´¢è·¯å¾„ <a class="header-anchor" href="#_6-è®¾ç½®å¤´æ–‡ä»¶æœç´¢è·¯å¾„" aria-label="Permalink to &quot;6. è®¾ç½®å¤´æ–‡ä»¶æœç´¢è·¯å¾„&quot;">â€‹</a></h3><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target_include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PUBLIC</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    \${CMAKE_CURRENT_SOURCE_DIR}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                   # å½“å‰ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    \${CMAKE_CURRENT_SOURCE_DIR}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/3rd/native_add   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¬¬ä¸‰æ–¹åº“ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>è·¯å¾„è¯¦è§£</strong>ï¼š</p><p><strong>è·¯å¾„ 1ï¼šå½“å‰ç›®å½•</strong></p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>\${CMAKE_CURRENT_SOURCE_DIR} = entry/src/main/cpp/</span></span></code></pre></div><p>ç”¨äºåŒ…å«æœ¬åœ°çš„å¤´æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;my_local_header.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä» entry/src/main/cpp/ æŸ¥æ‰¾</span></span></code></pre></div><p><strong>è·¯å¾„ 2ï¼šç¬¬ä¸‰æ–¹åº“ç›®å½•</strong></p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>\${CMAKE_CURRENT_SOURCE_DIR}/3rd/native_add = entry/src/main/cpp/3rd/native_add</span></span></code></pre></div><p>ç”¨äºåŒ…å«ç¬¬ä¸‰æ–¹åº“çš„å¤´æ–‡ä»¶ï¼š</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;add.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä» entry/src/main/cpp/3rd/native_add/ æŸ¥æ‰¾</span></span></code></pre></div><p><strong>PUBLIC çš„å«ä¹‰</strong>ï¼š</p><ul><li><code>PUBLIC</code>ï¼šä½¿ç”¨ <code>entry</code> åº“çš„å…¶ä»–åº“ä¹Ÿèƒ½è®¿é—®è¿™äº›å¤´æ–‡ä»¶è·¯å¾„</li><li>è‡ªåŠ¨ç»§æ‰¿ï¼šå¦‚æœé¡¹ç›® A ä½¿ç”¨ <code>entry</code>ï¼Œé¡¹ç›® A ä¹Ÿè‡ªåŠ¨è·å¾—è¿™äº›è·¯å¾„</li></ul><p><strong>å¯¹æ¯”è¡¨æ ¼</strong>ï¼š</p><table tabindex="0"><thead><tr><th>çº§åˆ«</th><th>è‡ªå·±ç”¨</th><th>åˆ«äººç”¨</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>PUBLIC</td><td>âœ…</td><td>âœ…</td><td>å…¬å¼€çš„å¤´æ–‡ä»¶</td></tr><tr><td>PRIVATE</td><td>âœ…</td><td>âŒ</td><td>å†…éƒ¨å®ç°å¤´æ–‡ä»¶</td></tr><tr><td>INTERFACE</td><td>âŒ</td><td>âœ…</td><td>ä»…å¤´æ–‡ä»¶åº“</td></tr></tbody></table><hr><h2 id="ğŸ”—-åº“ä¾èµ–é“¾æ¥" tabindex="-1">ğŸ”— åº“ä¾èµ–é“¾æ¥ <a class="header-anchor" href="#ğŸ”—-åº“ä¾èµ–é“¾æ¥" aria-label="Permalink to &quot;ğŸ”— åº“ä¾èµ–é“¾æ¥&quot;">â€‹</a></h2><h3 id="_7-é“¾æ¥æ‰€éœ€çš„åº“" tabindex="-1">7. é“¾æ¥æ‰€éœ€çš„åº“ <a class="header-anchor" href="#_7-é“¾æ¥æ‰€éœ€çš„åº“" aria-label="Permalink to &quot;7. é“¾æ¥æ‰€éœ€çš„åº“&quot;">â€‹</a></h3><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target_link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PUBLIC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ace_napi.z      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é¸¿è’™çš„ NAPI åº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    hilog_ndk.z     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é¸¿è’™çš„æ—¥å¿—åº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    nativeAdd       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æˆ‘ä»¬åˆšå»ºçš„åŠ æ³•åº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>é“¾æ¥è¯¦è§£</strong>ï¼š</p><h4 id="_1-ace-napi-z" tabindex="-1">â‘  <code>ace_napi.z</code> <a class="header-anchor" href="#_1-ace-napi-z" aria-label="Permalink to &quot;â‘  \`ace_napi.z\`&quot;">â€‹</a></h4><p><strong>ä½œç”¨</strong>ï¼šHarmonyOS çš„ NAPI è¿è¡Œæ—¶åº“</p><p><strong>æä¾›åŠŸèƒ½</strong>ï¼š</p><ul><li>JavaScript â†” C++ ç±»å‹è½¬æ¢</li><li>NAPI API è°ƒç”¨</li><li>å¼‚æ­¥ä»»åŠ¡æ”¯æŒ</li><li>Promise å›è°ƒ</li></ul><p><strong>å®é™…ä½¿ç”¨</strong>ï¼š</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;napi/native_api.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åŒ…å« NAPI å¤´æ–‡ä»¶</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_value</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_env</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_callback_info</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ä½¿ç”¨ NAPI API</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_value args[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    napi_get_cb_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, info, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">argc, args, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è·å–å‚æ•°å¹¶å¤„ç†...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="_2-hilog-ndk-z" tabindex="-1">â‘¡ <code>hilog_ndk.z</code> <a class="header-anchor" href="#_2-hilog-ndk-z" aria-label="Permalink to &quot;â‘¡ \`hilog_ndk.z\`&quot;">â€‹</a></h4><p><strong>ä½œç”¨</strong>ï¼šHarmonyOS çš„æ—¥å¿—åº“</p><p><strong>æä¾›åŠŸèƒ½</strong>ï¼š</p><ul><li>å¤šçº§åˆ«æ—¥å¿—è¾“å‡ºï¼ˆDEBUGã€INFOã€WARNã€ERRORï¼‰</li><li>æ—¥å¿—è¿‡æ»¤å’Œè¾“å‡ºæ§åˆ¶</li><li>æ€§èƒ½ä¼˜åŒ–</li></ul><p><strong>å®é™…ä½¿ç”¨</strong>ï¼š</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;hilog/log.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ—¥å¿—çº§åˆ«</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> constexpr</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OHOS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HiviewDFX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::HiLogLabel LABEL </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    LOG_CORE, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">D001800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Entry&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // é¢†åŸŸã€æ ‡ç­¾IDã€æ ‡ç­¾å</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ‰“å°æ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HiLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LABEL, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Debug message: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HiLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LABEL, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Info message: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HiLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LABEL, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Warning message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HiLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LABEL, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Error message: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error_code);</span></span></code></pre></div><h4 id="_3-nativeadd" tabindex="-1">â‘¢ <code>nativeAdd</code> <a class="header-anchor" href="#_3-nativeadd" aria-label="Permalink to &quot;â‘¢ \`nativeAdd\`&quot;">â€‹</a></h4><p><strong>ä½œç”¨</strong>ï¼šæˆ‘ä»¬åˆšæ‰é€šè¿‡ <code>add_subdirectory</code> ç”Ÿæˆçš„åŠ æ³•åº“</p><p><strong>æä¾›åŠŸèƒ½</strong>ï¼š</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// add.h</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// add.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b; }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b; }</span></span></code></pre></div><p><strong>åœ¨ NAPI ä¸­ä½¿ç”¨</strong>ï¼š</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;add.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä½¿ç”¨æˆ‘ä»¬åˆšæ‰è®¾ç½®çš„å¤´æ–‡ä»¶è·¯å¾„</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_value</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CallAdd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_env</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_callback_info</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è°ƒç”¨ nativeAdd åº“çš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è¿”å›ç»™ JavaScript</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_value js_result;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    napi_create_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, result, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">js_result);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> js_result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>PUBLIC çš„å«ä¹‰</strong>ï¼š</p><ul><li><code>PUBLIC</code>ï¼šä½¿ç”¨ <code>entry</code> åº“çš„å…¶ä»–åº“ä¹Ÿä¼šè‡ªåŠ¨é“¾æ¥è¿™äº›åº“</li><li>è‡ªåŠ¨ä¾èµ–ï¼šæ„å»ºç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–å…³ç³»</li></ul><hr><h2 id="ğŸ“‹-å®Œæ•´çš„æ„å»ºæµç¨‹å›¾" tabindex="-1">ğŸ“‹ å®Œæ•´çš„æ„å»ºæµç¨‹å›¾ <a class="header-anchor" href="#ğŸ“‹-å®Œæ•´çš„æ„å»ºæµç¨‹å›¾" aria-label="Permalink to &quot;ğŸ“‹ å®Œæ•´çš„æ„å»ºæµç¨‹å›¾&quot;">â€‹</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. é…ç½®é˜¶æ®µ</span></span>
<span class="line"><span>   cmake ..</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2. æ„å»ºç¬¬ä¸‰æ–¹åº“</span></span>
<span class="line"><span>   â””â”€&gt; add_subdirectory(3rd/native_add)</span></span>
<span class="line"><span>       â””â”€&gt; ç”Ÿæˆ libnativeAdd.so</span></span>
<span class="line"><span>           â””â”€&gt; è¾“å‡ºåˆ° entry/libs/arm64-v8a/</span></span>
<span class="line"><span></span></span>
<span class="line"><span>3. æ„å»º NAPI æ¨¡å—</span></span>
<span class="line"><span>   â””â”€&gt; add_library(entry SHARED napi_init.cpp)</span></span>
<span class="line"><span>       â””â”€&gt; è®¾ç½®å¤´æ–‡ä»¶è·¯å¾„</span></span>
<span class="line"><span>       â””â”€&gt; é“¾æ¥ä¾èµ–åº“</span></span>
<span class="line"><span>           â”œâ”€ ace_napi.z</span></span>
<span class="line"><span>           â”œâ”€ hilog_ndk.z</span></span>
<span class="line"><span>           â””â”€ nativeAdd</span></span>
<span class="line"><span>       â””â”€&gt; ç”Ÿæˆ libentry.so</span></span></code></pre></div><hr><h2 id="ğŸ’»-å®é™…ä»£ç ç¤ºä¾‹" tabindex="-1">ğŸ’» å®é™…ä»£ç ç¤ºä¾‹ <a class="header-anchor" href="#ğŸ’»-å®é™…ä»£ç ç¤ºä¾‹" aria-label="Permalink to &quot;ğŸ’» å®é™…ä»£ç ç¤ºä¾‹&quot;">â€‹</a></h2><h3 id="napi-init-cpp-å®Œæ•´ç¤ºä¾‹" tabindex="-1">napi_init.cpp å®Œæ•´ç¤ºä¾‹ <a class="header-anchor" href="#napi-init-cpp-å®Œæ•´ç¤ºä¾‹" aria-label="Permalink to &quot;napi_init.cpp å®Œæ•´ç¤ºä¾‹&quot;">â€‹</a></h3><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;napi/native_api.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;add.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä½¿ç”¨æˆ‘ä»¬è®¾ç½®çš„å¤´æ–‡ä»¶è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;hilog/log.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ—¥å¿—æ ‡ç­¾</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> constexpr</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OHOS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HiviewDFX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::HiLogLabel LABEL </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    LOG_CORE, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">D001800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Entry&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åŠ æ³•å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_value</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_env</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_callback_info</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    HiLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LABEL, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Add function called&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è·å–å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_value args[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    napi_get_cb_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, info, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">argc, args, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è½¬æ¢å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a, b;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    napi_get_value_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, args[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    napi_get_value_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, args[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">b);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è°ƒç”¨ç¬¬ä¸‰æ–¹åº“å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a, b);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è¿”å›ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_value js_result;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    napi_create_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, result, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">js_result);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> js_result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¨¡å—åˆå§‹åŒ–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_value</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_env</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_value</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    HiLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LABEL, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Module initialized&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_property_descriptor desc[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;add&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Add, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_default, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    };</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    napi_define_properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, exports, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(desc) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(desc[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]), desc);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exports;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¨¡å—å®šä¹‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_module entryModule </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .nm_version </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .nm_flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .nm_filename </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .nm_register_func </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Init,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .nm_modname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;entry_native&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // â† ArkTS ä½¿ç”¨è¿™ä¸ªåå­—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .nm_priv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .reserved </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ³¨å†Œæ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">extern</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;C&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> __attribute__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((constructor)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RegisterModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    napi_module_register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">entryModule);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="arkts-è°ƒç”¨ç¤ºä¾‹" tabindex="-1">ArkTS è°ƒç”¨ç¤ºä¾‹ <a class="header-anchor" href="#arkts-è°ƒç”¨ç¤ºä¾‹" aria-label="Permalink to &quot;ArkTS è°ƒç”¨ç¤ºä¾‹&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> entry_native </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;libentry.so&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hilog </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@ohos.hilog&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@Entry</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@Component</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">struct Index {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  @State </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: number </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Column</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;NAPI ç¤ºä¾‹&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fontSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">margin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ bottom: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      Button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;è®¡ç®— 10 + 20&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onClick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> entry_native.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            hilog.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0x0000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Entry&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Result: %d&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.result);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            hilog.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0x0000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Entry&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Error: %s&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`ç»“æœ: \${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fontSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fontColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;#4A90E2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">margin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ top: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;100%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;100%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">justifyContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(FlexAlign.Center)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="ğŸ”-å¸¸è§é—®é¢˜" tabindex="-1">ğŸ” å¸¸è§é—®é¢˜ <a class="header-anchor" href="#ğŸ”-å¸¸è§é—®é¢˜" aria-label="Permalink to &quot;ğŸ” å¸¸è§é—®é¢˜&quot;">â€‹</a></h2><h3 id="q1-ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ª-cmakelists-txt" tabindex="-1">Q1: ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ª CMakeLists.txtï¼Ÿ <a class="header-anchor" href="#q1-ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ª-cmakelists-txt" aria-label="Permalink to &quot;Q1: ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ª CMakeLists.txtï¼Ÿ&quot;">â€‹</a></h3><p><strong>ç­”æ¡ˆ</strong>ï¼šåˆ†å±‚è®¾è®¡ï¼ŒèŒè´£åˆ†ç¦»</p><ul><li><strong>ä¸» CMakeLists.txt</strong>ï¼šæ„å»º NAPI æ¨¡å—ï¼Œç®¡ç†æ•´ä½“ä¾èµ–</li><li><strong>å­ CMakeLists.txt</strong>ï¼ˆ3rd/native_addï¼‰ï¼šæ„å»ºç¬¬ä¸‰æ–¹åº“</li></ul><p><strong>å¥½å¤„</strong>ï¼š</p><ul><li>æ¨¡å—åŒ–ï¼šæ¯ä¸ªæ¨¡å—ç‹¬ç«‹æ„å»º</li><li>å¯å¤ç”¨ï¼šç¬¬ä¸‰æ–¹åº“å¯ä»¥åœ¨å¤šä¸ªé¡¹ç›®ä¸­ä½¿ç”¨</li><li>æ¸…æ™°ï¼šæ„å»ºé€»è¾‘åˆ†å±‚æ¸…æ™°</li></ul><h3 id="q2-public-vs-private-å¦‚ä½•é€‰æ‹©" tabindex="-1">Q2: PUBLIC vs PRIVATE å¦‚ä½•é€‰æ‹©ï¼Ÿ <a class="header-anchor" href="#q2-public-vs-private-å¦‚ä½•é€‰æ‹©" aria-label="Permalink to &quot;Q2: PUBLIC vs PRIVATE å¦‚ä½•é€‰æ‹©ï¼Ÿ&quot;">â€‹</a></h3><p><strong>PUBLIC é€‚ç”¨åœºæ™¯</strong>ï¼š</p><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å…¬å¼€æ¥å£ï¼šç”¨æˆ·éœ€è¦åŒ…å«è¿™äº›å¤´æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target_include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PUBLIC</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    \${CMAKE_CURRENT_SOURCE_DIR}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å…¬å…±ä¾èµ–ï¼šç”¨æˆ·ä¹Ÿéœ€è¦è¿™ä¸ªåº“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target_link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PUBLIC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ace_napi.z  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç”¨æˆ·ä¹Ÿéœ€è¦ NAPI åŠŸèƒ½</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>PRIVATE é€‚ç”¨åœºæ™¯</strong>ï¼š</p><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å†…éƒ¨å®ç°ï¼šç”¨æˆ·ä¸éœ€è¦çŸ¥é“è¿™äº›</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target_include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PRIVATE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    \${CMAKE_CURRENT_SOURCE_DIR}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">internal</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å†…éƒ¨ä¾èµ–ï¼šç”¨æˆ·ä¸éœ€è¦è¿™ä¸ªåº“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target_link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PRIVATE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    internal_helper  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åªæ˜¯å†…éƒ¨ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="q3-å¦‚ä½•è°ƒè¯•åº“æ‰¾ä¸åˆ°çš„é—®é¢˜" tabindex="-1">Q3: å¦‚ä½•è°ƒè¯•åº“æ‰¾ä¸åˆ°çš„é—®é¢˜ï¼Ÿ <a class="header-anchor" href="#q3-å¦‚ä½•è°ƒè¯•åº“æ‰¾ä¸åˆ°çš„é—®é¢˜" aria-label="Permalink to &quot;Q3: å¦‚ä½•è°ƒè¯•åº“æ‰¾ä¸åˆ°çš„é—®é¢˜ï¼Ÿ&quot;">â€‹</a></h3><p><strong>æ£€æŸ¥æ­¥éª¤</strong>ï¼š</p><ol><li><strong>æ£€æŸ¥åº“æ˜¯å¦å­˜åœ¨</strong>ï¼š</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŸ¥æ‰¾åº“æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> entry/libs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;*.so&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åº”è¯¥çœ‹åˆ°ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># entry/libs/arm64-v8a/libnativeAdd.so</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># entry/libs/arm64-v8a/libentry.so</span></span></code></pre></div><ol start="2"><li><strong>æ£€æŸ¥é“¾æ¥æ˜¯å¦æ­£ç¡®</strong>ï¼š</li></ol><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åœ¨ CMakeLists.txt ä¸­æ·»åŠ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Libraries: \${CMAKE_CURRENT_BINARY_DIR}/libs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ol start="3"><li><strong>æŸ¥çœ‹ç¼–è¯‘è¾“å‡º</strong>ï¼š</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŸ¥çœ‹ç¼–è¯‘å‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cmake</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --verbose</span></span></code></pre></div><hr><h2 id="ğŸ“š-æ€»ç»“" tabindex="-1">ğŸ“š æ€»ç»“ <a class="header-anchor" href="#ğŸ“š-æ€»ç»“" aria-label="Permalink to &quot;ğŸ“š æ€»ç»“&quot;">â€‹</a></h2><h3 id="æ„å»ºæµç¨‹æ€»ç»“" tabindex="-1">æ„å»ºæµç¨‹æ€»ç»“ <a class="header-anchor" href="#æ„å»ºæµç¨‹æ€»ç»“" aria-label="Permalink to &quot;æ„å»ºæµç¨‹æ€»ç»“&quot;">â€‹</a></h3><ol><li><strong>é…ç½®é˜¶æ®µ</strong>ï¼šè¯»å– CMakeLists.txtï¼Œè®¾ç½®å˜é‡</li><li><strong>æ„å»ºç¬¬ä¸‰æ–¹åº“</strong>ï¼šç”Ÿæˆ libnativeAdd.so</li><li><strong>æ„å»º NAPI æ¨¡å—</strong>ï¼šç”Ÿæˆ libentry.so</li><li><strong>é“¾æ¥ä¾èµ–</strong>ï¼šå°†æ‰€éœ€çš„åº“è¿æ¥åœ¨ä¸€èµ·</li><li><strong>ç”Ÿæˆè¾“å‡º</strong>ï¼šåœ¨æŒ‡å®šç›®å½•ç”Ÿæˆæœ€ç»ˆæ–‡ä»¶</li></ol><h3 id="å…³é”®å‘½ä»¤é€ŸæŸ¥-å¤§ç™½è¯ç‰ˆ" tabindex="-1">å…³é”®å‘½ä»¤é€ŸæŸ¥ï¼ˆå¤§ç™½è¯ç‰ˆï¼‰ <a class="header-anchor" href="#å…³é”®å‘½ä»¤é€ŸæŸ¥-å¤§ç™½è¯ç‰ˆ" aria-label="Permalink to &quot;å…³é”®å‘½ä»¤é€ŸæŸ¥ï¼ˆå¤§ç™½è¯ç‰ˆï¼‰&quot;">â€‹</a></h3><h4 id="_1-add-subdirectory-å…ˆå»å»ºé‚£ä¸ªå°å·¥å‚" tabindex="-1">â‘  add_subdirectory - &quot;å…ˆå»å»ºé‚£ä¸ªå°å·¥å‚&quot; <a class="header-anchor" href="#_1-add-subdirectory-å…ˆå»å»ºé‚£ä¸ªå°å·¥å‚" aria-label="Permalink to &quot;â‘  add_subdirectory - &quot;å…ˆå»å»ºé‚£ä¸ªå°å·¥å‚&quot;&quot;">â€‹</a></h4><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_subdirectory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\${CMAKE_CURRENT_SOURCE_DIR}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/3rd/native_add)</span></span></code></pre></div><p><strong>å¤§ç™½è¯</strong>ï¼š</p><ul><li>å» <code>3rd/native_add</code> ç›®å½•ï¼Œæ‰¾åˆ°é‚£é‡Œçš„ CMakeLists.txt</li><li>æ‰§è¡Œé‚£ä¸ªæ–‡ä»¶é‡Œçš„æ„å»ºå‘½ä»¤</li><li>å…ˆæŠŠè¿™ä¸ª&quot;å·¥å‚&quot;å»ºå¥½ï¼ˆç”Ÿæˆ libnativeAdd.soï¼‰</li><li>ç„¶åå†å›æ¥ç»§ç»­å½“å‰çš„æ„å»º</li></ul><p><strong>ç±»æ¯”</strong>ï¼šå°±åƒåšèœè¦å…ˆå‡†å¤‡é£Ÿæï¼Œè¿™é‡Œæ˜¯å…ˆå»ºå¥½ç¬¬ä¸‰æ–¹åº“ã€‚</p><p><strong>å‚æ•°</strong>ï¼š</p><ul><li><code>\${CMAKE_CURRENT_SOURCE_DIR}</code>ï¼šå½“å‰ CMakeLists.txt æ‰€åœ¨ç›®å½•</li><li><code>3rd/native_add</code>ï¼šå­ç›®å½•è·¯å¾„ï¼ˆç›¸å¯¹äºå½“å‰ç›®å½•ï¼‰</li></ul><p><strong>æ‰§è¡Œé¡ºåº</strong>ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ä¸» CMakeLists.txt æ‰§è¡Œåˆ° add_subdirectory</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>æš‚åœå½“å‰æ„å»º</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>è¿›å…¥ 3rd/native_add/CMakeLists.txt</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>æ‰§è¡Œå­ç›®å½•çš„æ„å»ºï¼ˆç”Ÿæˆ libnativeAdd.soï¼‰</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>å›åˆ°ä¸» CMakeLists.txt</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>ç»§ç»­æ‰§è¡Œåé¢çš„å‘½ä»¤</span></span></code></pre></div><h4 id="_2-add-library-é€ ä¸€ä¸ªåŠ¨æ€åº“" tabindex="-1">â‘¡ add_library - &quot;é€ ä¸€ä¸ªåŠ¨æ€åº“&quot; <a class="header-anchor" href="#_2-add-library-é€ ä¸€ä¸ªåŠ¨æ€åº“" aria-label="Permalink to &quot;â‘¡ add_library - &quot;é€ ä¸€ä¸ªåŠ¨æ€åº“&quot;&quot;">â€‹</a></h4><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_library</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry SHARED napi_init.cpp)</span></span></code></pre></div><p><strong>å¤§ç™½è¯</strong>ï¼š</p><ul><li><code>entry</code>ï¼šç»™è¿™ä¸ªåº“èµ·çš„åå­—ï¼ˆå†…éƒ¨ç”¨ï¼‰</li><li><code>SHARED</code>ï¼šåšä¸ªåŠ¨æ€åº“ï¼ˆ.so æ–‡ä»¶ï¼‰</li><li><code>napi_init.cpp</code>ï¼šç”¨è¿™ä¸ªæºæ–‡ä»¶æ¥é€ </li></ul><p><strong>ç”Ÿæˆçš„æ–‡ä»¶</strong>ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>libentry.so  â† æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶ï¼ˆè‡ªåŠ¨åŠ  lib å‰ç¼€å’Œ .so åç¼€ï¼‰</span></span></code></pre></div><p><strong>ç±»æ¯”</strong>ï¼šå°±åƒç›–æˆ¿å­ï¼Œ<code>entry</code> æ˜¯æˆ¿å­åï¼Œ<code>SHARED</code> æ˜¯å»ºå…±äº«æˆ¿ï¼Œ<code>napi_init.cpp</code> æ˜¯ç –å—ã€‚</p><p><strong>SHARED vs STATIC</strong>ï¼š</p><table tabindex="0"><thead><tr><th>ç±»å‹</th><th>ç”Ÿæˆä»€ä¹ˆ</th><th>ä»€ä¹ˆæ—¶å€™é“¾æ¥</th><th>æ›´æ–°æ–¹å¼</th></tr></thead><tbody><tr><td>SHARED</td><td>libXXX.so</td><td>è¿è¡Œæ—¶æ‰åŠ è½½</td><td>åªéœ€æ›´æ–° .so æ–‡ä»¶</td></tr><tr><td>STATIC</td><td>libXXX.a</td><td>ç¼–è¯‘æ—¶æ‰“åŒ…è¿›å»</td><td>éœ€è¦é‡æ–°ç¼–è¯‘ä¸»ç¨‹åº</td></tr></tbody></table><p><strong>è¿™é‡Œä¸ºä»€ä¹ˆç”¨ SHARED</strong>ï¼š</p><ul><li>NAPI æ¨¡å—éœ€è¦è¢« ArkTS åŠ¨æ€åŠ è½½</li><li>å¤šä¸ªåº”ç”¨å¯ä»¥å…±äº«åŒä¸€ä¸ªåº“</li><li>æ›´æ–°æ–¹ä¾¿ï¼Œä¸ç”¨é‡æ–°ç¼–è¯‘æ•´ä¸ªåº”ç”¨</li></ul><h4 id="_3-target-include-directories-å‘Šè¯‰ç¼–è¯‘å™¨å»å“ªå„¿æ‰¾å¤´æ–‡ä»¶" tabindex="-1">â‘¢ target_include_directories - &quot;å‘Šè¯‰ç¼–è¯‘å™¨å»å“ªå„¿æ‰¾å¤´æ–‡ä»¶&quot; <a class="header-anchor" href="#_3-target-include-directories-å‘Šè¯‰ç¼–è¯‘å™¨å»å“ªå„¿æ‰¾å¤´æ–‡ä»¶" aria-label="Permalink to &quot;â‘¢ target_include_directories - &quot;å‘Šè¯‰ç¼–è¯‘å™¨å»å“ªå„¿æ‰¾å¤´æ–‡ä»¶&quot;&quot;">â€‹</a></h4><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target_include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PUBLIC</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    \${CMAKE_CURRENT_SOURCE_DIR}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                   # å½“å‰ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    \${CMAKE_CURRENT_SOURCE_DIR}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/3rd/native_add    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¬¬ä¸‰æ–¹åº“ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>å¤§ç™½è¯</strong>ï¼š</p><ul><li>å‘Šè¯‰ç¼–è¯‘å™¨ï¼šè¦æ‰¾å¤´æ–‡ä»¶æ—¶ï¼Œå»è¿™ä¸¤ä¸ªåœ°æ–¹æ‰¾</li><li><code>PUBLIC</code>ï¼šä¸ä»…æˆ‘èƒ½ç”¨ï¼Œç”¨æˆ‘è¿™ä¸ªåº“çš„äººä¹Ÿèƒ½ç”¨è¿™äº›è·¯å¾„</li></ul><p><strong>å®é™…æ•ˆæœ</strong>ï¼š</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åœ¨ napi_init.cpp ä¸­å¯ä»¥è¿™æ ·å†™ï¼š</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;my_header.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ä»å½“å‰ç›®å½•æ‰¾</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;add.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              // ä» 3rd/native_add ç›®å½•æ‰¾</span></span></code></pre></div><p><strong>è·¯å¾„å¯¹ç…§</strong>ï¼š</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>è·¯å¾„1: entry/src/main/cpp/          â† å½“å‰ç›®å½•</span></span>
<span class="line"><span>      â†“</span></span>
<span class="line"><span>#include &quot;my_header.h&quot;              â† åœ¨è¿™é‡Œæ‰¾</span></span>
<span class="line"><span></span></span>
<span class="line"><span>è·¯å¾„2: entry/src/main/cpp/3rd/native_add/  â† ç¬¬ä¸‰æ–¹åº“ç›®å½•</span></span>
<span class="line"><span>      â†“</span></span>
<span class="line"><span>#include &quot;add.h&quot;                    â† åœ¨è¿™é‡Œæ‰¾</span></span></code></pre></div><p><strong>PUBLIC vs PRIVATE</strong>ï¼š</p><table tabindex="0"><thead><tr><th>å…³é”®å­—</th><th>æˆ‘ç”¨</th><th>åˆ«äººç”¨</th><th>ç±»æ¯”</th></tr></thead><tbody><tr><td>PUBLIC</td><td>âœ…</td><td>âœ…</td><td>å¤§é—¨</td></tr><tr><td>PRIVATE</td><td>âœ…</td><td>âŒ</td><td>å§å®¤</td></tr><tr><td>INTERFACE</td><td>âŒ</td><td>âœ…</td><td>é—¨ç‰Œ</td></tr></tbody></table><p><strong>ä¸ºä»€ä¹ˆè¿™é‡Œç”¨ PUBLIC</strong>ï¼š</p><ul><li><code>entry</code> åº“éœ€è¦çš„å¤´æ–‡ä»¶è·¯å¾„ï¼Œå…¶ä»–ä½¿ç”¨ <code>entry</code> çš„åº“ä¹Ÿéœ€è¦</li><li>è‡ªåŠ¨ç»§æ‰¿ï¼Œä¸éœ€è¦æ‰‹åŠ¨å†è®¾ç½®ä¸€é</li></ul><h4 id="_4-target-link-libraries-æŠŠè¿™äº›åº“éƒ½è¿åœ¨ä¸€èµ·" tabindex="-1">â‘£ target_link_libraries - &quot;æŠŠè¿™äº›åº“éƒ½è¿åœ¨ä¸€èµ·&quot; <a class="header-anchor" href="#_4-target-link-libraries-æŠŠè¿™äº›åº“éƒ½è¿åœ¨ä¸€èµ·" aria-label="Permalink to &quot;â‘£ target_link_libraries - &quot;æŠŠè¿™äº›åº“éƒ½è¿åœ¨ä¸€èµ·&quot;&quot;">â€‹</a></h4><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target_link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PUBLIC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ace_napi.z      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NAPI è¿è¡Œåº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    hilog_ndk.z     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ—¥å¿—åº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    nativeAdd       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆšæ‰å»ºçš„åŠ æ³•åº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>å¤§ç™½è¯</strong>ï¼š</p><ul><li>æŠŠ <code>entry</code> å’Œè¿™å‡ ä¸ªåº“&quot;è¿çº¿&quot;ï¼Œè®© <code>entry</code> èƒ½è°ƒç”¨å®ƒä»¬çš„åŠŸèƒ½</li><li><code>PUBLIC</code>ï¼šä½¿ç”¨ <code>entry</code> çš„åº“ä¹Ÿä¼šè‡ªåŠ¨è·å¾—è¿™äº›ä¾èµ–</li></ul><p><strong>å®é™…æ•ˆæœ</strong>ï¼š</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åœ¨ napi_init.cpp ä¸­å¯ä»¥è°ƒç”¨ï¼š</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;napi/native_api.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // â† æ¥è‡ª ace_napi.z</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;hilog/log.h&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // â† æ¥è‡ª hilog_ndk.z</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;add.h&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              // â† æ¥è‡ª nativeAdd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_value</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_env</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_callback_info</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è°ƒç”¨ NAPI å‡½æ•°ï¼ˆæ¥è‡ª ace_napi.zï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    napi_get_cb_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, info, ...);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è°ƒç”¨æ—¥å¿—å‡½æ•°ï¼ˆæ¥è‡ª hilog_ndk.zï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    HiLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LABEL, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Add called&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è°ƒç”¨åŠ æ³•å‡½æ•°ï¼ˆæ¥è‡ª nativeAddï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>é“¾æ¥é¡ºåº</strong>ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>libentry.so</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>ä¾èµ– â†’ libace_napi.z.so  (æä¾› NAPI åŠŸèƒ½)</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>ä¾èµ– â†’ libhilog_ndk.z.so (æä¾›æ—¥å¿—åŠŸèƒ½)</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>ä¾èµ– â†’ libnativeAdd.so   (æä¾›åŠ æ³•åŠŸèƒ½)</span></span></code></pre></div><p><strong>PUBLIC çš„ä½œç”¨</strong>ï¼š</p><p>å‡è®¾æœ‰ä¸ªåº“ <code>my_app</code> ä½¿ç”¨ <code>entry</code>ï¼š</p><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target_link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(my_app </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PRIVATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> entry)</span></span></code></pre></div><p><strong>è‡ªåŠ¨è·å¾—</strong>ï¼š</p><ul><li><code>my_app</code> ä¸éœ€è¦æ‰‹åŠ¨é“¾æ¥ <code>ace_napi.z</code>ã€<code>hilog_ndk.z</code>ã€<code>nativeAdd</code></li><li>è¿™äº›ä¾èµ–ä¼šè‡ªåŠ¨ä¼ é€’è¿‡æ¥</li></ul><p><strong>ä¸è·å¾—</strong>ï¼š</p><ul><li><code>my_app</code> çš„ç›´æ¥ä¾èµ–æ˜¯ <code>entry</code></li><li><code>entry</code> çš„å†…éƒ¨å®ç°ï¼ˆå¦‚æŸäº› PRIVATE åº“ï¼‰ä¸ä¼šæš´éœ²</li></ul><h4 id="å®Œæ•´å‘½ä»¤ç»„åˆç¤ºä¾‹" tabindex="-1">å®Œæ•´å‘½ä»¤ç»„åˆç¤ºä¾‹ <a class="header-anchor" href="#å®Œæ•´å‘½ä»¤ç»„åˆç¤ºä¾‹" aria-label="Permalink to &quot;å®Œæ•´å‘½ä»¤ç»„åˆç¤ºä¾‹&quot;">â€‹</a></h4><p><strong>åœºæ™¯</strong>ï¼šæ„å»ºä¸€ä¸ª NAPI æ¨¡å—ï¼Œè°ƒç”¨ç¬¬ä¸‰æ–¹åº“</p><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. å…ˆå»ºç¬¬ä¸‰æ–¹åº“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_subdirectory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\${CMAKE_CURRENT_SOURCE_DIR}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/3rd/native_add)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># â†’ ç”Ÿæˆ libnativeAdd.so</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. å»º NAPI æ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_library</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry SHARED napi_init.cpp)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># â†’ ç›®æ ‡ï¼šç”Ÿæˆ libentry.so</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. å‘Šè¯‰ç¼–è¯‘å™¨å»å“ªå„¿æ‰¾å¤´æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target_include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PUBLIC</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    \${CMAKE_CURRENT_SOURCE_DIR}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              # æ‰¾è‡ªå·±çš„å¤´æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    \${CMAKE_CURRENT_SOURCE_DIR}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/3rd/native_add  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ‰¾ç¬¬ä¸‰æ–¹åº“çš„å¤´æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. é“¾æ¥æ‰€æœ‰éœ€è¦çš„åº“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target_link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PUBLIC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ace_napi.z   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å’Œ NAPI è¿è¡Œåº“&quot;è¿çº¿&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    hilog_ndk.z  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å’Œæ—¥å¿—åº“&quot;è¿çº¿&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    nativeAdd    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å’ŒåŠ æ³•åº“&quot;è¿çº¿&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>æ‰§è¡Œåçš„æ•ˆæœ</strong>ï¼š</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”Ÿæˆçš„æ–‡ä»¶:</span></span>
<span class="line"><span>â”œâ”€â”€ libnativeAdd.so  â† ç¬¬ä¸‰æ–¹åº“</span></span>
<span class="line"><span>â””â”€â”€ libentry.so      â† NAPI æ¨¡å—</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ä¾èµ–å…³ç³»:</span></span>
<span class="line"><span>entry (æˆ‘ä»¬é€ çš„)</span></span>
<span class="line"><span>  â”œâ”€â†’ ace_napi.z   (HarmonyOSæä¾›)</span></span>
<span class="line"><span>  â”œâ”€â†’ hilog_ndk.z  (HarmonyOSæä¾›)</span></span>
<span class="line"><span>  â””â”€â†’ nativeAdd    (åˆšæ‰é€ çš„)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>åœ¨ä»£ç ä¸­å¯ä»¥:</span></span>
<span class="line"><span>napi_init.cpp</span></span>
<span class="line"><span>  â”œâ”€â†’ ä½¿ç”¨ NAPI API    (å› ä¸ºé“¾æ¥äº† ace_napi.z)</span></span>
<span class="line"><span>  â”œâ”€â†’ ä½¿ç”¨æ—¥å¿—åŠŸèƒ½    (å› ä¸ºé“¾æ¥äº† hilog_ndk.z)</span></span>
<span class="line"><span>  â””â”€â†’ è°ƒç”¨ add() å‡½æ•° (å› ä¸ºé“¾æ¥äº† nativeAdd)</span></span></code></pre></div><h3 id="è®¾è®¡åŸåˆ™" tabindex="-1">è®¾è®¡åŸåˆ™ <a class="header-anchor" href="#è®¾è®¡åŸåˆ™" aria-label="Permalink to &quot;è®¾è®¡åŸåˆ™&quot;">â€‹</a></h3><ol><li><strong>èŒè´£åˆ†ç¦»</strong>ï¼šä¸»æ„å»ºæ–‡ä»¶ç®¡ç†æ•´ä½“ï¼Œå­æ„å»ºæ–‡ä»¶ç®¡ç†å±€éƒ¨</li><li><strong>ä¾èµ–é€æ˜</strong>ï¼šä½¿ç”¨ PUBLIC è‡ªåŠ¨ä¼ é€’ä¾èµ–</li><li><strong>è·¯å¾„æ¸…æ™°</strong>ï¼šæ˜ç¡®æŒ‡å®šæ‰€æœ‰å¤´æ–‡ä»¶æœç´¢è·¯å¾„</li><li><strong>æ˜“äºè°ƒè¯•</strong>ï¼šä½¿ç”¨ message æ‰“å°å…³é”®ä¿¡æ¯</li></ol><hr><p><strong>æ­å–œä½ æŒæ¡äº† CMake åœ¨ NAPI é¡¹ç›®ä¸­çš„å®Œæ•´åº”ç”¨ï¼</strong> ğŸ‰</p>`,176)])])}const c=i(p,[["render",l]]);export{g as __pageData,c as default};
