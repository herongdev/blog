import{_ as i,c as a,o as t,ag as n}from"./chunks/framework.oqSrIbQK.js";const g=JSON.parse('{"title":"ArkTS ↔ HTML 三种通信方式：runJavaScript、JavaScriptProxy 与 WebMessagePort（含最小示例）","description":"","frontmatter":{"title":"ArkTS ↔ HTML 三种通信方式：runJavaScript、JavaScriptProxy 与 WebMessagePort（含最小示例）","date":"2025-10-30T00:00:00.000Z","tags":["HarmonyOS","ArkTS","WebView","WebMessagePort","原生与H5"],"categories":["开发笔记"]},"headers":[],"relativePath":"posts/harmonyos教程/ArkTS-HTML三种通信方式-WebView双向通信实战.md","filePath":"posts/harmonyos教程/ArkTS-HTML三种通信方式-WebView双向通信实战.md","lastUpdated":1764331727000}'),e={name:"posts/harmonyos教程/ArkTS-HTML三种通信方式-WebView双向通信实战.md"};function h(l,s,p,k,r,o){return t(),a("div",null,[...s[0]||(s[0]=[n(`<p>没问题～一句话概括：<strong>ArkTS ↔ HTML</strong> 在鸿蒙里主要有三条通道——</p><ol><li>ArkTS 调 JS：<code>WebviewController.runJavaScript / runJavaScriptExt</code></li><li>JS 调 ArkTS：<code>javaScriptProxy / registerJavaScriptProxy</code> 注入原生对象</li><li>双向消息通道：<code>createWebMessagePorts + postMessage</code>（WebMessagePort）</li></ol><p>下面把“主要 API + 最常见用法”捋清楚（含小例子）。</p><hr><h2 id="_1-arkts-调用网页里的-js" tabindex="-1">1) ArkTS 调用网页里的 JS <a class="header-anchor" href="#_1-arkts-调用网页里的-js" aria-label="Permalink to &quot;1) ArkTS 调用网页里的 JS&quot;">​</a></h2><p><strong>什么时候用</strong>：把 Store 里的数据推给网页、调用 <code>window.LifeChart.setAll(...)</code> 等。</p><ul><li><code>controller.runJavaScript(script: string)</code>：异步执行一段 JS。常在 <code>onPageEnd</code> 后调用，确保网页已就绪。（<a href="https://developer.huawei.com/consumer/cn/forum/topic/0210121903108098084?utm_source=chatgpt.com" title="10、OpenHarmony Web子系统开发常见问题-华为开发者话题" target="_blank" rel="noreferrer">华为开发者官网</a>）</li><li><code>controller.runJavaScriptExt(script: string)</code>：也是执行 JS，但<strong>能拿返回值</strong>（Promise 风格，返回 JsValue，可 <code>getString()/getNumber()</code> 等）。（<a href="https://developer.huawei.com/consumer/en/doc/best-practices/bpta-harmony-application-security?utm_source=chatgpt.com" title="Application Security Coding-Application ..." target="_blank" rel="noreferrer">华为开发者官网</a>）</li></ul><p><strong>示例（ArkTS）</strong>：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 页面加载完后注入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onPageEnd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 推数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{ question: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;人生&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, percent: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.38</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }];</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.controller.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runJavaScript</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`window.LifeChart &amp;&amp; window.LifeChart.setData(\${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">})\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 取网页返回值（如读取 document.title）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.controller.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runJavaScriptExt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;document.title&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ArkWeb JsValue</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;[WebTitle]&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, title);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><blockquote><p>要点：把注入放在 <code>onPageEnd</code> 等网页完成回调之后，避免目标函数尚未挂载。（<a href="https://developer.huawei.com/consumer/cn/forum/topic/0210121903108098084?utm_source=chatgpt.com" title="10、OpenHarmony Web子系统开发常见问题-华为开发者话题" target="_blank" rel="noreferrer">华为开发者官网</a>）</p></blockquote><hr><h2 id="_2-网页调用-arkts-注入原生对象" tabindex="-1">2) 网页调用 ArkTS（注入原生对象） <a class="header-anchor" href="#_2-网页调用-arkts-注入原生对象" aria-label="Permalink to &quot;2) 网页调用 ArkTS（注入原生对象）&quot;">​</a></h2><p><strong>什么时候用</strong>：H5 希望直接触发原生能力（如读取设置、调用端能力等）。</p><ul><li><strong>初始化时注入：</strong><code>javaScriptProxy</code>（Web 组件属性）</li><li><strong>初始化完成后注入：</strong><code>controller.registerJavaScriptProxy(...)</code></li></ul><p>这两个都能把 ArkTS 对象“挂”到前端环境里（通常是 <code>window.XXX</code>），JS 直接调你暴露的方法。（<a href="https://developer.huawei.com/consumer/en/codelab/HarmonyOS-WebView/?utm_source=chatgpt.com" title="Using WebView" target="_blank" rel="noreferrer">华为开发者官网</a>）</p><p><strong>示例（ArkTS，在 <code>onControllerAttached</code> 里注册）：</strong></p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.controller.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">registerJavaScriptProxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;NativeBridge&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 前端可直接调用 NativeBridge.xxx()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  methodList: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;update&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  object: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    hello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: ()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Hi from ArkTS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 处理来自 H5 的数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ... 更新 Store 或执行业务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p><strong>示例（网页 JS 调用原生）：</strong></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// H5</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> window.NativeBridge.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.NativeBridge.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ age: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }));</span></span></code></pre></div><blockquote><p>官方文档场景叫“前端页面调用应用侧函数”，支持 <strong><code>javaScriptProxy</code></strong> 与 <strong><code>registerJavaScriptProxy()</code></strong> 两种注入时机。（<a href="https://docs.openharmony.cn/pages/v4.1/en/application-dev/web/web-in-page-app-function-invoking.md?utm_source=chatgpt.com" title="Invoking Application Functions on the Frontend Page" target="_blank" rel="noreferrer">OpenHarmony</a>）</p></blockquote><hr><h2 id="_3-双向消息通道-更通用-更安全" tabindex="-1">3) 双向消息通道（更通用/更安全） <a class="header-anchor" href="#_3-双向消息通道-更通用-更安全" aria-label="Permalink to &quot;3) 双向消息通道（更通用/更安全）&quot;">​</a></h2><p><strong>什么时候用</strong>：需要<strong>持续</strong>、<strong>双工</strong>传递数据（如事件流、较大 JSON），且不想暴露大量同步方法。</p><ul><li>建通道：<code>controller.createWebMessagePorts()</code></li><li>发送端口到 H5：<code>controller.postMessage(...)</code>（把其中一个端口发给网页）</li><li>收消息/发消息：ArkTS 侧 <code>WebMessagePort.onMessageEvent / postMessageEvent</code>；H5 侧使用 <code>MessagePort</code> 的 <code>onmessage / postMessage</code>。（<a href="https://www.cnblogs.com/hencins/p/17623151.html?utm_source=chatgpt.com" title="调研capacitor兼容openharmony平台可行性- 汪淼焱" target="_blank" rel="noreferrer">cnblogs.com</a>）</li></ul><p><strong>ArkTS（建立通道并把端口发给 H5）：</strong></p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ports</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.controller.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createWebMessagePorts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ports[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onMessageEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> payload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg.getString </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[H5-&gt;ETS]&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, payload);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 把 ports[0] 发给网页，网页保存后即可双向通信</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.controller.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;__init_port__&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [ports[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]], </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p><strong>H5（接收端口并通信）：</strong></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h5Port </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e.data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;__init_port__&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.ports?.[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    h5Port </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.ports[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    h5Port.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">evt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[ETS-&gt;H5]&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, evt.data);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 向 ArkTS 发消息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    h5Port.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;PING&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><blockquote><p>该方案基于 <strong>WebMessagePort</strong>，自 API9 起提供，适合做<strong>持久双工</strong>通道；官方也推荐用消息通道替代过度的对象注入以提升安全性。（<a href="https://www.cnblogs.com/hencins/p/17623151.html?utm_source=chatgpt.com" title="调研capacitor兼容openharmony平台可行性- 汪淼焱" target="_blank" rel="noreferrer">cnblogs.com</a>）</p></blockquote><hr><h2 id="_4-其它有用回调" tabindex="-1">4) 其它有用回调 <a class="header-anchor" href="#_4-其它有用回调" aria-label="Permalink to &quot;4) 其它有用回调&quot;">​</a></h2><ul><li><code>onPageBegin / onPageEnd / onProgressChange</code>：注入时机与进度控制。（<a href="https://blog.csdn.net/yong_19930826/article/details/146799987?utm_source=chatgpt.com" title="Harmonyos之加载本地web页面原创" target="_blank" rel="noreferrer">CSDN 博主</a>）</li><li><code>onConsole / onAlert / onConfirm / onPrompt</code>：接管网页日志与弹框（便于调试与原生 UI 替换）。（<a href="https://developer.huawei.com/consumer/en/doc/harmonyos-guides/web-dialog?utm_source=chatgpt.com" title="Displaying Web Page Dialog Boxes" target="_blank" rel="noreferrer">华为开发者官网</a>）</li></ul><hr><h2 id="_5-选型建议-实践经验" tabindex="-1">5) 选型建议（实践经验） <a class="header-anchor" href="#_5-选型建议-实践经验" aria-label="Permalink to &quot;5) 选型建议（实践经验）&quot;">​</a></h2><ul><li><strong>推数据到 H5</strong>：优先 <code>runJavaScript*</code>，简单直接（我们前面给你的 G2 图表就是这样做）。（<a href="https://medium.com/%40yang45472/call-the-front-end-page-function-f9dbe24141c2?utm_source=chatgpt.com" title="Call the front-end page function | by Yang" target="_blank" rel="noreferrer">Medium</a>）</li><li><strong>H5 触发原生能力</strong>：少量方法用 <code>registerJavaScriptProxy</code>；多而频的交互更建议 <strong>消息通道</strong>。（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V13/web-in-page-app-function-invoking-V13?utm_source=chatgpt.com" title="前端页面调用应用侧函数" target="_blank" rel="noreferrer">华为开发者官网</a>）</li><li><strong>时机</strong>：所有注入/调用尽量放在 <code>onPageEnd</code> 之后。（<a href="https://developer.huawei.com/consumer/cn/forum/topic/0210121903108098084?utm_source=chatgpt.com" title="10、OpenHarmony Web子系统开发常见问题-华为开发者话题" target="_blank" rel="noreferrer">华为开发者官网</a>）</li></ul><p>如果你要，我可以把这三种方式的<strong>最小模板</strong>直接嵌到你现有的 <code>LifeChart</code> 组件和 <code>index.html</code> 里，按你现在的项目结构一键跑通。</p>`,36)])])}const d=i(e,[["render",h]]);export{g as __pageData,d as default};
